---
title: é˜²è¡›çœã‚µã‚¤ãƒãƒ¼ã‚³ãƒ³ãƒ†ã‚¹ãƒˆ 2024 - Writeup
id: vlc-cybercontest-2024
tags:
  - CTF
  - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
date: 2024-02-26 01:11:57
---

<img src="/img/2024/02-25/Untitled.png" width="auto" height="auto">

é˜²è¡›çœã‚µã‚¤ãƒãƒ¼ã‚³ãƒ³ãƒ†ã‚¹ãƒˆ 2024ã«å‚åŠ ã—ã€450äººä¸­**7ä½**ã®æˆç¸¾ã‚’åã‚ã¾ã—ãŸ âœŒï¸

æ„Ÿæƒ³ã¨writeupã‚’æ›¸ãã¾ã™ã€‚

<!-- more -->

## ç›®æ¬¡
<!-- toc -->

## é †ä½ãƒ»è§£ã‘ãŸå•é¡Œ

<img src="/img/2024/02-25/Untitled%201.png" width="auto" height="auto">

<img src="/img/2024/02-25/Untitled%202.png" width="auto" height="auto">

## æ„Ÿæƒ³

ä»Šå›ã®ã‚³ãƒ³ãƒ†ã‚¹ãƒˆã¯ã‚ˆãã‚ã‚‹CTFã¨ã¯é•ã„ã€

- networkå•é¡Œã§OSCP, Boot2Rootçš„ãªå•é¡ŒãŒå‡ºã‚‹
- pwnãŒãªã„

ã¨ã„ã†ç‰¹å¾´ãŒã‚ã‚Šã€ä¸¡æ–¹ã¨ã‚‚è‡ªåˆ†ã«ã¯æœ‰åˆ©ã«åƒã„ã¦ã“ã®çµæœã ã£ãŸã¨æ€ã„ã¾ã™ã€‚

ä»Šã®å®ŸåŠ›ã§è§£ã‘ã‚‹ã¹ãå•é¡Œã¯è§£ãåˆ‡ã£ãŸã‹ãªï¼ˆDO_tHe_bestã¯é ‘å¼µã‚ŒãŸæ°—ã‚‚ã™ã‚‹ï¼‰ã¨ã„ã†æ€ã„ã§ã™ã€‚

Pivotã¨BruteforceãŒé¢ç™½ã‹ã£ãŸã®ã¨ã€Missing IVã¨Short RSA Public Keyã¯æ•™è‚²çš„ã§è‰¯ã„ãªã¨æ€ã„ã¾ã—ãŸã€‚

## Welcome

<img src="/img/2024/02-25/Untitled%203.png" width="550px" height="auto">

æ·»ä»˜ã«ãƒ•ãƒ©ã‚°ãŒãã®ã¾ã¾æ›¸ã„ã¦ã‚ã‚‹ã€‚

<aside>
â›³ flag{WelcomeToMODCyberContest!}

</aside>

## Crypto

### Information of Certificate

<img src="/img/2024/02-25/Untitled%204.png" width="550px" height="auto">

```bash
% openssl x509 -in Easy.crt -text -noout
Certificate:
    Data:
        Version: 1 (0x0)
        Serial Number: 2024 (0x7e8)
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: C=XX, ST=Some-State, L=Nowhere, O=Invalid, OU=Invalid, CN=**QRK7rNJ3hShV.vlc-cybercontest.invalid**/emailAddress=user@QRK7rNJ3hShV.vlc-cybercontest.invalid
        Validity
            Not Before: Jan  1 00:00:00 2024 GMT
            Not After : Feb  1 00:00:00 2024 GMT
        Subject: C=XX, ST=Some-State, L=Nowhere
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: (512 bit)
                Modulus:
                    00:a6:61:cf:52:55:0a:e4:5e:9b:5c:99:3b:aa:20:
                    90:0d:80:06:9a:9b:be:23:4c:17:0d:2c:fc:d1:be:
                    66:43:40:7f:55:10:6a:99:56:0c:b2:09:a5:a2:6d:
                    2a:25:c4:ff:67:e4:e3:02:87:57:cf:77:af:67:04:
                    31:c5:f7:9b:83
                Exponent: 65537 (0x10001)
    Signature Algorithm: sha256WithRSAEncryption
         3c:ff:d8:42:a8:eb:2c:55:93:5c:73:a3:84:fa:ea:9b:f8:fb:
         f2:06:50:e4:95:97:9f:5e:ad:c7:ac:b6:36:77:4b:66:1f:38:
         20:bf:71:9d:83:32:c1:3c:35:4f:b9:98:b4:4c:97:87:53:7d:
         84:80:83:df:ab:10:cc:fa:88:b1
```

ã§å‡ºã¦ããŸCNãŒãƒ•ãƒ©ã‚°ã€‚

<aside>
â›³ flag{QRK7rNJ3hShV.vlc-cybercontest.invalid}

</aside>

### Missing IV

<img src="/img/2024/02-25/Untitled%205.png" width="550px" height="auto">

AES-CBCã®å¾©å·ã®å•é¡Œã€‚AES-CBCã¯ä»¥ä¸‹ã®æ§‹é€ ã§æš—å·åŒ–ã—ã¦ã„ã‚‹ã€‚

<img src="/img/2024/02-25/Untitled%206.png" width="auto" height="auto">

[https://aes.cryptohack.org/ecbcbcwtf/](https://aes.cryptohack.org/ecbcbcwtf/) ã‚ˆã‚Šå¼•ç”¨

- éµ: 128 bit (ä»Šå›ã¯æ—¢çŸ¥)
- å¹³æ–‡: 128 bitã”ã¨ã«åˆ†å‰² (æœªçŸ¥)
- æš—å·æ–‡: 128 bitã”ã¨ã«åˆ†å‰² (æ—¢çŸ¥)

ã¨ã„ã†çŠ¶æ³ã€‚

ä»Šå›ã¯å¹¸ã„éµãŒã‚ã‹ã£ã¦ã„ã‚‹ã®ã§ã€å¾Œã‚ã®ãƒ–ãƒ­ãƒƒã‚¯ã‹ã‚‰é †ã«å¾©å·ã—ã¦ã‚„ã‚Œã°è‰¯ã„ï¼ˆç¾åœ¨ã®å¾©å·æ¸ˆã¿ãƒ–ãƒ­ãƒƒã‚¯ã‚’å‰ã®æš—å·ãƒ–ãƒ­ãƒƒã‚¯ã¨XORã™ã‚‹é–¢ä¿‚ã§å¾Œã‚ã‹ã‚‰å‡¦ç†ï¼‰ã€‚

ä¸€ç•ªæœ€åˆã®ãƒ–ãƒ­ãƒƒã‚¯ã ã‘ã¯IVãŒã‚ã‹ã‚‰ãªã„ã®ã§å¾©å·ã§ããªã„ãŒã€ãŸã¶ã‚“æœ€åˆã®ãƒ–ãƒ­ãƒƒã‚¯ã«å¤§äº‹ãªæƒ…å ±ã¯å…¥ã£ã¦ãªã„ã¨é«˜ã‚’æ‹¬ã‚‹ã€‚

ä»¥ä¸‹ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ›¸ã„ãŸã€‚å¾©å·çµæœã‚’ zip ã«ã—ã¦ã„ã‚‹ã®ã¯ã€æœ€åˆã«ç›®ã§è¦‹ãŸã‚‰ `PK` ã®zipãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒã‚¸ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ãŒå…ˆé ­ã«è¦‹ãˆãŸã‹ã‚‰ã€‚

```python
from Crypto.Cipher import AES

key = bytes.fromhex("4285a7a182c286b5aa39609176d99c13")

with open("NoIV.bin", "rb") as f:
    encrypted_flag = f.read()

# æš—å·æ–‡ã‚’ãƒ–ãƒ­ãƒƒã‚¯åˆ†å‰²
enc_blocks = [encrypted_flag[i : i + 16] for i in range(0, len(encrypted_flag), 16)]
print(f"enc_blocks: {len(enc_blocks)}")

def decrypt_block(block_bytes):
    # æš—å·æ–‡ã‚’å¾©å·
    cipher =  AES.new(key, AES.MODE_ECB)
    decrypted = cipher.decrypt(block_bytes)
    return decrypted

decrypted = bytes()

# æš—å·æ–‡ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚’é€†é †ã«å¾©å·
for i in range(len(enc_blocks) - 1, 0, -1):
    # ãƒ–ãƒ­ãƒƒã‚¯å˜ä½“ã®å¾©å·
    dec_ecb_block = decrypt_block(enc_blocks[i])

    # å¾©å·çµæœã¯ã€å‰ã®ãƒ–ãƒ­ãƒƒã‚¯ã¨XORã•ã‚Œã¦ã„ã‚‹ã€‚å†åº¦XORã‚’ã¨ã‚‹ã“ã¨ã§å¾©å·
    prev_enc_block = enc_blocks[i - 1]
    dec_cbc_block = [blk ^ prev_blk for blk, prev_blk in zip(dec_ecb_block, prev_enc_block)]
    #print(f"decrypted block #{i}: {''.join([chr(c) for c in dec_cbc_block])}")

    decrypted = bytes(dec_cbc_block) + decrypted

# æœ€åˆã®ãƒ–ãƒ­ãƒƒã‚¯ã¯IVãŒã‚ã‹ã‚‰ãªã„ã®ã§å¾©å·ã§ããªã„

with open('dec.zip', 'wb') as f:
    f.write(decrypted)
    print("decrypted data written to dec.zip")

```

å®Ÿè¡Œã™ã‚‹ã¨ã€ dec.zip ãŒã§ãã‚‹ã€‚unzipã™ã‚‹ã¨è‰²ã€…ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‡ºã¦ãã‚‹ã€‚

```python
% ag flag
content.xml
2:...<text:p text:style-name="P1">**flag{ESYQV0fPMxz4wMmU}**</text:p></office:text></office:body></office:document-content>
```

ã¨ã„ã†ã“ã¨ã§ã€

<aside>
â›³ flag{ESYQV0fPMxz4wMmU}

</aside>

### Short RSA Public Key

<img src="/img/2024/02-25/Untitled%207.png" width="550px" height="auto">

RSAã®å•é¡Œã®è§£æ³•ã¯è‡ªåˆ†ãƒ¡ãƒ¢ã¨ã—ã¦ [RSA - Notion](https://laysakura.notion.site/CTF-crypto-829de7f32c02413396ecc3c79b1d0ddf#6b13caf305e0411ca28a3e0fa57168c2) ã«ã¾ã¨ã‚ã¦ã‚ã‚‹ã€‚

ã¾ãšã¯æ·»ä»˜ã® .pem ã‚’é›‘ã«â†“ã«æŠ•ã’ã‚‹ã€‚

[Online Certificate Decoder, decode crl,crt,csr,pem,privatekey,publickey,rsa,dsa,rasa publickey,ec](https://8gwifi.org/PemParserFunctions.jsp)

<img src="/img/2024/02-25/Untitled%208.png" width="auto" height="auto">

public exponentã¯ `e` modulus ã®éƒ¨åˆ†ãŒå…¬é–‹éµ `n` ã€‚10é€²æ•°ã«ã™ã‚‹ã¨:

```python
% python -c 'print(0xad81c92641c0b18c4eda551c1d7828044e3e4a7519aac90ee4691c4a86dce2e1)'
**78479434358679743508116090024686132395246871443799969871485501232049475609313**
```

å…¬é–‹éµãŒçŸ­ã„ã®ã§ã€ç´ å› æ•°åˆ†è§£ã‚‚ç°¡å˜ã€‚â†“ã«æŠ•ã’ã‚‹ã€‚

<img src="/img/2024/02-25/Untitled%209.png" width="auto" height="auto">

ç´ å› æ•°åˆ†è§£ã‚‚ã§ããŸã®ã§ã€ã‚ã¨ã¯ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã€‚

```python
from Crypto.Util.number import long_to_bytes, bytes_to_long

e = 0x10001
n = 78479434358679743508116090024686132395246871443799969871485501232049475609313
with open("RSA-cipher.dat", "rb") as myfile:
    c = bytes_to_long(myfile.read())

p = 1011146650909449935800449563521726151
q = 77614294907759846691928156982114516291863

assert n == p * q

phi = (p - 1) * (q - 1)
d = pow(e, -1, phi)

m = pow(c, d, n)
print(long_to_bytes(m))
```

å®Ÿè¡Œã™ã‚‹ã¨

```python
% python solve.py
b'\x02\xb0\xf9\x92\x16M\x1fN\x0f\xcd\xd5Bl\x00**flag{X0Myx6IHI8}**\n'
```

<aside>
â›³ flag{X0Myx6IHI8}

</aside>

### Cryptographically Insecure PRNG

<img src="/img/2024/02-25/Untitled%2010.png" width="550px" height="auto">

XORã«ä½¿ã†éµã¯ã€4ãƒã‚¤ãƒˆã®ã‚·ãƒ¼ãƒ‰ã•ãˆæ±ºã¾ã‚Œã°ä¸€æ„ã«å®šã¾ã‚‹ã€‚ãŸã ã—ä»»æ„4ãƒã‚¤ãƒˆã¯ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã™ã‚‹ã«ã¯å¤šã™ãã‚‹ã®ã§ã€çµã‚Šè¾¼ã¿ãŸã„ã€‚

æœ€åˆã®4æ–‡å­—ãŒè‹±å­—ã§ã‚ã‚‹ã“ã¨ãŒæœŸå¾…ã•ã‚Œã‚‹ã®ã§ã€ãã®ã‚ˆã†ãªæ¡ä»¶ã‚’æº€ãŸã™ã‚ˆã†ãªã‚·ãƒ¼ãƒ‰ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ã“ã¨ã¨ã™ã‚‹ã€‚ä»¥ä¸‹ã® `seedlist.py` ï¼ˆè©¦è¡ŒéŒ¯èª¤ã‚†ãˆã‚ã¡ã‚ƒæ±šã„ï¼‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ `seedlist.hex` ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚·ãƒ¼ãƒ‰å€™è£œãŸã¡ãŒ1è¡Œãšã¤æ›¸ã‹ã‚Œã‚‹ã€‚

```python
from Crypto.Util.number import bytes_to_long
import itertools

def mk_seed(ciphertext, ascii4):
    ascii4_long = bytes_to_long(bytes(ascii4, "ascii"))

    seed_bytes = b""
    for j in range(4):
        seed_bytes = bytes([ciphertext[j] ^ ((ascii4_long >> ((3 - j) * 8)) & 0xFF)]) + seed_bytes
    return seed_bytes

# Read the encrypted file
with open("PRNG.bin", "rb") as f:
    ciphertext = f.read()

# ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã®ãƒªã‚¹ãƒˆã‚’ä½œæˆ
alphabet = [chr(i) for i in range(ord("a"), ord("z") + 1)] + [
    chr(i) for i in range(ord("A"), ord("Z") + 1)
]

# 4æ–‡å­—ã®çµ„ã¿åˆã‚ã›ã‚’ç”Ÿæˆ
combinations = itertools.product(alphabet, repeat=4)

with open("seedlist.hex", "w") as f:

    # ãƒ«ãƒ¼ãƒ—ã§çµ„ã¿åˆã‚ã›ã‚’å‡¦ç†
    for combo in combinations:
        # æ–‡å­—åˆ—ã«å¤‰æ›ã—ã¦å‡ºåŠ›
        ascii4 = "".join(combo)
        seed = mk_seed(ciphertext, ascii4)
        seed_hex = bytes.hex(seed)
        print(ascii4, seed_hex)
        f.write(f"{seed_hex}\n")
```

ã“ã®ã‚·ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦å¾©å·ã‚’è©¦ã¿ã‚‹ã€‚å¾©å·çµæœã«ã¯ `flag` ã®æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã¯ãšãªã®ã§ã€å¾©å·çµæœã«ãã‚ŒãŒå«ã¾ã‚Œã¦ã„ãŸã‚‰ `decrypted-seed-{ãã®æ™‚ã®seed}.txt` ã«å¾©å·çµæœå…¨æ–‡ãŒæ›¸ãè¾¼ã¾ã‚Œã‚‹ã‚ˆã†ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ã„ãŸï¼ˆã“ã‚Œã¾ãŸæ±šã„â€¦ï¼‰ã€‚

```python
def decrypt_first_4bytes(ciphertext, seed):
    plaintext = ""
    for j in range(4):
        plaintext += chr(ciphertext[j] ^ ((seed >> (j * 8)) & 0xFF))
    return plaintext

def decrypt(ciphertext, prng):
    plaintext = ""
    for i in range(0, len(ciphertext), 4):
        xor_val = next(prng)
        for j in range(4):
            # print(f"i: {i}, j: {j}, xor_val: {xor_val}")
            if i + j < len(ciphertext):
                plaintext += chr(ciphertext[i + j] ^ ((xor_val >> (j * 8)) & 0xFF))
    return plaintext

def lcg(m=4294967296, a=233, c=653, seed=0):
    """Linear congruential generator"""
    while True:
        yield seed
        seed = (a * seed + c) % m

# Read the encrypted file
with open("PRNG.bin", "rb") as f:
    ciphertext = f.read()

with open("seedlist.hex", "r") as f:
    for seed_hex in f:
        seed = int(seed_hex.strip(), 16)
        first_4bytes = decrypt_first_4bytes(ciphertext, seed)
        print(
            "[progress] seed: {:08X}, first_4bytes: {}".format(
                seed, first_4bytes.encode("utf-8")
            )
        )

        assert first_4bytes.isalpha()

        prng = lcg(seed=seed)
        plaintext = decrypt(ciphertext, prng)

        if "flag" in plaintext or "FLAG" in plaintext or "Flag" in plaintext:
            print(f"[Hit ASCII!] seed: {seed}, plaintext: {plaintext}")
            with open(f"decrypted-seed-{seed}.txt", "w") as f2:
                f2.write(plaintext)

```

ã‚·ãƒ¼ãƒ‰ãŒ10é€²æ•°ã§ 2638296720 ã®ã¨ãã€ä»¥ä¸‹ã®å¹³æ–‡ãŒå¾—ã‚‰ã‚Œã‚‹ã€‚

```
Against selection release between gray knowledge. To interest trot versus protective morning. Round death annoy on interesting bat. Inside finger zip of jolly skate. Opposite flavor exercise of husky quiet. Minus plate include despite whole development. Below society desert than kindhearted head. To shirt guarantee anti steadfast secretary. Beneath tree laugh like romantic expert. To sisters end below hallowed carriage. **flag{QVFE5i5LkZdR}** Inside hook point into depressed hate. Past act reply anti quarrelsome stove. Aboard badge memorize amid vagabond farm. On riddle request without offbeat pets. At mouth object above present ink. Near curve stroke in garrulous trouble. Anti country answer through swift talk. Over test escape into puzzling crook. Than stream waste near uneven ants. About fireman choke along defective base.
```

<aside>
â›³ flag{QVFE5i5LkZdR}

</aside>

## Forensics

### NTFS Data Hide

<img src="/img/2024/02-25/Untitled%2011.png" width="550px" height="auto">

FTK Imagerã‚’åˆã‚ã¦ä½¿ã£ã¦ã¿ãŸãŒã€ä¸‹æ‰‹ããã§ã†ã¾ãã„ã‹ãªã‹ã£ãŸ ğŸ˜‡

è‡ªåˆ†ãƒ¡ãƒ¢ã® [sleuthkit åŸºæœ¬ä»•è‰ - Notion](https://laysakura.notion.site/CTF-forensics-bb9a10ec17134b6c86ba5cd91c4f33d1#d96978e1f5864cf9b7d15a502a6f93cd) ã‚ãŸã‚Šã‚’èª­ã¿ã¤ã¤ sleuthkit ã§ã‚„ã£ã¦ã„ãã€‚

---

```bash
% fls -o 0000000128 NTFS.vhd
r/r 4-128-1:    $AttrDef
r/r 8-128-2:    $BadClus
r/r 8-128-1:    $BadClus:$Bad
r/r 6-128-4:    $Bitmap
r/r 7-128-1:    $Boot
d/d 11-144-4:   $Extend
r/r 2-128-1:    $LogFile
r/r 0-128-6:    $MFT
r/r 1-128-1:    $MFTMirr
d/d 49-144-1:   $RECYCLE.BIN
r/r 9-128-8:    $Secure:$SDS
r/r 9-144-11:   $Secure:$SDH
r/r 9-144-14:   $Secure:$SII
r/r 10-128-1:   $UpCase
r/r 10-128-4:   $UpCase:$Info
r/r 3-128-3:    $Volume
d/d 39-144-1:   NTFSDataHide
d/d 41-144-1:   NTFSFileDelete
d/d 40-144-1:   NTFSFileRename
d/d 36-144-5:   System Volume Information
V/V 256:        $OrphanFiles

% fls -o 0000000128 NTFS.vhd 39-144-1
r/r 42-128-3:   Sample.pptx
r/r 42-128-5:   Sample.pptx:script

% icat -o 0000000128 -r NTFS.vhd 42-128-5
"[System.Text.Encoding]::UTF8.GetString([Convert]::FromBase64String('**ZmxhZ3tkYXRhX2Nhbl9iZV9oaWRkZW5faW5fYWRzfQ==**'))"
```

Base64ãŒå‡ºã¦ããŸã®ã§CyberChefã€‚

<img src="/img/2024/02-25/Untitled%2012.png" width="auto" height="auto">

<aside>
â›³ flag{data_can_be_hidden_in_ads}

</aside>

### NTFS File Delete

<img src="/img/2024/02-25/Untitled%2013.png" width="550px" height="auto">

å‰å•ã¨åŒæ§˜ã« sleuthkit ã§ã€‚

```bash
% fls -o 0000000128 NTFS.vhd
r/r 4-128-1:    $AttrDef
r/r 8-128-2:    $BadClus
r/r 8-128-1:    $BadClus:$Bad
r/r 6-128-4:    $Bitmap
r/r 7-128-1:    $Boot
d/d 11-144-4:   $Extend
r/r 2-128-1:    $LogFile
r/r 0-128-6:    $MFT
r/r 1-128-1:    $MFTMirr
d/d 49-144-1:   $RECYCLE.BIN
r/r 9-128-8:    $Secure:$SDS
r/r 9-144-11:   $Secure:$SDH
r/r 9-144-14:   $Secure:$SII
r/r 10-128-1:   $UpCase
r/r 10-128-4:   $UpCase:$Info
r/r 3-128-3:    $Volume
d/d 39-144-1:   NTFSDataHide
d/d 41-144-1:   NTFSFileDelete
d/d 40-144-1:   NTFSFileRename
d/d 36-144-5:   System Volume Information
V/V 256:        $OrphanFiles

% fls -o 0000000128 NTFS.vhd 41-144-1
r/r 48-128-1:   Sample.txt
-/r * 52-128-1: flag.txt

% icat -o 0000000128 -r NTFS.vhd 52-128-1
**flag{resident_in_mft}**
```

<aside>
â›³ flag{resident_in_mft}

</aside>

### NTFS File Rename

<img src="/img/2024/02-25/Untitled%2014.png" width="550px" height="auto">

`$MFT` ã‹ã‚‰å±¥æ­´è¾¿ã‚ã†ã¨æ€ã£ãŸã‘ã©ãƒ•ã‚¡ã‚¤ãƒ«åã‚ã‹ã‚‰ãªã‹ã£ãŸã€‚ãƒ’ãƒ³ãƒˆè¦‹ãŸã€‚

> NTFS ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¯ã‚·ã‚™ãƒ£ãƒ¼ãƒŠãƒªãƒ³ã‚¯ã‚™ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¦ã‚™ã€**NTFS Log** ã‚„ USN ã‚·ã‚™ãƒ£ãƒ¼ãƒŠãƒ«ã«ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´å±¥æ­´ã‹ã‚™è¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚
>

sleuthkit ã§ `$LogFile` ã‚’ã‚²ãƒƒãƒˆã€‚

```bash
% fls -o 0000000128 NTFS.vhd
r/r 4-128-1:    $AttrDef
r/r 8-128-2:    $BadClus
r/r 8-128-1:    $BadClus:$Bad
r/r 6-128-4:    $Bitmap
r/r 7-128-1:    $Boot
d/d 11-144-4:   $Extend
r/r 2-128-1:    $LogFile
r/r 0-128-6:    $MFT
r/r 1-128-1:    $MFTMirr
d/d 49-144-1:   $RECYCLE.BIN
r/r 9-128-8:    $Secure:$SDS
r/r 9-144-11:   $Secure:$SDH
r/r 9-144-14:   $Secure:$SII
r/r 10-128-1:   $UpCase
r/r 10-128-4:   $UpCase:$Info
r/r 3-128-3:    $Volume
d/d 39-144-1:   NTFSDataHide
d/d 41-144-1:   NTFSFileDelete
d/d 40-144-1:   NTFSFileRename
d/d 36-144-5:   System Volume Information
V/V 256:        $OrphanFiles

% icat -o 0000000128 -r NTFS.vhd 2-128-1 > LogFile
```

Windowsã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ã‚ŠãŒã¡ãª2ãƒã‚¤ãƒˆã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«æ°—ã‚’ã¤ã‘ã¤ã¤ strings ã§ãƒã‚§ãƒƒã‚¯ã€‚

```bash
% strings -e l LogFile |grep docx
werful.docx
"**journaling_system_is_powerful.docx**
owerful.docx
"journaling_system_is_powerful.docx
...
```

<aside>
â›³ flag{journaling_system_is_powerful}

</aside>

### HiddEN Variable

<img src="/img/2024/02-25/Untitled%2015.png" width="550px" height="auto">

ãƒ¡ãƒ¢ãƒªãƒ•ã‚©ãƒ¬ãƒ³ã‚¸ãƒƒã‚¯ï¼åˆã‚ã¦ãªã‚“ã ã‚ˆãªãâ€¦

ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ã—ã¦ç’°å¢ƒå¤‰æ•°ã‚’è¦‹ãŸãã†ã€‚ã‚°ã‚°ã‚‹ã¨ Volatility ã¨ã‹ã„ã†ã®ã‚’ä½¿ã†ã¨è‰¯ã„ã¨ã‹ã€‚æœ¬å½“ã¯2ã¨ã‹3ã®ä½¿ã„æ–¹ã§æ»…èŒ¶è‹¦èŒ¶è‹¦åŠ´ã—ãŸã‘ã©ã€ã‚µãƒ©ãƒƒã¨è¦ç‚¹ã‚’æ›¸ãã€‚

```bash
% vol.py -f ~/tmp/forensics/memdump.raw windows.envars.Envars > Envars.txt

% ag flag
Envars.txt
1298:2816       sihost.exe      0x1747e0e2010   FLAG    **BDkPUNzMM3VHthkj2cVEjdRBqTJcfLMJaxT9si67RgJZ45PS**
...
```

`flag{BDkPUNzMM3VHthkj2cVEjdRBqTJcfLMJaxT9si67RgJZ45PS}` ã‹ãªï¼Ÿï¾–ï½¼! ã¨æ€ã£ãŸã‘ã©é€šã‚‰ãªã„ã€‚ã“ã“ã§è©¦è¡ŒéŒ¯èª¤æ²¼ã«ãƒãƒã‚Š30åˆ†ä»¥ä¸Šæã—ãŸãŒã€CyberChefã«å…¥ã‚ŒãŸã‚‰æ•™ãˆã¦ãã‚ŒãŸã€‚

<img src="/img/2024/02-25/Untitled%2016.png" width="auto" height="auto">

æ‚”ã—ã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œ

<aside>
â›³ flag{volatile_environment_variable}

</aside>

### My Secret

<img src="/img/2024/02-25/Untitled%2017.png" width="550px" height="auto">

å–ã£æ›ã‹ã‚ŠãŒã‚ã¾ã‚Šãªã„ & æ®‹ã‚Šæ™‚é–“ã‚‚å°‘ãªããªã£ã¦ãã¦ã„ãŸã®ã§ãƒ’ãƒ³ãƒˆã‚’è¦‹ãŸã€‚

> 7-Zip ã¨ã„ã†ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¦ã‚™ä½•ã‹ã‚’è¡Œã£ã¦ã„ã‚‹ã‚ˆã†ã¦ã‚™ã™ã€‚
>

ã˜ã‚ƒã‚ãƒ—ãƒ­ã‚»ã‚¹çµã£ã¦è§£æã ãªã€‚

```bash
% vol.py -f ~/tmp/forensics/memdump.raw windows.pslist > pslist.txt

% grep '7z' pslist.txt
**5516**    3468    7z.exe  0xe206bb303080  4       -       1       False   2023-12-26 00:51:23.000000      N/A     Disabled
# PIDãŒ5516

% vol.py -f ~/tmp/forensics/memdump.raw windows.cmdline --pid 5516
Volatility 3 Framework 2.6.1
Progress:  100.00               PDB scanning finished
PID     Process Args

5516    7z.exe  7z  x -p**Y0uCanF1ndTh1sPa$$w0rd** C:\Users\vauser\Documents\**Secrets.7z** -od:\

% vol.py -f ~/tmp/forensics/memdump.raw -o .  windows.dumpfiles --pid 5516
Volatility 3 Framework 2.6.1
Progress:  100.00               PDB scanning finished
Cache   FileObject      FileName        Result

DataSectionObject       0xe206bbc4a2f0  Secrets.7z      Error dumping file
SharedCacheMap  0xe206bbc4a2f0  **Secrets.7z**      file.0xe206bbc4a2f0.0xe206bbabada0.SharedCacheMap.Secrets.7z.vacb
```

ææ–™ã¯æƒã£ãŸã£ã½ã„ã®ã§å±•é–‹ã€‚

```bash
% 7z x -p'Y0uCanF1ndTh1sPa$$w0rd' file.0xe206bbc4a2f0.0xe206bbabada0.SharedCacheMap.Secrets.7z.vacb
```

`Secrets.rtf` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒã§ãã‚‹ã®ã§é–‹ãã¨ã€ã€ãƒ•ãƒ©ã‚°ãŒãªã„â€¦

ãªã„ã‚ã‘ãªã„ã§ã—ã‚‡ã€ãƒªãƒƒãƒãƒ†ã‚­ã‚¹ãƒˆã£ã¦ã“ã¨ã¯åè»¢ã§ã—ã‚‡

<img src="/img/2024/02-25/Untitled%2018.png" width="auto" height="auto">

ã„ãŸâ€¦

<aside>
â›³ flag{you_cannot_find_this_secret!}

</aside>

## Miscellaneous

### Une Maison

<img src="/img/2024/02-25/Untitled%2019.png" width="550px" height="auto">

æ·»ä»˜ç”»åƒã¯â†“

<img src="/img/2024/02-25/Untitled%2020.png" width="auto" height="auto">

ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã£ã½ã„â€¦ï¼Ÿ

[Aperi'Solve](https://www.aperisolve.com/)

ã§è‰²å‘³ã‚’è½ã¨ã—ãŸã‚„ã¤ã‚’é©å½“ãªAndroidã‚¢ãƒ—ãƒªã®ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼ã§èª­ã‚“ã ã‚‰ã€èª­ã‚ãŸã€‚

<aside>
â›³ flag{$50M!}

</aside>

### String Obfuscation

<img src="/img/2024/02-25/Untitled%2021.png" width="550px" height="auto">

æ·»ä»˜ã‚³ãƒ¼ãƒ‰ã¯ã“ã‚Œã€‚

```python
import sys

if len(sys.argv) < 2:
    exit()

KEY = "gobbledygook".replace("b", "").replace("e", "").replace("oo", "").replace("gk", "").replace("y", "en")
**FLAG = chr(51)+chr(70)+chr(120)+chr(89)+chr(70)+chr(109)+chr(52)+chr(117)+chr(84)+chr(89)+chr(68)+chr(70)+chr(70)+chr(122)+chr(109)+chr(98)+chr(51)**

if sys.argv[1] == KEY:
    print("flag{%s}" % FLAG)

```

`FLAG` ã®ç®‡æ‰€ã‚’æ™®é€šã«è©•ä¾¡ã™ã‚Œã°OKã€‚

```python
% python
>>> chr(51)+chr(70)+chr(120)+chr(89)+chr(70)+chr(109)+chr(52)+chr(117)+chr(84)+chr(89)+chr(68)+chr(70)+chr(70)+chr(122)+chr(109)+chr(98)+chr(51)
'3FxYFm4uTYDFFzmb3'
```

<aside>
â›³ flag{3FxYFm4uTYDFFzmb3}

</aside>

### Where Is the Legit Flag?

<img src="/img/2024/02-25/Untitled%2022.png" width="550px" height="auto">

ã‚³ãƒ¼ãƒ‰ã¯ã“ã‚Œã€‚

```python

exec(chr(105)+chr(109)+chr(112)+chr(111)+chr(114)+chr(116)+chr(32)+chr(122)+chr(108)+chr(105)+chr(98)+chr(44)+chr(32)+chr(98)+chr(97)+chr(115)+chr(101)+chr(54)+chr(52))
**TANAKA = "eJyNVG1320QT/Z5z8h+GhNYvcR35JZZdaCGhT6D0gQTiFKjjlpU0ljZe7272xYpoy2/vrJRA+MA56IOPrJ29e+feO7sP84JJ2CohsEqYELBlktsCWM64tA6E3+gKEjSm6u/uXBzPz+AZtBY/vRx91Unffv908vOrw9PXz7/E23h/nf2mtp9/Gz05fn9zbv8sB18f/P7DWa9o/5/1f/Hf6KMlhzfJ9YvZ/x4NKzk185PNF6vud3uf/Xjx0eV/PLsUvz4ev/tw1bq6au3u7MNxorYIK5Yi4K0WRAhWyoAuKstTJiDDlFuuZB9C9WvOwEq2RpBsg2CUlxk4Is5XPIXEMGubwlNqVpVc5mB9nqN1BAG2LjeYM5OFpRVumCAUTPF+31yVtAhb+oB0OLcsN4ikjUTmCih8jqCVoSODUpdvLl+9JK0W8fhJdBD1dnfg7pnG3UGPS9ceT7vdQYdW9uFstQLtjVYWQTBiwiwYb6hJ65jDDUpHoPcIYfP03ahTo4yG/Sg8zb/WaNwKkPel8QQeQ3R7etqLh/CB3qKoF8/gbfO2mBwtF9GypvDCm9D4WipHbYsKLCP1S4MuLTADmzISw6gyiHGP3h52euMY+ArmxpNLguhHNY/B8JBaG0TwCAaDnjJZOy1MezjpPCQ3ig6O7pQ4HHYJa9adLQMXOBfeglMIFp0jH0pOCm8ZBZJSialrHIGLQJECnFmwBQqSvqk0zLkKtFGZT5GEo9Iz7yzPSF3MLUhynYw0NpximLzxXISmWchCU39soWRiDZqRHE04eF64lRfAsi0n2JrCCdaomlXBowBGKU0qMtFQHNYYpmYfzgPzBAu25SHAiv65Jk1esoT6K9TmDhCON4psoLhT7FO1aXKfKhnOqR3ykjwq6Zs3pslFG8K+hqXVzKzJLWVSmuJ6gqxWQY7cMF0fEqRvtWjLpSTIJr3XWFKo00Jp6oXoZaiRVqklmh8RNAy7+uHnWhGhf33ai7/9DQ5xWfeRlJiA4wiKkl544yjYoZu7S2XBl38h/Ldd4SbglAZoJu3hoRRHDs9hHA+nT/9Bhp7EIFs//OhoRoej8WQSQxemo3h69HBV02mu7Q5H46M4no46tUPzgqTOC7jxiBIytiF6YAXXGk1Ve8YMt3WQls2OkyqEKQyzUXRBhYwqT83QQKGjJVtQbVN6pike3CFUoVIijV7SZMx6wk/CjUzXcfCxIbe3Eip/P91e46z0MtGz6fjjHmHt7nwCLpe/Qg=="**
TAKAHASHI = [0x7a,0x7a,0x7a,0x12,0x18,0x12,0x1d,0x12,0x07,0x7b,0x36,0x37,0x3c,0x30,0x36,0x37,0x67,0x65,0x31,0x7d,0x67,0x65,0x36,0x20,0x32,0x31,0x7b,0x20,0x20,0x36,0x21,0x23,0x3e,0x3c,0x30,0x36,0x37,0x7d,0x31,0x3a,0x3f,0x29,0x7b,0x30,0x36,0x2b,0x36]
exec(bytes([WATANABE ^ 0b01010011 for WATANABE in reversed(TAKAHASHI)]))
```

ã‚ã‚“ã©ãã•â€¦

`TANAKA` ã‚’CyberChefã§Base64ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹ã¨ã€Zlibå±•é–‹ã™ã‚‹ã“ã¨ã¾ã§ææ¡ˆã—ã¦ãã‚ŒãŸã€‚

<img src="/img/2024/02-25/Untitled%2023.png" width="auto" height="auto">

å±•é–‹çµæœã¯ã“ã‚“ãªæ„Ÿã˜ã€‚

```python
# Than volleyball vanish against lumpy berry.
SATO = '[QI3?)c^J:6RK/FV><ex7#kdYov$G0-A{qPs~w1@+`MO,h(La.WuCp5]i ZbjD9E%2yn8rTBm;f*H"!NS}tgz=UlX&4_|\'\\'
# Above face explain for physical decision. 
# Via snake name round terrific brass. 
# Following suggestion sound regarding female recess. 
# Toward vessel disagree beneath huge porter.
SUZUKI = [74-0+0,
        87*1,int(48**1),
# Off purpose land as rural statement.
        int(8_3),int(32.00000),int('34'),
        76 & 0xFF,72 | 0x00,79 ^ 0x00,[65][0],
# During knot rely save wretched scarecrow. 
        (2),47 if True else 0,int(12/1),10 % 11,ord(chr(26)),
        30+5,int(48/2*2),9*9]
#  Plus toe settle with vast insect. 
#  Save hands shelter with ratty produce.
#  Outside legs nest versus tranquil relation.
#  As walk pat round rightful advice. 
# Beside payment train by large key.
# Past behavior post toward unable home. 
#  Among place complain considering unknown current.
**( #  Around spark scorch above spotty grape. 
    ''#  Underneath jewel chop past dependent rifle.
    .    join                          ([
        #  Since cobweb tie off hurt string.
SATO[i]         #  Since cobweb tie off hurt string.
for i in SUZUKI
        # if i > 4728:
        #     break
        # t = 234667 * 83785
        # print(t/3457783)
#  Through queen dam of slippery comparison.
])**
#  By wall stroke without secret wash.
)
#  Opposite yoke need beside superb lumber. 
print("flog{8vje9wunbp984}")
```

å¤ªå­—ã«ã—ãŸéƒ¨åˆ†ã€è©•ä¾¡ã¯ã—ã¦ã„ã‚‹ã‘ã©å‡ºåŠ›ã—ã¦ã„ãªã„ã€‚ã“ã‚Œã‚’printã—ã¦ã¿ã‚‹ã¨ãƒ•ãƒ©ã‚°ã€‚

<aside>
â›³ flag{PHmN2ILK6vsa}

</aside>

### Utter Darkness

<img src="/img/2024/02-25/Untitled%2024.png" width="550px" height="auto">

ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ã—ã¦ã‚¹ãƒ†ã‚¬ãƒã‚°ãƒ©ãƒ•ã‚£ãƒ¼ã€‚é’ç©ºç™½çŒ«ã«ã‹ã‘ã¦ãƒ•ã‚£ãƒ«ã‚¿ã‚’ãƒãƒãƒãƒã—ã¦ãŸã‚‰ãƒ•ãƒ©ã‚°ã€‚

<aside>
â›³ flag{YjM5MDUyYzAxMj}

</aside>

### Serial Port Signal (è§£ã‘ãªã‹ã£ãŸ ğŸ˜­)

<img src="/img/2024/02-25/Untitled%2025.png" width="550px" height="auto">

20ãƒã‚¤ã‚¯ãƒ­ç§’æ¯ã« 0/1 ãŒä¸¦ã‚“ã CSVã€‚ãƒ¢ãƒ¼ãƒ«ã‚¹ã‹â€¦? ãƒ“ãƒƒãƒˆåˆ—â†’ASCIIã‹â€¦ï¼Ÿ

ã“ã­ãã‚Šå›ã—ãŸã‘ã©å…¨ç„¶ã†ã¾ãã„ã‹ãšã€ä¸¡æ–¹ã¨ã‚‚ãƒ’ãƒ³ãƒˆã‚’è¦‹ãŸã€‚

> ã‚·ãƒªã‚¢ãƒ«é€šä¿¡ã®æ–¹å¼ã¯ UART ã¦ã‚™ã™ã€‚
>

> ãƒ›ã‚™ãƒ¼ãƒ¬ãƒ¼ãƒˆã¯ 9600ã€ãƒ†ã‚™ãƒ¼ã‚¿é•·ã¯ 7 bitã€ãƒã‚šãƒªãƒ†ã‚£ã¯å¶æ•°ã€ã‚¹ãƒˆãƒƒãƒ•ã‚šãƒ’ã‚™ãƒƒãƒˆã¯ 1 ã¦ã‚™ã™ã€‚
>

æ®‹ã‚Šæ™‚é–“ã‚ãšã‹ã ã—ãƒ—ãƒ­ã‚°ãƒ©ãƒ æ›¸ããŸããªã„ã—ã€ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã®ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼æ¢ã—ãŸã‚ŠCopilotã«é ‘å¼µã£ã¦ã‚‚ã‚‰ã£ãŸã‚Šã—ãŸã‘ã©ç„¡ç†ã ã£ãŸã€‚

---

å…ˆäººã®writeupâ†“ã‚’æ‹è¦‹ã™ã‚‹ã€‚

[é˜²è¡›çœã‚µã‚¤ãƒãƒ¼ã‚³ãƒ³ãƒ†ã‚¹ãƒˆ 2024 writeup - st98 ã®æ—¥è¨˜å¸³ - ã‚³ãƒ”ãƒ¼](https://nanimokangaeteinai.hateblo.jp/entry/2024/02/25/210059#Miscellaneous-30-Serial-Port-Signal-14-solves)

è¨˜è¼‰ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œã™ã‚‹ã¨ã€

```python
JXXHello UART: synt{IjUZC5TD}
```

ã®å‡ºåŠ›ãŒå‡ºã‚‹ã€‚ROT13ã£ã½ã„ã®ã§CyberChefã«ã‹ã‘ã‚‹ã¨ã€ãƒ•ãƒ©ã‚°ã€‚

<aside>
â›³ flag{VwHMP5GQ}

</aside>

## Network (NW)

### Discovery

<img src="/img/2024/02-25/Untitled%2026.png" width="550px" height="auto">

ã¾ãšã¯nmapã€‚

```python
% sudo nmap -sS -T4 10.10.10.21
Starting Nmap 7.94 ( https://nmap.org ) at 2024-02-25 23:16 JST
Nmap scan report for schatzsuche.ctf (10.10.10.21)
Host is up (0.016s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 0.45 seconds
```

HTTPãŒç©ºã„ã¦ã„ã‚‹ã®ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹ã€‚

[http://schatzsuche.ctf/](http://schatzsuche.ctf/) ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ã®ã§ã€ `/etc/hosts` ã«

```python
10.10.10.21 schatzsuche.ctf
```

ã‚’æ›¸ãè¶³ã—ã¦å†åº¦ã‚¢ã‚¯ã‚»ã‚¹ã€‚

è¦‹ãŸç›®çš„ã«ã‚‚ä½•ã‚‚ãªã„ã—å…¥åŠ›ç®‡æ‰€ã‚‚ãªã„ã€‚ffufã—ã¾ã™ã€‚

```python
% ffuf -w /usr/share/wordlists/SecLists/Discovery/Web-Content/common.txt -u http://schatzsuche.ctf/FUZZ
...
[Status: 200, Size: 268, Words: 8, Lines: 6, Duration: 7ms]
    * FUZZ: .well-known/security.txt

**[Status: 301, Size: 162, Words: 5, Lines: 8, Duration: 7ms]
    * FUZZ: cmsadmin**

**[Status: 301, Size: 162, Words: 5, Lines: 8, Duration: 7ms]
    * FUZZ: ftp**

[Status: 200, Size: 428, Words: 67, Lines: 8, Duration: 6ms]
    * FUZZ: index.html

[Status: 200, Size: 4700, Words: 793, Lines: 141, Duration: 7ms]
    * FUZZ: robots.txt

:: Progress: [4723/4723] :: Job [1/1] :: 4347 req/sec :: Duration: [0:00:01] :: Errors: 0 ::
...
```

/ftp ã‚’è¾¿ã‚‹ã¨ã€ `credentials.txt` ãŒæ‰‹ã«å…¥ã‚‹ã€‚

ãã®ä¸­ã« /cmsadmin ã®CMSã«å…¥ã‚Œã‚‹ID/passãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã€‚

ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®infoçš„ãªã¨ã“ã‚ã‹ã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚ã‹ã‚‹ã€‚

<aside>
â›³ flag{9.2.2.0, Revision: 14877}

</aside>

### Exploit

<img src="/img/2024/02-25/Untitled%2027.png" width="550px" height="auto">

CMSã‚ˆã‚ã—ã .php ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã„ã˜ã‚Œã‚‹æ§˜å­ã€‚reverse shellã®PHPã‚’ä»•è¾¼ã‚‚ã†ã¨ã—ãŸã‘ã©ã€ä»•è¾¼ã‚“ã PHPã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚‚PHPã§å®Ÿè¡Œã•ã‚Œãšã«ãƒ™ã‚¿æ›¸ãHTMLã¨ã—ã¦é…ä¿¡ã•ã‚Œã¦ã„ã‚‹â€¦ï¼Ÿ

å‹•çš„å®Ÿè¡Œã®è¨­å®šã‚’å¤‰ãˆã‚ˆã†ã«ã‚‚ã€ä»Šã®IDã ã¨ãã®æ¨©é™ãŒãªã„æ¨¡æ§˜ã€‚

æ‚©ã‚“ã§ã„ã‚‹ã¨ã€è‡ªåˆ†ã®æ›¸ã„ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒã©ã‚“ã©ã‚“æ›¸ãæ›ã‚ã‚‹ã€‚ã©ã†ã‚„ã‚‰ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨åŒã˜ç’°å¢ƒã§ä¸Šæ›¸ãã—ã¾ãã£ã¦ã„ã‚‹ã‚ˆã†ã€‚ãªã‚“ãã‚Œï¼Ÿ

èª°ã‹ãŒä»•è¾¼ã‚“ã§ãã‚ŒãŸã€ãƒ•ã‚©ãƒ¼ãƒ ã« `?cmd=` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼æ›¸ãã¨ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å®Ÿè¡Œã—ã¦å‡ºåŠ›è¦‹ã›ã¦ãã‚‹ã‚„ã¤ã«é‹ã‚ˆãã‚¢ã‚¯ã‚»ã‚¹ã§ããŸã®ã§ã€

```python
find / -name '*.txt'
cat /var/www/flag.txt
```

ã—ã¦ãƒ•ã‚£ãƒ‹ãƒƒã‚·ãƒ¥ã€‚PHPå®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ã‚ã‚Œã©ã†ã‚„ã£ãŸã‚“ã ã‚ã†ï¼Ÿ

<aside>
â›³ flag{G3t_R3v3rs3_Sh3ll}

</aside>

### Pivot

<img src="/img/2024/02-25/Untitled%2028.png" width="550px" height="auto">

sshã§ãã‚‹ã€‚ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« root ã‚ªãƒ¼ãƒŠãƒ¼ã®ãƒ•ãƒ©ã‚°ã‚ã‚‹ï¼ˆã‚‚ã¡ã‚ã‚“èª­ã‚ãªã„ï¼‰ã€‚

OSCPçŸ¥è­˜çš„ã«ã¯ linpeas åˆºã—ã¦å¼±ã„æ‰€è¦‹ã¤ã‘ã¦rootå–ã£ã¦çµ‚äº†ã€‚â€¦ ã¨æ€ã£ãŸã‚‰ã€ãªã‚“ã¨georgeã•ã‚“è‡ªåˆ†ã®ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚‚ `/tmp/` ã«ã‚‚æ›¸ãè¾¼ã¿ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã€‚ãã‚“ãªâ€¦

ã—ã‹ã—SUIDãƒ“ãƒƒãƒˆç«‹ã£ã¦ã‚‹å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã§rootãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ãƒ•ãƒ©ã‚°èª­ã‚€ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚OSCPã‚ã‚‹ã‚ã‚‹ã€‚

```python
george@330bb6afc5ef:~$ find / -perm -u=s -type f 2>/dev/null
/usr/bin/base64
```

ãªã‚“ã‹çã—ã„ã®ãŒå¼•ã£ã‹ã‹ã£ãŸãªã€‚

base64ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¯¾è±¡ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã§ãã‚‹ã®ã§ã€ã“ã‚Œã§ãƒ•ãƒ©ã‚°å¾—ã‚‰ã‚Œã‚‹(ï¼Ÿ)

```python
george@330bb6afc5ef:~$ /usr/bin/base64 secrets.txt
W01hcmlhREIgQWNjZXNzIEluZm9ybWF0aW9uXQpkYl91c2VyCkg0UmliMF85MGxkQjRSRU4K
```

ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹ã¨â€¦

```python
[MariaDB Access Information]
db_user
H4Rib0_90ldB4REN
```

ãã€œ

---

MariaDBã‚’æ¢ã›ã°è‰¯ã•ãã†ã€‚ã—ã‹ã—VPNå‚åŠ ã—ã¦ã„ã‚‹ãƒã‚·ãƒ³ã‹ã‚‰nmapã—ã¦ã‚‚è¦‹ã¤ã‹ã‚‰ãªã„ã€‚

CMSã¯DBã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚‹ã¯ãšãªã®ã§ã€Discovery, Exploitã®å•é¡Œã§å…¥ã£ãŸç®¡ç†ç”»é¢ã§infoçš„ãªã¨ã“ã‚ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€ï¼ˆCMSã‚µãƒ¼ãƒãƒ¼ã«ã¨ã£ã¦ã®ï¼‰ `ctfbox_mariadb_1` (192.168.32.2ã«è§£æ±ºã•ã‚Œã‚‹) ã¨ã„ã†ãƒ›ã‚¹ãƒˆã‚’ç™ºè¦‹ã€‚

ã“ã“ã«mysqlãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚Œã°ã‚ˆã„ã®ã ãŒã€ `mysql` ã‚³ãƒãƒ³ãƒ‰ã¯ãªã„ã—ã€ `python3` ã‚„ã‚‰ `perl` ã«ã‚‚MySQLãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’å–‹ã‚Œã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ãªã„ã€‚

ãƒ’ãƒ³ãƒˆã‚’è¦‹ã‚‹ã€‚

> SSH ã‚µãƒ¼ãƒã‚™ãƒ¼ã¦ã‚™å®Ÿè¡Œã¦ã‚™ãã‚‹ã‚³ãƒãƒ³ãƒˆã‚™ã¯å°‘ãªã„ã¦ã‚™ã™ã‹ã‚™ã€ãƒ›ã‚šãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ†ã‚™ã‚£ãƒ³ã‚¯ã‚™ã‚’åˆ©ç”¨ã™ã‚Œã¯ã‚™ã†ã¾ãã„ãã¯ã™ã‚™ã¦ã‚™ã™ã€‚
>

ã‚ã‚ã‚ã‚ã‚ãã£ã‹ã‚ã‚ã‚ã‚ã‚ã‚ã‚

ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã†ã‚è¦šãˆã ãŒã€VPNå‚åŠ ã—ã¦ã„ã‚‹æ”»æ’ƒãƒã‚·ãƒ³ã‹ã‚‰ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã£ã¦æ¥ç¶šã§ããŸã€‚

```python
% ssh -L3307:192.168.32.2:3306 george@10.10.10.21
% mysql -h 127.0.0.1 -P 3307 -u db_user --password=H4Rib0_90ldB4REN
```

ã‚ã¨ã¯ãƒ†ãƒ¼ãƒ–ãƒ«ã¾ã§ãŸã©ã‚Šç€ãã ã‘ã€‚

```python
MariaDB [(none)]> show databases;
+--------------------+
| Database           |
+--------------------+
| flag5              |
| information_schema |
+--------------------+
2 rows in set (0.017 sec)

MariaDB [(none)]> use flag5
Database changed

MariaDB [flag5]> show tables;
+-----------------+
| Tables_in_flag5 |
+-----------------+
| flag            |
+-----------------+
1 row in set (0.007 sec)

MariaDB [flag5]> select * from flag;
+----+------------------------+
| id | flag                   |
+----+------------------------+
|  1 | **flag{p!V071ng_M31s73r}** |
+----+------------------------+
```

<aside>
â›³ flag{p!V071ng_M31s73r}

</aside>

### FileExtract

<img src="/img/2024/02-25/Untitled%2029.png" width="550px" height="auto">

Wiresharkã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§FTPã‹ã‚‰ .zip ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€‚ã ãŒãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä»˜ãzipã€‚
[ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä»˜ãzipã®ã‚¯ãƒ©ãƒƒã‚¯ with john - Notion](https://laysakura.notion.site/CTF-forensics-bb9a10ec17134b6c86ba5cd91c4f33d1#6096ebfa313b4b56b992cf80e2ecc5ee) ã§ã‚‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç‰¹å®šã§ããšã€‚

Follow TCP Streams ã§FTPã‚µãƒ¼ãƒãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒè¦‹ãˆã‚‹ã®ã§ã€ãã‚Œã§è©¦ã™ã¨å±•é–‹ã§ããŸã€‚

<aside>
â›³ flag{6qhFJSHAP4A4}

</aside>

### Do tHe best (è§£ã‘ãªã‹ã£ãŸ ğŸ˜­)

HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ã‹ã‚‰ã€[https://github.com/m13253/dns-over-https](https://github.com/m13253/dns-over-https) ãŒãƒ’ãƒ³ãƒˆã§ã‚ã£ã¦ã€DNS over HTTPSã®å•é¡Œã§ã‚ã‚‹ã“ã¨ã¯ã‚ã‹ã£ãŸã€‚ä¾‹ãˆã°ä»¥ä¸‹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯é€šã‚‹ã€‚

```bash
% curl --insecure -H 'accept: application/dns-json' 'https://10.10.10.20/dns-query?name=example.com&type=A'
{"Status":0,"TC":false,"RD":true,"RA":true,"AD":false,"CD":false,"Question":[{"name":"example.com.","type":1}],"Authority":[{"name":"example.com.","type":6,"TTL":86400,"Expires":"Mon, 26 Feb 2024 14:45:17 UTC","data":"ns.example.com. hostmaster.examle.com. 2024120101 10800 3600 604800 86400"}]
```

ã—ã‹ã—æ™‚é–“ã‚‚ãªãã“ã‚Œä»¥ä¸Šæ‰‹ãŒå‡ºã›ãšâ€¦

---

é€†å¼•ããŒæ­£è§£ã ã£ãŸæ¨¡æ§˜ã€‚ã†ã‚ãƒ¼Nå¹´å‰ã«digã§ã‚„ã£ãŸã“ã¨ã‚ã‚‹ï¼

```bash
% curl  --insecure -H 'accept: application/dns-json' 'https://10.10.10.20/dns-query?name=20.10.10.10.in-addr.arpa&type=PTR'
{"Status":0,"TC":false,"RD":true,"RA":true,"AD":false,"CD":false,"Question":[{"name":"20.10.10.10.in-addr.arpa.","type":12}],"Answer":[{"name":"20.10.10.10.in-addr.arpa.","type":12,"TTL":86400,"Expires":"Mon, 26 Feb 2024 14:47:09 UTC","data":"**DSb-mt8ZVRtTCL97PDL4rRQxc3TbZ-gu.example.com**."}]}
```

å¾—ã‚‰ã‚ŒãŸãƒ›ã‚¹ãƒˆã‚’æŒ‡å®šã—ã¦HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãƒ•ãƒ©ã‚°ã€‚

```bash
% curl --insecure -H 'Host: DSb-mt8ZVRtTCL97PDL4rRQxc3TbZ-gu.example.com' https://10.10.10.20
<!DOCTYPE html>
<html>
<head>
<title>DO tHe best</title>
<style>
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
</style>
</head>
<body>
        <h1>**flag{8NZfrhDH-ZGe}**</h1>
</body>
</html>
```

<aside>
â›³ flag{8NZfrhDH-ZGe}

</aside>

ã“ã‚Œã¯æ™‚é–“ã‹ã‘ãŸã‚‰è§£ã‘ãŸã‹ã‚‚ãªâ€¦

## Programming

å¤§ä½“CopilotãŒã‚„ã‚Šã¾ã—ãŸ

### Logistic Map

<img src="/img/2024/02-25/Untitled%2030.png" width="550px" height="auto">

Copilotã«ä»¥ä¸‹ã®ãŠé¡˜ã„ã€‚

```bash
ä¸‹è¨˜ã®ãƒ­ã‚·ã‚™ã‚¹ãƒ†ã‚£ãƒƒã‚¯å†™åƒã«ã¤ã„ã¦ã€x_0 = 0.3 ã‚’ä¸ãˆãŸæ™‚ã® x_9999 ã®å€¤ã‚’æ±‚ã‚ã€å°æ•°ç¬¬7ä½ã¾ã¦ã‚™ã®å€¤ã‚’ç­”ãˆã¦ããŸã‚™ã•ã„ã€‚ãªãŠã€å€¤ã®ä¿æŒã¨è¨ˆç®—ã«ã¯å€ç²¾åº¦æµ®å‹•å°æ•°ç‚¹æ•°ã‚’ä½¿ç”¨ã—ã¦ããŸã‚™ã•ã„ã€‚

x_{n+1} = 3.99 x_n (1 - x_n)
```

ã“ã‚“ãªã‚³ãƒ¼ãƒ‰ã‚’åã„ãŸã€‚ä¸€ç™ºæˆåŠŸã€‚

```python
def logistic_map(x0, r, n):
    x = x0
    for _ in range(n):
        x = r * x * (1 - x)
    return x

x0 = 0.3
r = 3.99
n = 9999

result = logistic_map(x0, r, n)
print(f"The value of x_{n}: {result}")
```

```python
% python solve.py
The value of x_9999: 0.8112735079776592
```

<aside>
â›³ flag{0.8112735}

</aside>

### Randomness Extraction

<img src="/img/2024/02-25/Untitled%2031.png" width="550px" height="auto">

ã‚°ã‚°ã£ã¦â†“ã‚’ç™ºè¦‹ã€‚

[](https://github.com/MayankKharbanda/randomness_extractors/blob/master/neumann/von_neumann.py)

ã“ã„ã¤ã‚’å®Ÿè¡Œã™ã‚‹ã€‚

```bash
% python3 von_neumann.py -i random.dat # output.bin ãŒã§ãã‚‹
% file output.bin
output.bin: data
```

å¾—ä½“ãŒçŸ¥ã‚Œãªã„ã®ã§ãƒã‚¤ãƒŠãƒªã‚’çœºã‚ã‚‹ã€‚

```bash
% xxd output.bin
```

<img src="/img/2024/02-25/Untitled%2032.png" width="auto" height="auto">

ãŸã¾ãŸã¾ãƒ•ãƒ©ã‚°ãŒç›®ã«ã¤ã„ãŸã€‚å†´ãˆã¦ãŸã€‚

<aside>
â›³ flag{3TcPs8QFcX}

</aside>

### XML Confectioner

<img src="/img/2024/02-25/Untitled%2033.png" width="550px" height="auto">

Copilotãƒ‹ã‚­ã®å‡ºç•ªã€‚

```bash
æ·»ä»˜ã® sweets.xml ã«ã¯ã€å¤šæ•°ã® sweets:batch è¦ç´ ã‹ã‚™å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ä¸­ã‹ã‚‰ã€ä¸‹è¨˜ã®æ¡ä»¶ã™ã¸ã‚™ã¦ã‚’æº€ãŸã™ sweets:batch è¦ç´ å†…ã«ãŠã„ã¦ã€æœ€ã‚‚ cookie:radius å±æ€§ã‹ã‚™å¤§ããª sweets:cookie è¦ç´ ã®å†…å®¹ã‚’æ¢ã—ã¦printã—ã¦ããŸã‚™ã•ã„ã€‚

1. å°‘ãªãã¨ã‚‚äºŒã¤ã®å­è¦ç´  sweets:icecream ã‹ã‚™å«ã¾ã‚Œã‚‹
2. å­è¦ç´  sweets:icecream ã«ã¯ icecream:amount å±æ€§ã®å€¤ã‹ã‚™ 105g ã‚’ä¸‹å›ã‚‹ã‚‚ã®ã‹ã‚™ãªã„
3. å­è¦ç´  sweets:candy ã® candy:weight å±æ€§ã®å€¤ã®åˆè¨ˆã‹ã‚™ 28.0g ä»¥ä¸Šã¦ã‚™ã‚ã‚‹
4. å­è¦ç´  sweets:candy ã® candy:shape å±æ€§ã‹ã‚™ 5 ç¨®é¡ä»¥ä¸Šå«ã¾ã‚Œã‚‹
5. cookie:kind å±æ€§ã‹ã‚™ icing ã¦ã‚™ã‚ã‚Šã‹ã¤ cookie:radius å±æ€§ã‹ã‚™ 3.0cm ä»¥ä¸Šã®å­è¦ç´  sweets:cookie ã‚’å°‘ãªãã¨ã‚‚ä¸€ã¤å«ã‚€

ä»¥ä¸‹ãŒ sweets.xml ã®å†’é ­éƒ¨åˆ†ã§ã™ã€‚

<?xml version='1.0' encoding='utf-8'?>
<sweets:orders xmlns:icecream="<http://xml.vlc-cybercontest.com/icecream>"
    xmlns:candy="<http://xml.vlc-cybercontest.com/candy>"
    xmlns:cookie="<http://xml.vlc-cybercontest.com/cookie>"
    xmlns:sweets="<http://xml.vlc-cybercontest.com/sweets">>
    <sweets:batch sweets:id="0x1E24A4AE">
        <sweets:icecream icecream:id="0x9F78027" icecream:flavor="strawberry" icecream:amount="94.1164575g" icecream:shape="sphere" />
        <sweets:icecream icecream:id="0xB9F4B823" icecream:flavor="strawberry" icecream:amount="91.8668061g" icecream:shape="sphere" />
        <sweets:candy candy:id="0x8C55D4CE" candy:kind="coffee" candy:weight="3.9366492g" candy:shape="tetrahedron" />
        <sweets:candy candy:id="0x9D8BBA94" candy:kind="soda" candy:weight="3.7906460g" candy:shape="octahedron" />
        <sweets:candy candy:id="0xB81F4174" candy:kind="coffee" candy:weight="3.3636170g" candy:shape="sphere" />
        <sweets:cookie cookie:id="0xFB7C6DE7" cookie:kind="checker" cookie:radius="3.2564663cm">flag{TkzPn3ZKL28zJXn7}</sweets:cookie>
        <sweets:cookie cookie:id="0x26C3166A" cookie:kind="icing" cookie:radius="3.0929699cm">flag{MbfkAZTVpc6bMrz9}</sweets:cookie>
    </sweets:batch>
```

å‰²ã¨è‰¯ã„ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ãã‚ŒãŸã®ã ãŒã€namespaceã®éƒ¨åˆ†ãŒæ­£ã—ããªã‹ã£ãŸã®ã§æ‰‹ä¿®æ­£ã€‚

```python
# import xml.etree.ElementTree as ET
import lxml.etree as ET

def parse_sweets(file):
    tree = ET.parse(file)
    root = tree.getroot()

    max_radius = 0
    max_cookie = None

    for batch in root.findall(".//sweets:batch", root.nsmap):
        icecreams = batch.findall(".//sweets:icecream", root.nsmap)
        candies = batch.findall(".//sweets:candy", root.nsmap)
        cookies = batch.findall(".//sweets:cookie", root.nsmap)

        # 1. å°‘ãªãã¨ã‚‚äºŒã¤ã®å­è¦ç´  sweets:icecream ã‹ã‚™å«ã¾ã‚Œã‚‹
        if len(icecreams) < 2:
            continue

        # 2. å­è¦ç´  sweets:icecream ã«ã¯ icecream:amount å±æ€§ã®å€¤ã‹ã‚™ 105g ã‚’ä¸‹å›ã‚‹ã‚‚ã®ã‹ã‚™ãªã„
        if any(
            float(
                ic.get("{http://xml.vlc-cybercontest.com/icecream}amount").rstrip("g")
            )
            < 105
            for ic in icecreams
        ):
            continue

        # 3. å­è¦ç´  sweets:candy ã® candy:weight å±æ€§ã®å€¤ã®åˆè¨ˆã‹ã‚™ 28.0g ä»¥ä¸Šã¦ã‚™ã‚ã‚‹
        if (
            sum(
                float(
                    c.get("{http://xml.vlc-cybercontest.com/candy}weight").rstrip("g")
                )
                for c in candies
            )
            < 28.0
        ):
            continue

        # 4. å­è¦ç´  sweets:candy ã® candy:shape å±æ€§ã‹ã‚™ 5 ç¨®é¡ä»¥ä¸Šå«ã¾ã‚Œã‚‹
        if (
            len(
                set(
                    c.get("{http://xml.vlc-cybercontest.com/candy}shape")
                    for c in candies
                )
            )
            < 5
        ):
            continue

        for cookie in cookies:
            # 5. cookie:kind å±æ€§ã‹ã‚™ icing ã¦ã‚™ã‚ã‚Š...
            if cookie.get("{http://xml.vlc-cybercontest.com/cookie}kind") == "icing":
                radius = float(
                    cookie.get("{http://xml.vlc-cybercontest.com/cookie}radius").rstrip(
                        "cm"
                    )
                )
                # ã‹ã¤ cookie:radius å±æ€§ã‹ã‚™ 3.0cm ä»¥ä¸Šã®å­è¦ç´  sweets:cookie ã‚’å°‘ãªãã¨ã‚‚ä¸€ã¤å«ã‚€
                if radius >= 3.0:
                    [
                        print(ET.tostring(cookie, encoding="unicode"))
                        for cookie in cookies
                    ]

parse_sweets("sweets.xml")
```

â†“ã®å®Ÿè¡Œçµæœã‚’ä¸Šã‹ã‚‰è©¦ã™ã¨ãƒ•ãƒ©ã‚°ã ã£ãŸã€‚

```python
% python solve.py
<sweets:cookie xmlns:sweets="http://xml.vlc-cybercontest.com/sweets" xmlns:cookie="http://xml.vlc-cybercontest.com/cookie" xmlns:icecream="http://xml.vlc-cybercontest.com/icecream" xmlns:candy="http://xml.vlc-cybercontest.com/candy" cookie:id="0x6937BAA7" cookie:kind="languedechat" cookie:radius="3.1418079cm">**flag{sZ8d5FbntXbL9uwP}**</sweets:cookie>

<sweets:cookie xmlns:sweets="http://xml.vlc-cybercontest.com/sweets" xmlns:cookie="http://xml.vlc-cybercontest.com/cookie" xmlns:icecream="http://xml.vlc-cybercontest.com/icecream" xmlns:candy="http://xml.vlc-cybercontest.com/candy" cookie:id="0x19A83890" cookie:kind="checker" cookie:radius="3.0552874cm">flag{QxNFv5q9gtnvaXEc}</sweets:cookie>

<sweets:cookie xmlns:sweets="http://xml.vlc-cybercontest.com/sweets" xmlns:cookie="http://xml.vlc-cybercontest.com/cookie" xmlns:icecream="http://xml.vlc-cybercontest.com/icecream" xmlns:candy="http://xml.vlc-cybercontest.com/candy" cookie:id="0xB43E03AC" cookie:kind="icing" cookie:radius="3.1110701cm">flag{YXBbN3zpqxJy8CvA}</sweets:cookie>

<sweets:cookie xmlns:sweets="http://xml.vlc-cybercontest.com/sweets" xmlns:cookie="http://xml.vlc-cybercontest.com/cookie" xmlns:icecream="http://xml.vlc-cybercontest.com/icecream" xmlns:candy="http://xml.vlc-cybercontest.com/candy" cookie:id="0x9F045677" cookie:kind="checker" cookie:radius="3.0090029cm">flag{28j3vnedw7BELQxU}</sweets:cookie>
```

<aside>
â›³ flag{sZ8d5FbntXbL9uwP}

</aside>

### Twisted Text

<img src="/img/2024/02-25/Untitled%2034.png" width="550px" height="auto">

Copilotã€œã€œã€œ

```python
Twisted.png ã‚’ãƒ”ã‚¯ã‚»ãƒ«ã”ã¨ã«å‡¦ç†ã—ã¦ã€fixed-Twisted.png ã‚’ä½œã£ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚

ãŸã ã—ã€ Twisted.png ã¯ã€ç”»åƒã®ä¸­å¿ƒã‹ã‚‰ã®è·é›¢ r [pixel] ã«å¯¾ã—ã¦

Î¸ = - (r ^ 2) / (250 ^ 2) [rad]
ãŸã‚™ã‘å›è»¢ã•ã‚Œã¦ã„ã¾ã™(åæ™‚è¨ˆå›ã‚Šã‚’æ­£ã¨ã—ã¾ã™)ã€‚é€†å¤‰æ›ã‚’æ–½ã—ã¦ fixed-Twsited.png ã‚’ä½œã£ã¦ãã ã•ã„ã€‚
```

ã¾ã‚ã¾ã‚ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ãã‚ŒãŸãŒã€åº§æ¨™å›è»¢ã®å¼ã‚’é–“é•ãˆã¦ã„ãŸã‚Šã—ãŸã€‚ä¿®æ­£ã—ãŸã®ãŒâ†“

```python
from PIL import Image
import numpy as np

def rotate_image(image_path, output_path):
    # ç”»åƒã‚’é–‹ã
    img = Image.open(image_path)
    width, height = img.size
    pixels = np.array(img)

    # æ–°ã—ã„ç”»åƒã®ãƒ”ã‚¯ã‚»ãƒ«ã‚’æ ¼ç´ã™ã‚‹é…åˆ—ã‚’ä½œæˆ
    new_pixels = np.zeros_like(pixels)

    # ç”»åƒã®ä¸­å¿ƒã‚’è¨ˆç®—
    center_x, center_y = width / 2, height / 2

    # å„ãƒ”ã‚¯ã‚»ãƒ«ã«å¯¾ã—ã¦
    for y in range(height):
        for x in range(width):
            # ä¸­å¿ƒã‹ã‚‰ã®è·é›¢ã‚’è¨ˆç®—
            dx, dy = x - center_x, y - center_y
            r = np.sqrt(dx**2 + dy**2)

            # è§’åº¦ã‚’è¨ˆç®—
            theta =  -(r**2) / (250**2)

            # æ–°ã—ã„ä½ç½®ã‚’è¨ˆç®—
            new_x = center_x + (x - center_x) * np.cos(theta) - (y - center_y) * np.sin(theta)
            new_y = center_y + (x - center_x) * np.sin(theta) + (y - center_y) * np.cos(theta)

#            print(f"({x}, {y}) -> ({new_x}, {new_y})")

            # æ–°ã—ã„ä½ç½®ãŒç”»åƒã®ç¯„å›²å†…ã«ã‚ã‚‹å ´åˆã€ãƒ”ã‚¯ã‚»ãƒ«ã‚’ç§»å‹•
            if 0 <= new_x < width and 0 <= new_y < height:
                new_pixels[int(new_y), int(new_x)] = pixels[y, x]

    # æ–°ã—ã„ç”»åƒã‚’ä½œæˆã—ã¦ä¿å­˜
    new_img = Image.fromarray(new_pixels)
    new_img.save(output_path)

# é–¢æ•°ã‚’å‘¼ã³å‡ºã™
rotate_image("Twisted.png", "fixed-Twisted.png")
```

å‡ºåŠ›ç”»åƒã¯â†“

<img src="/img/2024/02-25/Untitled%2035.png" width="auto" height="auto">

<aside>
â›³ flag{LHZGhq3WTXvo}

</aside>

## Trivia

### The Original Name of AES

<img src="/img/2024/02-25/Untitled%2036.png" width="550px" height="auto">

<aside>
â›³ flag{Rijndael}

</aside>

### CVE Record of Lowest Number

<img src="/img/2024/02-25/Untitled%2037.png" width="550px" height="auto">

ã‚°ã‚°ã‚‹ã¨ã€CVEã¯1999å¹´ã‹ã‚‰å§‹ã¾ã£ãŸæ¨¡æ§˜ã€‚ã¨ã„ã†ã“ã¨ã¯ CVE-1999-0001 ã‹ãªï¼Ÿ

[https://nvd.nist.gov/vuln/detail/CVE-1999-0001](https://nvd.nist.gov/vuln/detail/CVE-1999-0001)

ã‚ã‚Šã¾ã—ãŸã€‚exploitãŒã‚ã‚Šãã†ãªãƒªãƒ³ã‚¯ã‚’è¾¿ã‚‹ã¨â†“ã‚’ç™ºè¦‹ã€‚

[https://ftp.openbsd.org/pub/OpenBSD/patches/2.3/common/tcpfix.patch](https://ftp.openbsd.org/pub/OpenBSD/patches/2.3/common/tcpfix.patch)

ãƒ‘ãƒƒãƒä¸­ã®ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰ã€

<aside>
â›³ flag{ip_input.c}

</aside>

### MFA Factors

<img src="/img/2024/02-25/Untitled%2038.png" width="550px" height="auto">

ã‚ãƒ¼ã‚ã‚Œã§ã—ã‚‡ï¼Ÿã‚ã‚Œã‚ã‚Œ

- çŸ¥è­˜
- ä½“
- æ‰€æœ‰

ãªã‚“ã‹ã†ã‚è¦šãˆâ€¦ ã‚°ã‚°ã£ã¦å›ç­”ã€‚

<aside>
â›³ flag{æ‰€æŒãƒ»ç”Ÿä½“ãƒ»çŸ¥è­˜}

</aside>

## Web

### Browsers Have Local Storage

<img src="/img/2024/02-25/Untitled%2039.png" width="550px" height="auto">

`/` ã‹ã‚‰èª­ã¾ã‚Œã¦ã„ã‚‹JSãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ•ãƒ©ã‚°ã‚ã‚Šã€‚

<img src="/img/2024/02-25/Untitled%2040.png" width="auto" height="auto">

<aside>
â›³ FLAG{Th1s_1s_The_fIrst_flag}

</aside>

### Are You Introspective?

<img src="/img/2024/02-25/Untitled%2041.png" width="550px" height="auto">

Burp Suite Certified Practitioner è³‡æ ¼ã®ç·´ç¿’ã§æ­»ã¬ã»ã©ã‚„ã£ãŸã€‚

[Fuzz: Information disclosure / Access control / GraphQL (hidden api) / JWT / OAuth - Notion](https://laysakura.notion.site/Web-hack-Recon-044e89072597493b93e00cfd530019bb#eab8dcf67d7f4e8e8920fbb6e96d255f)

ã“ã“ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå€™è£œã‚’Burp Intruderã§ãƒãƒãƒã¨è©¦ã™ã¨ã€ `/v1/graphql` ã§ã„ã„æ„Ÿã˜ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ãã‚‹ã€‚

ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€å‹æ‰‹ã«ã‚¤ãƒ³ãƒˆãƒ­ã‚¹ãƒšã‚¯ã‚·ãƒ§ãƒ³ã‚¯ã‚¨ãƒªã‚’POSTã§æŠ•ã’ã¦ãã‚Œã‚‹ã€‚Graph*i*QLã®JSãŒã‚„ã£ã¦ãã‚Œã¦ã‚‹ã®ã‹ãªï¼Ÿ

POSTã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ãƒ•ãƒ©ã‚°ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã€‚

<img src="/img/2024/02-25/Untitled%2042.png" width="auto" height="auto">

<aside>
â›³ FLAG{Is_this_your_first_time_using_GraphQL}

</aside>

### Insecure

<img src="/img/2024/02-25/Untitled%2043.png" width="550px" height="auto">

ã¾ãšã¯ä¸ãˆã‚‰ã‚ŒãŸ testUser ã§ãƒ­ã‚°ã‚¤ãƒ³ã€‚

ãƒãƒãƒãƒã‚„ã£ã¦ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’è¡¨ç¤ºã€‚ã“ã‚“ãªæ„Ÿã˜ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆâ†’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã€‚

<img src="/img/2024/02-25/Untitled%2044.png" width="auto" height="auto">

ç„¡é‚ªæ°—ã« `id=0` ã¨ã‚„ã£ã¦Repeatã™ã‚‹ã¨ã€ `profile_error.php` ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¦ã—ã¾ã†ã€‚

<img src="/img/2024/02-25/Untitled%2045.png" width="auto" height="auto">

ï¼ˆè‰²ã€…è©¦è¡ŒéŒ¯èª¤ã—ã¦ãµã¨æ°—ã¥ãï¼‰ã“ã‚Œã€å¤±æ•—ã¯ã—ã¦ã‚‚ `profile_success.php` ã¯è£å´ã®å‡¦ç†ã§ç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã®ã§ã¯ï¼Ÿãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«ã‚¹ã‚³ãƒ¼ãƒ”ãƒ³ã‚°ã—ã¦ãªã„ã‹ã‚‚ã€‚ã¨æ€ã„è‡³ã‚‹ã€‚

ãƒ“ãƒ³ã‚´ã€‚

<img src="/img/2024/02-25/Untitled%2046.png" width="auto" height="auto">

ãƒœãƒ‡ã‚£ã®ä¸‹ã®æ–¹ã«ãƒ•ãƒ©ã‚°ãŒã‚ã‚‹ï¼ˆå€‹äººæƒ…å ±ã«è¦‹ãˆã‚‹æ–‡å­—åˆ—è¦‹ãˆã¡ã‚ƒã†ã®ã§ä¸Šã ã‘åˆ‡ã‚Šå‡ºã—ãŸï¼‰ã€‚

<aside>
â›³ FLAG{1qaz7ujmbgt5}

</aside>

### Variation (è§£ã‘ãªã‹ã£ãŸ ğŸ˜­)

<img src="/img/2024/02-25/Untitled%2047.png" width="550px" height="auto">

`<` ã¨ `>` ãŒæ¶ˆã•ã‚Œã¦ã—ã¾ã†ã®ã§ã€JSã‚’æ›¸ã‘ã‚‹æ–‡è„ˆã«æŒã¡è¾¼ã‚ãªã„ã€‚å…¨è§’ã® `ï¼œ` ãªã©è‰²ã€…è©¦ã™ãŒã†ã¾ãã„ã‹ãšã€‚

[é˜²è¡›çœã‚µã‚¤ãƒãƒ¼ã‚³ãƒ³ãƒ†ã‚¹ãƒˆ 2024 writeup - st98 ã®æ—¥è¨˜å¸³ - ã‚³ãƒ”ãƒ¼](https://nanimokangaeteinai.hateblo.jp/entry/2024/02/25/210059#Web-20-Variation-6-solves)

ã®writeupè¦‹ã‚‹ã¨ã€UTF-8ã¨ã„ã†ã“ã¨ã§3ãƒã‚¤ãƒˆç·å½“ãŸã‚Šã—ã¦ã„ã‚‹ã€‚è³¢ã„â€¦

`ï¹¤` ã¨ `ï¹¥` ãŒä½¿ãˆã‚‹æ¨¡æ§˜ã€‚

[http://10.10.10.32/greet?name=ï¹¤scriptï¹¥alert(1)ï¹¤/scriptï¹¥](http://10.10.10.32/greet?name=%EF%B9%A4script%EF%B9%A5alert(1)%EF%B9%A4/script%EF%B9%A5)

ã§ãƒ•ãƒ©ã‚°ã‚²ãƒƒãƒˆã€‚

<img src="/img/2024/02-25/Untitled%2048.png" width="auto" height="auto">

<aside>
â›³ FLAG{dfa23afjkl98}

</aside>

### Bruteforce

<img src="/img/2024/02-25/Untitled%2049.png" width="550px" height="auto">

å¥½ããªå•é¡Œã€‚

:8000 ã®æ–¹ã¯Basicèªè¨¼ã®æ‰‹ãŒã‹ã‚ŠãŒãªã„ã®ã§ã€ :5000 ã®æ–¹ã‚’ã‚½ãƒ¼ã‚¹ã‹ã‚‰è¦‹ã¦ã¿ã‚‹ã€‚

```python
from flask import Flask
from flask import jsonify
from flask import request

from flask_jwt_extended import create_access_token
from flask_jwt_extended import get_jwt_identity
from flask_jwt_extended import jwt_required
from flask_jwt_extended import JWTManager

app = Flask(__name__)

app.config["JWT_SECRET_KEY"] = "*************"
app.config["JWT_ACCESS_TOKEN_EXPIRES"] = False
app.config["JWT_REFRESH_TOKEN_EXPIRES"] = False
app.config["JWT_COOKIE_CSRF_PROTECT"] = False
app.config["JWT_ENCODE_NBF"] = False

jwt = JWTManager(app)

@app.route("/login", methods=["POST"])
def login():
    users = {}
    users['test'] = 'test'
    users['admin'] = '*************'
    username = request.json.get("username", None)
    print(username)
    password = request.json.get("password", None)
    print(password)
    if (not username in users) or (password != users[username]):
        return jsonify({"msg": "Bad username or password"}), 401

    access_token = create_access_token(identity=username)
    return jsonify(access_token=access_token)

@app.route("/protected", methods=["POST"])
@jwt_required()
def protected():
    current_user = get_jwt_identity()
    if current_user == "test" :
        return "ummm...."
    elif current_user == "admin" :
        filepath = request.json.get("filepath",None)
        f = open(filepath,'r')
        filedata = f.read()
        f.close()
        return jsonify(filedata), 200

if __name__ == "__main__":
    app.run(host="0.0.0.0")

```

JWTå•é¡Œã¨ã‚ã‹ã‚‹ã€‚ã¨ã‚Šãˆã‚ãš `test:test` ã§ãƒ­ã‚°ã‚¤ãƒ³ã§ããã†ãªã®ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€‚

<img src="/img/2024/02-25/Untitled%2050.png" width="auto" height="auto">

JWTã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ãŒã‚‚ã‚‰ãˆãŸã€‚ã“ã‚Œã‚’ Authorization ãƒ˜ãƒƒãƒ€ã«ä½¿ã£ã¦ `/protected` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹ã€‚

<img src="/img/2024/02-25/Untitled%2051.png" width="auto" height="auto">

ã‚½ãƒ¼ã‚¹ã‹ã‚‰æœŸå¾…ã•ã‚Œã‚‹ã‚ˆã†ã«ã€ ummmm ã—ã¦ã‚‚ã‚‰ã£ãŸã€‚

JWTã®ä¸­èº«ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚

<img src="/img/2024/02-25/Untitled%2052.png" width="auto" height="auto">

[[server] JWT attacks - Notion](https://laysakura.notion.site/Web-hack-Exploit-2c68c0d3131c427aab94e82ae49366ec#8fbb303a58be4c769720f3e5cd072861) ã«ã¾ã¨ã‚ãŸã„ã‚ã„ã‚ãªæ”»æ’ƒã‚’è©¦ã™ãŒã€å•é¡Œã‚¿ã‚¤ãƒˆãƒ«çš„ã«ã‚‚æœ¬å‘½ã¯ [Exploit: ç§˜å¯†éµã«brute force / è¾æ›¸æ”»æ’ƒ - Notion](https://laysakura.notion.site/Web-hack-Exploit-2c68c0d3131c427aab94e82ae49366ec#86d4ae8ce83e4d0cb4e3f80a0e4050a4) ã€‚

å…ˆã»ã©å¾—ãŸ `test:test` ã®JWTã§ç§˜å¯†éµã‚’æ¢ã™ã€‚

```python
% hashcat -a 0 -m 16500 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTcwODg0OTA1NSwianRpIjoiMGZkY2NlZjQtZmFmNi00ZjQ1LThiODgtNWU4Y2VhMWZhOTlkIiwidHlwZSI6ImFjY2VzcyIsInN1YiI6InRlc3QifQ.G5nYLH6uv37IdJRGw9FFrDBa_TBGliO4dlKsFvEVzcQ' /usr/share/wordlists/rockyou.txt --show
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTcwODg0OTA1NSwianRpIjoiMGZkY2NlZjQtZmFmNi00ZjQ1LThiODgtNWU4Y2VhMWZhOTlkIiwidHlwZSI6ImFjY2VzcyIsInN1YiI6InRlc3QifQ.G5nYLH6uv37IdJRGw9FFrDBa_TBGliO4dlKsFvEVzcQ:**conankun**
```

`conankun` ãŒã‚­ãƒ¼`ã€‚`

ã“ã‚Œä½¿ã£ã¦ã€ `"sub"` ã‚’ `admin` ã«å¤‰ãˆãŸJWTã‚’ä½œã£ã¦é€ä¿¡ã™ã‚‹ã‚‚ã€500â€¦

<img src="/img/2024/02-25/Untitled%2053.png" width="auto" height="auto">

---

æ”¹ã‚ã¦ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€ã¨ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®JSONã« `filepath` ã‚’æŒ‡å®šã—ãªã„ã¨ç¢ºã‹ã«ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šãã†ã€‚

ã—ã‹ã—ãƒ•ãƒ©ã‚°ã®pathãŒã‚ã‹ã‚‰ãªã„ã€‚

ä¸€æ—¦ `{"filepath": "/etc/passwd"}` ã¨ã‹ã«ã™ã‚‹ã¨ã€ã¡ã‚ƒã‚“ã¨ä¸­èº«ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚Œã‚‹ã€‚

ãƒ•ã‚¡ã‚¤ãƒ«readã‹ã‚‰ãƒ•ãƒ©ã‚°ãƒ‘ã‚¹æƒ…å ±åé›†ã¨ãªã‚‹ã¨ã€ã†ãƒ¼ã‚“ `/proc/self/` ä½¿ãˆã‚‹ã‹ãªãã€‚

`/proc/self/cmdline` ã‹ã‚‰ :5000 ã®ã‚µãƒ¼ãƒãƒ¼ã®ã‚³ãƒ¼ãƒ‰ã®å ´æ‰€ãŒã‚ã‹ã‚Šã€

<img src="/img/2024/02-25/Untitled%2054.png" width="auto" height="auto">

ãã‚Œã‚’èª­ã‚€ã“ã¨ã§æœ¬ç‰©ã® `admin` ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒ `EyS9$Ww4nhx)` ã§ã‚ã‚‹ã“ã¨ãŒè¿½åŠ ã§ã‚ã‹ã£ãŸã‚Šã—ãŸãŒã€ç‰¹ã«æ­£è§£ã«è¿‘ã¥ãã‚‚ã®ã§ã¯ãªã‹ã£ãŸã€‚

ä»–ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚‚è¦‹ã‚‹ã‹ã¨ã„ã†ã“ã¨ã§ã€ `/proc/1/cmdline` ã‹ã‚‰çœºã‚ã‚‹ã€‚

<img src="/img/2024/02-25/Untitled%2055.png" width="auto" height="auto">

ãŠã€supervisord.confãŒæ°—ã«ãªã‚‹ã€‚

<img src="/img/2024/02-25/Untitled%2056.png" width="auto" height="auto">

ãªã‚“ã‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚ã‚‹ï¼ã“ã‚ŒãŒ :8000 ã®basicèªè¨¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã ã£ãŸã€‚Basicèªè¨¼çªç ´ã™ã‚‹ã¨ãƒ•ãƒ©ã‚°ãŒãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã«ãªã£ã¦ã„ãŸã€‚

<img src="/img/2024/02-25/Untitled%2057.png" width="auto" height="auto">

<aside>
â›³ FLAG{pLi5lfm8hJK7}

</aside>
